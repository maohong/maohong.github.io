{"meta":{"title":"Hong's Notes","subtitle":"High Performance, High Availability and Scalable Architecture, ML, AI and Big Data","description":"Overthinking only lead to problems, actions lead to answers.","author":"Hong","url":"https://maohong.github.io"},"pages":[{"title":"","date":"2025-03-03T09:38:38.051Z","updated":"2025-03-03T09:38:38.051Z","comments":true,"path":"404.html","permalink":"https://maohong.github.io/404.html","excerpt":"","keywords":null,"text":"","raw":null,"content":null},{"title":"About Me","date":"2016-03-03T07:16:19.000Z","updated":"2025-03-30T03:46:04.268Z","comments":true,"path":"about/index.html","permalink":"https://maohong.github.io/about/index.html","excerpt":"","keywords":null,"text":"&nbsp; Profile Manage multiple backend engineering teams with responsibilities spanning team direction, roadmap planning, engineering and product excellence, people development and cross-team collaboration. Lead the delivery of core backend platforms and technical products that solve common challenges and enhance engineering efficiency across business lines. Focus areas include service development frameworks, service governance and performance optimization, database/MQ/caching middlewares, common libraries and platform services. &nbsp; Interests Database / Middleware / Architecture / Distributed System / Machine Learning / Artificial Intelligence / BigData â€¦ &nbsp; Contact &nbsp; LinkedIn &nbsp; Github &nbsp; Email","raw":null,"content":null},{"title":"Book Collection","date":"2017-01-14T16:16:30.000Z","updated":"2025-03-30T03:47:21.499Z","comments":true,"path":"books/index.html","permalink":"https://maohong.github.io/books/index.html","excerpt":"","keywords":null,"text":"This page collects highly-rated books in computer science and technology. Computer Languages Title Author Description The Go Programming Language Alan A. A. Donovan, Brian W. Kernighan A comprehensive guide to Go, covering its syntax, concurrency, and practical applications. Effective Java Joshua Bloch A must-read for Java developers, offering best practices and design patterns. The C++ Programming Language Bjarne Stroustrup The definitive guide to C++ by its creator, covering modern C++ features. Fluent Python Luciano Ramalho A deep dive into Pythonâ€™s features, focusing on idiomatic and efficient code. Programming in Scala Martin Odersky, Lex Spoon, Bill Venners A comprehensive introduction to Scala, written by its creator. JavaScript: The Good Parts Douglas Crockford A concise guide to the best parts of JavaScript, focusing on good practices. The Rust Programming Language Steve Klabnik, Carol Nichols A beginner-friendly guide to Rust, covering its memory safety and concurrency features. Programming Ruby Dave Thomas, Chad Fowler, Andy Hunt A comprehensive guide to Ruby, covering its syntax and advanced features. Eloquent JavaScript Marijn Haverbeke A modern introduction to JavaScript, focusing on programming fundamentals. Python Crash Course Eric Matthes A beginner-friendly guide to Python, with hands-on projects and exercises. Computer Fundamentals and Architecture Title Author Description Computer Systems: A Programmerâ€™s Perspective Randal E. Bryant, David R. Oâ€™Hallaron A deep dive into computer systems, focusing on how programs interact with hardware. Operating System Concepts Abraham Silberschatz, Peter B. Galvin, Greg Gagne A comprehensive textbook on operating systems, covering theory and practice. Computer Organization and Design David A. Patterson, John L. Hennessy A classic textbook on computer architecture, focusing on MIPS and RISC-V. The Elements of Computing Systems Noam Nisan, Shimon Schocken A hands-on guide to building a computer from scratch, starting with NAND gates. Modern Operating Systems Andrew S. Tanenbaum A detailed exploration of modern operating systems, including Linux and Windows. Computer Networks Andrew S. Tanenbaum, David J. Wetherall A comprehensive textbook on computer networks, covering protocols and architectures. Structure and Interpretation of Computer Programs Harold Abelson, Gerald Jay Sussman, Julie Sussman A classic textbook on programming and computer science fundamentals. Computer Architecture: A Quantitative Approach John L. Hennessy, David A. Patterson A detailed exploration of computer architecture, focusing on performance and design. Introduction to the Theory of Computation Michael Sipser A comprehensive introduction to computational theory, including automata and complexity. Computer Networking: A Top-Down Approach James F. Kurose, Keith W. Ross A top-down approach to understanding computer networks, focusing on applications and protocols. Big Data Technologies and Applications Title Author Description Hadoop: The Definitive Guide Tom White A comprehensive guide to Hadoop, covering its architecture and applications. Designing Data-Intensive Applications Martin Kleppmann A deep dive into the principles of designing scalable and reliable data systems. Spark: The Definitive Guide Bill Chambers, Matei Zaharia A comprehensive guide to Apache Spark, covering its architecture and applications. Big Data: Principles and Best Practices Nathan Marz, James Warren A practical guide to building big data systems, focusing on Lambda Architecture. Data Science from Scratch Joel Grus A hands-on introduction to data science, covering Python and machine learning. Data-Intensive Text Processing with MapReduce Jimmy Lin, Chris Dyer A detailed exploration of text processing using MapReduce. Big Data Analytics Venkat Ankam A practical guide to big data analytics, covering tools and techniques for data processing. Data Mining: Concepts and Techniques Jiawei Han, Micheline Kamber, Jian Pei A comprehensive textbook on data mining, covering algorithms and applications. Streaming Systems Tyler Akidau, Slava Chernyak, Reuven Lax A detailed exploration of streaming data systems, focusing on real-time processing. Big Data: A Revolution That Will Transform How We Live, Work, and Think Viktor Mayer-SchÃ¶nberger, Kenneth Cukier A non-technical exploration of the impact of big data on society and business. Machine Learning and Artificial Intelligence Title Author Description Deep Learning Ian Goodfellow, Yoshua Bengio, Aaron Courville The definitive textbook on deep learning, covering theory and applications. Pattern Recognition and Machine Learning Christopher M. Bishop A comprehensive textbook on machine learning, focusing on probabilistic models. Hands-On Machine Learning with Scikit-Learn, Keras, and TensorFlow AurÃ©lien GÃ©ron A practical guide to machine learning, with hands-on examples using Python. Artificial Intelligence: A Modern Approach Stuart Russell, Peter Norvig The most widely used textbook on AI, covering a broad range of topics. Reinforcement Learning: An Introduction Richard S. Sutton, Andrew G. Barto A comprehensive introduction to reinforcement learning, covering theory and algorithms. Machine Learning Yearning Andrew Ng A practical guide to structuring machine learning projects, focusing on best practices. The Hundred-Page Machine Learning Book Andriy Burkov A concise yet comprehensive introduction to machine learning, covering key concepts. Deep Learning with Python FranÃ§ois Chollet A practical guide to deep learning using Keras and TensorFlow. Machine Learning: A Probabilistic Perspective Kevin P. Murphy A detailed textbook on machine learning, focusing on probabilistic methods. Python Machine Learning Sebastian Raschka, Vahid Mirjalili A practical guide to machine learning using Python, covering libraries and techniques. High-Performance, High-Availability, and Scalable Distributed Systems Design Title Author Description Designing Distributed Systems Brendan Burns A practical guide to designing scalable and reliable distributed systems. Distributed Systems: Principles and Paradigms Andrew S. Tanenbaum, Maarten Van Steen A comprehensive textbook on distributed systems, covering principles and paradigms. Building Microservices Sam Newman A practical guide to designing and building microservices architectures. Site Reliability Engineering Google SRE Team A detailed exploration of Googleâ€™s approach to building reliable and scalable systems. Scalability Rules: 50 Principles for Scaling Web Sites Martin L. Abbott, Michael T. Fisher A practical guide to scaling web applications, with 50 key principles. High Performance Browser Networking Ilya Grigorik A detailed exploration of networking performance in web applications. Designing Data-Intensive Applications Martin Kleppmann A deep dive into the principles of designing scalable and reliable data systems. Cloud Native Patterns Cornelia Davis A practical guide to building cloud-native applications, focusing on patterns and best practices. Kubernetes: Up and Running Kelsey Hightower, Brendan Burns, Joe Beda A practical guide to Kubernetes, covering its architecture and applications. The Art of Scalability Martin L. Abbott, Michael T. Fisher A comprehensive guide to scaling systems, focusing on architecture and organizational strategies.","raw":null,"content":null},{"title":"Categories","date":"2016-07-03T07:22:46.000Z","updated":"2025-03-09T11:03:29.629Z","comments":true,"path":"categories/index.html","permalink":"https://maohong.github.io/categories/index.html","excerpt":"","keywords":null,"text":"","raw":null,"content":null},{"title":"Archives","date":"2016-07-03T07:36:16.000Z","updated":"2025-03-09T11:02:56.729Z","comments":true,"path":"archives/index.html","permalink":"https://maohong.github.io/archives/index.html","excerpt":"","keywords":null,"text":"","raw":null,"content":null},{"title":"Tags","date":"2016-07-03T07:30:44.000Z","updated":"2025-03-09T11:03:37.911Z","comments":true,"path":"tags/index.html","permalink":"https://maohong.github.io/tags/index.html","excerpt":"","keywords":null,"text":"","raw":null,"content":null},{"title":"Test Page","date":"2025-03-09T13:16:30.000Z","updated":"2025-03-30T02:44:33.531Z","comments":true,"path":"test/index.html","permalink":"https://maohong.github.io/test/index.html","excerpt":"","keywords":null,"text":"Table Examples Special Format Task List Font Awesome ğŸ˜„ğŸ˜â˜€ï¸ Table Examples æ ‡é¢˜1 æ ‡é¢˜2 åˆå¹¶ç¬¬ä¸€è¡Œ ç¬¬äºŒè¡Œç¬¬ä¸€åˆ— ç¬¬äºŒè¡Œç¬¬äºŒåˆ— Task Time required Assigned to Current Status Finished Calendar Cache &gt; 5 hours @georgehrke in progress - [x] ok? Object Cache &gt; 5 hours @georgehrke in progress - [x] item1- [ ] item2 Object Cache &gt; 5 hours @georgehrke in progress - [x] item1- [ ] item2 Object Cache &gt; 5 hours @georgehrke in progress [x] item1[ ] item2 Function MySQL / MariaDB PostgreSQL SQLite substr âœ”ï¸ âœ… âœ”ï¸ Special Format Underlined Deleted highlighted with background H20 29th Here is a footnote reference,[1] and another.[2] The HTML specification is maintained by the W3C. WARNING here be dragons INFO here are some information Task List item 1 item 1-1 item 1-2 item 1-3 item 1-4 item 2 item 2-1 item 2-2 item 2-3 item 2-4 Font Awesome æ”¯æŒMarkdown Hexo æ”¯æŒ GitHub Flavored Markdown çš„æ‰€æœ‰åŠŸèƒ½, ç”šè‡³å¯ä»¥æ•´åˆ Octopress çš„å¤§å¤šæ•°æ’ä»¶. ä¸€é”®éƒ¨ç½² åªéœ€ä¸€æ¡æŒ‡ä»¤å³å¯éƒ¨ç½²åˆ°Github Pages, æˆ–å…¶ä»–ç½‘ç«™ ä¸°å¯Œçš„æ’ä»¶ Hexo æ‹¥æœ‰å¼ºå¤§çš„æ’ä»¶ç³»ç»Ÿ, å®‰è£…æ’ä»¶å¯ä»¥è®© Hexo æ”¯æŒ Jade, CoffeeScript. Here is the footnote. â†©ï¸ Hereâ€™s one with multiple blocks. â†©ï¸","raw":null,"content":null}],"posts":[{"title":"Understanding LLM based AI Agents","slug":"Understanding LLM based AI Agents","date":"2025-03-16T15:25:20.000Z","updated":"2025-03-16T15:25:20.000Z","comments":true,"path":"20250316/Understanding LLM based AI Agents/","permalink":"https://maohong.github.io/20250316/Understanding%20LLM%20based%20AI%20Agents/","excerpt":"What are LLM-based AI Agents? An LLM-based AI agent is an intelligent system that uses large language models (like GPT-4) to perform tasks autonomously, including perceiving the environment, reasoning about it, making decisions, and executing actions. Unlike traditional chatbots, these agents can plan tasks, take actions using external tools, and handle multi-step problems. It aims to enable people to perform and handle professional or complex tasks in a highly automated manner using natural language, driven by LLM technology, thereby freeing up personnel energy to the greatest extent. Core Components of an AI Agent LLM-based agents usually rely on a modular architecture that gives the LLM the support it needs to operate autonomously. The typical agent is composed of a few key components. graph LR U(User Request) --&gt;|input| A[Agent Core] A --&gt;|analyse| B[Planning] B --&gt;|action plan| A A --&gt;|invoke| C[Tools] A &lt;--&gt;|context| D[Memory] A --&gt;|response| U Agent Core: At the heart of the agent is the LLM itself (for example, GPT-4, Claude, or an open-source model like LLaMA 2). This core interprets the userâ€™s input and generates the agentâ€™s responses. On its own, the LLM is very powerful at understanding language and reasoning, but itâ€™s essentially reactive (it responds to prompts without taking additional actions). In an agent setup, the LLM core is augmented with surrounding logic so it can be more proactive, meaning it needs other components to interface with the outside world and handle complex tasks.","keywords":null,"text":"What are LLM-based AI Agents? An LLM-based AI agent is an intelligent system that uses large language models (like GPT-4) to perform tasks autonomously, including perceiving the environment, reasoning about it, making decisions, and executing actions. Unlike traditional chatbots, these agents can plan tasks, take actions using external tools, and handle multi-step problems. It aims to enable people to perform and handle professional or complex tasks in a highly automated manner using natural language, driven by LLM technology, thereby freeing up personnel energy to the greatest extent. Core Components of an AI Agent LLM-based agents usually rely on a modular architecture that gives the LLM the support it needs to operate autonomously. The typical agent is composed of a few key components. graph LR U(User Request) --&gt;|input| A[Agent Core] A --&gt;|analyse| B[Planning] B --&gt;|action plan| A A --&gt;|invoke| C[Tools] A &lt;--&gt;|context| D[Memory] A --&gt;|response| U Agent Core: At the heart of the agent is the LLM itself (for example, GPT-4, Claude, or an open-source model like LLaMA 2). This core interprets the userâ€™s input and generates the agentâ€™s responses. On its own, the LLM is very powerful at understanding language and reasoning, but itâ€™s essentially reactive (it responds to prompts without taking additional actions). In an agent setup, the LLM core is augmented with surrounding logic so it can be more proactive, meaning it needs other components to interface with the outside world and handle complex tasks. Tools (Action Interfaces): Tools are how an LLM agent interacts with the world beyond its internal knowledge. A tool could be any external function or API the agent can call â€“ for example, a web search engine, a database query, a code execution sandbox, a calculator, or a source code search function. Tools give the agent the ability to take actions like looking up information, running computations, or retrieving specific dataâ€‹. In a software development context, useful tools might include: A code search tool to find snippets in a repository A documentation lookup API to fetch reference docs A ticket database query to pull related support tickets or a shell command executor to run test cases Memory: Memory provides the agent with the ability to remember information across multiple steps or interactions. There are typically two kinds of memory in such agentsâ€‹. Short-term memory â€“ which keeps track of the agentâ€™s recent â€œthoughtsâ€ and actions during the current task (often called the context or the transcript of the reasoning so far). This is like the agentâ€™s scratchpad for one session â€“ it might include what the agent has already tried and what it observed. Long-term memory â€“ which persists information beyond a single session, allowing the agent to recall facts or past conversations from earlier. This could be implemented via a database or vector store that the agent queries as neededâ€‹. Planning Module: This component is what makes an agent â€œagenticâ€ â€“ it allows the system to plan a multi-step strategy rather than just respond immediately. The planning module could be as simple as some prompt engineering that encourages the LLM to think step-by-step, or as elaborate as a separate algorithm or model that breaks tasks into sub-tasks. The idea is to enable task decomposition, decision-making, and iterationâ€‹. In practical, the planning does things like: Analyze the userâ€™s request and break it into smaller problems if needed. Decide which tool to use at each step. Loop through actions and observations: the agent might use a tool, see the result, and then decide the next step based on that. These components work together in a cycle. Typically, an agent loop might look like: the LLM core (with the planning prompt) decides on an Action (calls a Tool), the tool returns some data which is stored in Memory or fed back to the LLM, and the LLM then decides the next steps or gives the final answer. This continues until the agent is confident it has solved the userâ€™s request.","raw":null,"content":null,"categories":[{"name":"LLM","slug":"LLM","permalink":"https://maohong.github.io/categories/LLM/"}],"tags":[{"name":"AI","slug":"AI","permalink":"https://maohong.github.io/tags/AI/"},{"name":"AI Agent","slug":"AI-Agent","permalink":"https://maohong.github.io/tags/AI-Agent/"},{"name":"LLM","slug":"LLM","permalink":"https://maohong.github.io/tags/LLM/"}]},{"title":"Mermaid Examples","slug":"Mermaid-Examples","date":"2023-08-13T11:41:59.000Z","updated":"2023-08-13T11:41:59.000Z","comments":true,"path":"20230813/Mermaid-Examples/","permalink":"https://maohong.github.io/20230813/Mermaid-Examples/","excerpt":"Mermaid Examples Below are the examples of different types of Mermaid graph. All Available Types Mermaid Syntax Mermaid Examples graph LR A[Perception] --&gt; B(Planning) B --&gt;|Policy| C[Action] C -.-&gt;|Observation| A graph LR A[Hard] --&gt;|Text| B(Round) B --&gt; C{Decision} C --&gt;|One| D[Result 1] C --&gt;|Two| E[Result 2] D --&gt;|Feedback| F[Feedback] E --&gt;|Feedback| F[Feedback] F -.-&gt; A sequenceDiagram Alice-&gt;&gt;John: Hello John, how are you? loop HealthCheck John-&gt;&gt;John: Fight against hypochondria end Note right of John: Rational thoughts! John--&gt;&gt;Alice: Great! John-&gt;&gt;Bob: How about you? Bob--&gt;&gt;John: Jolly good!","keywords":null,"text":"Mermaid Examples Below are the examples of different types of Mermaid graph. All Available Types Mermaid Syntax Mermaid Examples graph LR A[Perception] --&gt; B(Planning) B --&gt;|Policy| C[Action] C -.-&gt;|Observation| A graph LR A[Hard] --&gt;|Text| B(Round) B --&gt; C{Decision} C --&gt;|One| D[Result 1] C --&gt;|Two| E[Result 2] D --&gt;|Feedback| F[Feedback] E --&gt;|Feedback| F[Feedback] F -.-&gt; A sequenceDiagram Alice-&gt;&gt;John: Hello John, how are you? loop HealthCheck John-&gt;&gt;John: Fight against hypochondria end Note right of John: Rational thoughts! John--&gt;&gt;Alice: Great! John-&gt;&gt;Bob: How about you? Bob--&gt;&gt;John: Jolly good! gantt section Section Completed :done, des1, 2014-01-06,2014-01-08 Active :active, des2, 2014-01-07, 3d Parallel 1 : des3, after des1, 1d Parallel 2 : des4, after des1, 1d Parallel 3 : des5, after des3, 1d Parallel 4 : des6, after des4, 1d gitGraph commit commit branch develop checkout develop commit commit checkout main merge develop commit commit classDiagram Class01 &lt;|-- AveryLongClass : Cool &lt;&lt;Interface&gt;&gt; Class01 Class09 --&gt; C2 : Where am I? Class09 --* C3 Class09 --|&gt; Class07 Class07 : equals() Class07 : Object[] elementData Class01 : size() Class01 : int chimp Class01 : int gorilla class Class10 { &lt;&lt;service&gt;&gt; int id size() } journey title My working day section Go to work Make tea: 5: Me Go upstairs: 3: Me Do work: 1: Me, Cat section Go home Go downstairs: 5: Me Sit down: 3: Me pie \"Dogs\" : 386 \"Cats\" : 85.9 \"Rats\" : 15 C4Context title System Context diagram for Internet Banking System Person(customerA, \"Banking Customer A\", \"A customer of the bank, with personal bank accounts.\") Person(customerB, \"Banking Customer B\") Person_Ext(customerC, \"Banking Customer C\") System(SystemAA, \"Internet Banking System\", \"Allows customers to view information about their bank accounts, and make payments.\") Person(customerD, \"Banking Customer D\", \"A customer of the bank, &lt;br/&gt; with personal bank accounts.\") Enterprise_Boundary(b1, \"BankBoundary\") { SystemDb_Ext(SystemE, \"Mainframe Banking System\", \"Stores all of the core banking information about customers, accounts, transactions, etc.\") System_Boundary(b2, \"BankBoundary2\") { System(SystemA, \"Banking System A\") System(SystemB, \"Banking System B\", \"A system of the bank, with personal bank accounts.\") } System_Ext(SystemC, \"E-mail system\", \"The internal Microsoft Exchange e-mail system.\") SystemDb(SystemD, \"Banking System D Database\", \"A system of the bank, with personal bank accounts.\") Boundary(b3, \"BankBoundary3\", \"boundary\") { SystemQueue(SystemF, \"Banking System F Queue\", \"A system of the bank, with personal bank accounts.\") SystemQueue_Ext(SystemG, \"Banking System G Queue\", \"A system of the bank, with personal bank accounts.\") } } BiRel(customerA, SystemAA, \"Uses\") BiRel(SystemAA, SystemE, \"Uses\") Rel(SystemAA, SystemC, \"Sends e-mails\", \"SMTP\") Rel(SystemC, customerA, \"Sends e-mails to\")","raw":null,"content":null,"categories":[{"name":"Tools","slug":"Tools","permalink":"https://maohong.github.io/categories/Tools/"}],"tags":[{"name":"Mermaid","slug":"Mermaid","permalink":"https://maohong.github.io/tags/Mermaid/"},{"name":"Tools","slug":"Tools","permalink":"https://maohong.github.io/tags/Tools/"}]},{"title":"PlantUML Examples","slug":"PlantUML-Examples","date":"2022-03-02T02:28:29.000Z","updated":"2022-03-02T02:28:29.000Z","comments":true,"path":"20220302/PlantUML-Examples/","permalink":"https://maohong.github.io/20220302/PlantUML-Examples/","excerpt":"Class Diagram package package class","keywords":null,"text":"Class Diagram package package class class and interface abstract and static relationship class method Sequence Diagram Flow Diagram if/else repeat multiprocessor note arrow composition swimlane detach Use Case Diagram use case role description basic note arrow color","raw":null,"content":null,"categories":[{"name":"Tools","slug":"Tools","permalink":"https://maohong.github.io/categories/Tools/"}],"tags":[{"name":"Tools","slug":"Tools","permalink":"https://maohong.github.io/tags/Tools/"},{"name":"PlantUML","slug":"PlantUML","permalink":"https://maohong.github.io/tags/PlantUML/"}]},{"title":"kafka-0.10.0å¯åŠ¨è¿‡ç¨‹åˆ†æ","slug":"kafka-0-10-0å¯åŠ¨è¿‡ç¨‹åˆ†æ","date":"2017-07-08T14:46:18.000Z","updated":"2017-07-08T14:46:18.000Z","comments":true,"path":"20170708/kafka-0-10-0å¯åŠ¨è¿‡ç¨‹åˆ†æ/","permalink":"https://maohong.github.io/20170708/kafka-0-10-0%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90/","excerpt":"kafka-0.10.0æ˜¯å®˜æ–¹å‡ºçš„æœ€æ–°ç¨³å®šç‰ˆæœ¬ï¼Œæä¾›äº†å¤§é‡æ–°çš„featureï¼Œå…·ä½“å¯è§è¿™é‡Œï¼Œæœ¬æ–‡ä¸»è¦åˆ†ækafka-0.10-0çš„æºç ç»“æ„å’Œå¯åŠ¨è¿‡ç¨‹ã€‚ æºç ç»“æ„ kafka-0.10.0çš„æºç å¯ä»¥ä»githubä¸Šforkä¸€ä»½ï¼Œåœ¨æºç ç›®å½•ä¸‹æ‰§è¡Œ./gradlew ideaç”Ÿæˆideaé¡¹ç›®ï¼Œç„¶åå¯¼å…¥ideaå³å¯ã€‚è¿™ä¸­é—´éœ€è¦ä½¿ç”¨gradleè¿›è¡Œä¾èµ–åŒ…çš„ä¸‹è½½ï¼Œå¯¼å…¥åå¯ä»¥çœ‹åˆ°å…¶æºç ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š åŒ…æ‹¬å‡ å¤§é‡è¦æ¨¡å—ï¼š clientsä¸»è¦æ˜¯kafka-clientç›¸å…³çš„ä»£ç ï¼ŒåŒ…æ‹¬consumerã€producerï¼Œè¿˜åŒ…æ‹¬ä¸€äº›å…¬å…±é€»è¾‘ï¼Œå¦‚æˆæƒè®¤è¯ã€åºåˆ—åŒ–ç­‰ã€‚ connectä¸»è¦æ˜¯kafka-connectæ¨¡å—çš„ä»£ç é€»è¾‘ï¼ŒKafka connectæ˜¯0.9ç‰ˆæœ¬å¢åŠ çš„ç‰¹æ€§,æ”¯æŒåˆ›å»ºå’Œç®¡ç†æ•°æ®æµç®¡é“ã€‚é€šè¿‡å®ƒå¯ä»¥å°†å¤§æ•°æ®ä»å…¶å®ƒç³»ç»Ÿå¯¼å…¥åˆ°Kafkaä¸­ï¼Œä¹Ÿå¯ä»¥ä»Kafkaä¸­å¯¼å‡ºåˆ°å…¶å®ƒç³»ç»Ÿï¼Œæ¯”å¦‚æ•°æ®åº“ã€elastic searchç­‰ã€‚ coreæ¨¡å—æ˜¯kafkaçš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œä¸»è¦åŒ…æ‹¬brokerçš„å®ç°é€»è¾‘ã€producerå’Œconsumerçš„javaapiç­‰ã€‚ streamsæ¨¡å—ä¸»è¦æ˜¯kafka-streamingçš„å®ç°ï¼Œæä¾›äº†ä¸€æ•´å¥—æè¿°å¸¸è§æµæ“ä½œçš„é«˜çº§è¯­è¨€APIï¼ˆæ¯”å¦‚ joining, filteringä»¥åŠaggregationç­‰ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥åŸºäºæ­¤å¼€å‘æµå¤„ç†åº”ç”¨ç¨‹åºã€‚","keywords":null,"text":"kafka-0.10.0æ˜¯å®˜æ–¹å‡ºçš„æœ€æ–°ç¨³å®šç‰ˆæœ¬ï¼Œæä¾›äº†å¤§é‡æ–°çš„featureï¼Œå…·ä½“å¯è§è¿™é‡Œï¼Œæœ¬æ–‡ä¸»è¦åˆ†ækafka-0.10-0çš„æºç ç»“æ„å’Œå¯åŠ¨è¿‡ç¨‹ã€‚ æºç ç»“æ„ kafka-0.10.0çš„æºç å¯ä»¥ä»githubä¸Šforkä¸€ä»½ï¼Œåœ¨æºç ç›®å½•ä¸‹æ‰§è¡Œ./gradlew ideaç”Ÿæˆideaé¡¹ç›®ï¼Œç„¶åå¯¼å…¥ideaå³å¯ã€‚è¿™ä¸­é—´éœ€è¦ä½¿ç”¨gradleè¿›è¡Œä¾èµ–åŒ…çš„ä¸‹è½½ï¼Œå¯¼å…¥åå¯ä»¥çœ‹åˆ°å…¶æºç ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š åŒ…æ‹¬å‡ å¤§é‡è¦æ¨¡å—ï¼š clientsä¸»è¦æ˜¯kafka-clientç›¸å…³çš„ä»£ç ï¼ŒåŒ…æ‹¬consumerã€producerï¼Œè¿˜åŒ…æ‹¬ä¸€äº›å…¬å…±é€»è¾‘ï¼Œå¦‚æˆæƒè®¤è¯ã€åºåˆ—åŒ–ç­‰ã€‚ connectä¸»è¦æ˜¯kafka-connectæ¨¡å—çš„ä»£ç é€»è¾‘ï¼ŒKafka connectæ˜¯0.9ç‰ˆæœ¬å¢åŠ çš„ç‰¹æ€§,æ”¯æŒåˆ›å»ºå’Œç®¡ç†æ•°æ®æµç®¡é“ã€‚é€šè¿‡å®ƒå¯ä»¥å°†å¤§æ•°æ®ä»å…¶å®ƒç³»ç»Ÿå¯¼å…¥åˆ°Kafkaä¸­ï¼Œä¹Ÿå¯ä»¥ä»Kafkaä¸­å¯¼å‡ºåˆ°å…¶å®ƒç³»ç»Ÿï¼Œæ¯”å¦‚æ•°æ®åº“ã€elastic searchç­‰ã€‚ coreæ¨¡å—æ˜¯kafkaçš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œä¸»è¦åŒ…æ‹¬brokerçš„å®ç°é€»è¾‘ã€producerå’Œconsumerçš„javaapiç­‰ã€‚ streamsæ¨¡å—ä¸»è¦æ˜¯kafka-streamingçš„å®ç°ï¼Œæä¾›äº†ä¸€æ•´å¥—æè¿°å¸¸è§æµæ“ä½œçš„é«˜çº§è¯­è¨€APIï¼ˆæ¯”å¦‚ joining, filteringä»¥åŠaggregationç­‰ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥åŸºäºæ­¤å¼€å‘æµå¤„ç†åº”ç”¨ç¨‹åºã€‚ å¯åŠ¨å…¥å£ kafkaçš„å¯åŠ¨å…¥å£åœ¨core_mainè¿™ä¸ªmoduleä¸‹ï¼Œå…¥å£å‡½æ•°å¦‚ä¸‹ï¼š 12345678910111213141516171819202122def main(args: Array[String]): Unit = { try { val serverProps = getPropsFromArgs(args) val kafkaServerStartable = KafkaServerStartable.fromProps(serverProps) // attach shutdown handler to catch control-c Runtime.getRuntime().addShutdownHook(new Thread() { override def run() = { kafkaServerStartable.shutdown } }) kafkaServerStartable.startup kafkaServerStartable.awaitShutdown } catch { case e: Throwable =&gt; fatal(e) System.exit(1) } System.exit(0) } å…ˆä»å‘½ä»¤è¡ŒæŒ‡å®šçš„é…ç½®æ–‡ä»¶åŠ è½½é…ç½®ï¼Œç„¶åé€šè¿‡KafkaServerStartableç±»å¯åŠ¨brokerï¼Œå®é™…ä¸Šåœ¨KafkaServerStartableä¸­ç»´æŠ¤äº†ä¸€ä¸ªKafkaServerå¯¹è±¡ï¼Œå®ƒé€šè¿‡è°ƒç”¨KafkaServerçš„startupæ–¹æ³•å¯åŠ¨brokerã€‚ brokerå¯åŠ¨è¿‡ç¨‹ ä¸‹é¢å¹¶å¯åŠ¨è¿‡ç¨‹ä»£ç æŒ‰å¯åŠ¨é¡ºåºåˆ†ä¸¤éƒ¨åˆ†åšè¯´æ˜ã€‚ ç¬¬ä¸€éƒ¨åˆ†ä¸»è¦æ˜¯æ ¸å¿ƒæ¨¡å—çš„å¯åŠ¨ï¼Œä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546metrics = new Metrics(metricConfig, reporters, kafkaMetricsTime, true) brokerState.newState(Starting) /* start scheduler */ kafkaScheduler.startup() /* setup zookeeper */ zkUtils = initZk() /* start log manager */ logManager = createLogManager(zkUtils.zkClient, brokerState) logManager.startup() /* generate brokerId */ config.brokerId = getBrokerId this.logIdent = \"[Kafka Server \" + config.brokerId + \"], \" socketServer = new SocketServer(config, metrics, kafkaMetricsTime) socketServer.startup() /* start replica manager */ replicaManager = new ReplicaManager(config, metrics, time, kafkaMetricsTime, zkUtils, kafkaScheduler, logManager, isShuttingDown) replicaManager.startup() /* start kafka controller */ kafkaController = new KafkaController(config, zkUtils, brokerState, kafkaMetricsTime, metrics, threadNamePrefix) kafkaController.startup() /* start group coordinator */ groupCoordinator = GroupCoordinator(config, zkUtils, replicaManager, kafkaMetricsTime) groupCoordinator.startup() /* Get the authorizer and initialize it if one is specified.*/ authorizer = Option(config.authorizerClassName).filter(_.nonEmpty).map { authorizerClassName =&gt; val authZ = CoreUtils.createObject[Authorizer](authorizerClassName) authZ.configure(config.originals()) authZ } /* start processing requests */ apis = new KafkaApis(socketServer.requestChannel, replicaManager, groupCoordinator, kafkaController, zkUtils, config.brokerId, config, metadataCache, metrics, authorizer) requestHandlerPool = new KafkaRequestHandlerPool(config.brokerId, socketServer.requestChannel, apis, config.numIoThreads) brokerState.newState(RunningAsBroker) é¦–å…ˆæ˜¯åˆå§‹åŒ–Metricsæ³¨å†Œä¿¡æ¯ã€‚ æ¥ç€æŠŠå½“å‰brokerçš„çŠ¶æ€å…ˆç½®ä¸ºStartingã€‚ å¯åŠ¨kafkaSchedulerï¼Œå…¶å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªScheduledThreadPoolExecutorï¼Œç”¨äºæ‰§è¡Œbrokerå†…ç½®çš„ä¸€äº›å‘¨æœŸæ€§è¿è¡Œçš„jobæˆ–å®šæ—¶jobã€‚æ¯”å¦‚ï¼Œå¯åŠ¨è‡ªåŠ¨æäº¤æ—¶ï¼Œbrokerä¼šå®šæœŸç»´æŠ¤å®¢æˆ·ç«¯çš„æ¶ˆè´¹topic-partitionçš„offsetä¿¡æ¯ã€‚ åˆå§‹åŒ–zookeeperè®¿é—®å·¥å…·ï¼Œå»ºç«‹å¿…è¦çš„æ•°æ®è·¯å¾„ã€‚ å¯åŠ¨LogManagerï¼Œä¹Ÿå°±æ˜¯æ—¥å¿—æ•°æ®ç®¡ç†å­ç³»ç»Ÿï¼Œè´Ÿè´£æ—¥å¿—æ•°æ®çš„åˆ›å»ºã€æˆªæ–­ã€æ»šåŠ¨ã€å’Œæ¸…ç†ç­‰ã€‚ å¯åŠ¨SocketServerï¼Œä¸€ä¸ªåŸºäºNIOçš„sockeræœåŠ¡ç«¯ï¼Œå…¶çº¿ç¨‹æ¨¡å‹æ˜¯æœ‰ä¸€ä¸ªacceptorçº¿ç¨‹æ¥æ¥å—å®¢æˆ·ç«¯çš„è¿æ¥ï¼Œå¯¹åº”è¿™ä¸ªacceptoræœ‰Nä¸ªprocessorçº¿ç¨‹ï¼Œæ¯ä¸ªprocessoræœ‰è‡ªå·±çš„selectoræ¥ä»socketsè¯»å–æ”¶åˆ°çš„è¯·æ±‚ã€‚å¦å¤–ï¼Œæœ‰Mä¸ªhandlerçº¿ç¨‹ä¸“é—¨å¤„ç†è¯·æ±‚å¹¶æŠŠå¤„ç†ç»“æœè¿”å›ç»™processorçº¿ç¨‹å¹¶é€šè¿‡socketå†™å›ç»™å®¢æˆ·ç«¯ã€‚ å¯åŠ¨ReplicaManagerï¼Œä¹Ÿå³å‰¯æœ¬ç®¡ç†å™¨ï¼Œç”¨äºç®¡ç†æ¯ä¸ªtopic-partitionçš„å‰¯æœ¬çŠ¶æ€ï¼ŒåŒ…æ‹¬ä¸»ä»ã€ISRåˆ—è¡¨ç­‰ã€‚ å¯åŠ¨KafkaControllerï¼Œå¯ä»¥ç†è§£ä¸ºkafkaé›†ç¾¤çš„ä¸­å¤®æ§åˆ¶å™¨ï¼Œè´Ÿè´£å…¨å±€çš„åè°ƒï¼Œæ¯”å¦‚é€‰å–leaderï¼Œreassignmentç­‰ï¼Œå…¶è‡ªèº«ä¹Ÿæ”¯æŒåŠ¨æ€é€‰ä¸¾é«˜å¯ç”¨ã€‚ å¯åŠ¨GroupCoordinatorï¼Œä¸»è¦ç”¨äºbrokerç»„ç®¡ç†å’Œoffsetç®¡ç†ã€‚ åˆå§‹åŒ–æˆæƒè®¤è¯ç®¡ç†å™¨ï¼Œç”¨æˆ·å¯ä»¥è‡ªå·±é€šè¿‡å‚æ•°authorizer.class.nameæŒ‡å®šå…·ä½“çš„Authorizerå®ç°ã€‚kafkaè‡ªå¸¦æœ‰SimpleAclAuthorizerçš„ç®€å•å®ç°ã€‚ åˆå§‹åŒ–KafkaApisï¼Œç”¨äºç»Ÿä¸€æ¥æ”¶å¤–éƒ¨è¯·æ±‚ã€‚ åˆå§‹åŒ–KafkaRequestHandlerPoolï¼Œå†…éƒ¨æ˜¯ä¸€ä¸ªçº¿ç¨‹æ± ï¼Œç”¨äºå…·ä½“å¤„ç†å¤–éƒ¨è¯·æ±‚ã€‚ å°†å½“å‰brokerçš„çŠ¶æ€ç½®ä¸ºRunningAsBrokerï¼Œè¿™æ—¶ï¼Œbrokerå·²ç»å¯ä»¥å¯¹å¤–æä¾›æœåŠ¡äº†ã€‚ ç¬¬äºŒéƒ¨åˆ†ä¸»è¦æ˜¯è¾…åŠ©æ¨¡å—çš„å¯åŠ¨ï¼Œä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738Mx4jLoader.maybeLoad()/* start dynamic config manager */dynamicConfigHandlers = Map[String, ConfigHandler](ConfigType.Topic -&gt; new TopicConfigHandler(logManager, config), ConfigType.Client -&gt; new ClientIdConfigHandler(apis.quotaManagers))// Apply all existing client configs to the ClientIdConfigHandler to bootstrap the overrides// TODO: Move this logic to DynamicConfigManagerAdminUtils.fetchAllEntityConfigs(zkUtils, ConfigType.Client).foreach { case (clientId, properties) =&gt; dynamicConfigHandlers(ConfigType.Client).processConfigChanges(clientId, properties)}// Create the config manager. start listening to notificationsdynamicConfigManager = new DynamicConfigManager(zkUtils, dynamicConfigHandlers)dynamicConfigManager.startup()/* tell everyone we are alive */val listeners = config.advertisedListeners.map {case(protocol, endpoint) =&gt; if (endpoint.port == 0) (protocol, EndPoint(endpoint.host, socketServer.boundPort(protocol), endpoint.protocolType)) else (protocol, endpoint)}kafkaHealthcheck = new KafkaHealthcheck(config.brokerId, listeners, zkUtils, config.rack, config.interBrokerProtocolVersion)kafkaHealthcheck.startup()// Now that the broker id is successfully registered via KafkaHealthcheck, checkpoint itcheckpointBrokerId(config.brokerId)/* register broker metrics */registerStats()shutdownLatch = new CountDownLatch(1)startupComplete.set(true)isStartingUp.set(false)AppInfoParser.registerAppInfo(jmxPrefix, config.brokerId.toString)info(\"started\") å¯åŠ¨jmxï¼Œé€šè¿‡å‚æ•°kafka_mx4jenableæ§åˆ¶æ˜¯å¦å¯ç”¨jmxï¼Œé»˜è®¤ä¸ºfalseã€‚ åˆå§‹åŒ–TopicConfigHandlerå’ŒClientIdConfigHandlerï¼Œå‰è€…ç”¨äºå¤„ç†zkä¸Šçš„topicé…ç½®å˜æ›´ä¿¡æ¯ï¼Œåè€…ç”¨äºzkä¸Šçš„clientIdé…ç½®å˜æ›´ä¿¡æ¯ã€‚ å¯åŠ¨DynamicConfigManagerï¼Œé€šè¿‡åŠ¨æ€é…ç½®ç®¡ç†å™¨ï¼Œç›‘å¬zkä¸Šçš„é…ç½®èŠ‚ç‚¹å˜åŒ–ï¼Œå¹¶æ ¹æ®å…·ä½“å˜åŒ–çš„é…ç½®ä¿¡æ¯è°ƒç”¨TopicConfigHandleræˆ–ClientIdConfigHandleræ›´æ–°é…ç½®ã€‚ å¯åŠ¨KafkaHealthcheckï¼Œç”¨äºåœ¨zkä¸Šæ³¨å†Œå½“å‰brokerèŠ‚ç‚¹ä¿¡æ¯ï¼Œä»¥ä¾¿èŠ‚ç‚¹é€€å‡ºæ—¶å…¶ä»–brokerå’Œconsumerèƒ½ç›‘å¬åˆ°ï¼Œç›®å‰çš„èŠ‚ç‚¹å¥åº·åº¦åˆ¤æ–­æ¯”è¾ƒç®€å•ï¼Œåªæ˜¯å•çº¯çš„çœ‹zkä¸Šçš„èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨ã€‚ æœ€åï¼Œåœ¨æœ¬åœ°å¯¹å½“å‰brokeråšä¸ªcheckpointï¼Œå¹¶æ³¨å†Œjmx beanä¿¡æ¯","raw":null,"content":null,"categories":[{"name":"Kafka","slug":"Kafka","permalink":"https://maohong.github.io/categories/Kafka/"}],"tags":[{"name":"kafka","slug":"kafka","permalink":"https://maohong.github.io/tags/kafka/"},{"name":"æºç åˆ†æ","slug":"æºç åˆ†æ","permalink":"https://maohong.github.io/tags/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"}]},{"title":"stormé›†ç¾¤supervisorèŠ‚ç‚¹å¼‚å¸¸é€€å‡ºé—®é¢˜æ’æŸ¥","slug":"stormé›†ç¾¤supervisorèŠ‚ç‚¹å¼‚å¸¸é€€å‡ºé—®é¢˜æ’æŸ¥","date":"2017-07-03T12:48:50.000Z","updated":"2017-07-03T12:48:50.000Z","comments":true,"path":"20170703/stormé›†ç¾¤supervisorèŠ‚ç‚¹å¼‚å¸¸é€€å‡ºé—®é¢˜æ’æŸ¥/","permalink":"https://maohong.github.io/20170703/storm%E9%9B%86%E7%BE%A4supervisor%E8%8A%82%E7%82%B9%E5%BC%82%E5%B8%B8%E9%80%80%E5%87%BA%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5/","excerpt":"é—®é¢˜å‡ºç° æµ‹è¯•stormé›†ç¾¤ä¸º0.9.4ç‰ˆæœ¬ï¼Œå‰æ®µæ—¶é—´å‡ºç°supervisorè¿›ç¨‹æŒ‚æ‰ï¼Œè€Œå…¶ä¸Šworkè¿›ç¨‹ä»ç„¶è¿è¡Œçš„è¯¡å¼‚æƒ…å†µï¼Œé€šè¿‡æ—¥å¿—çœ‹åˆ°supervisorè¿›ç¨‹æŒ‚æ‰ä¹‹å‰å‡ºç°ä»¥ä¸‹å¼‚å¸¸ï¼š é—®é¢˜æ’æŸ¥è¿‡ç¨‹ å¾ˆæ˜æ˜¾ï¼Œæ˜¯commons-ioåŒ…çš„FileUtilså·¥å…·ç±»æŠ›å‡ºçš„å¼‚å¸¸ï¼ŒåŸå› æ˜¯åœ¨è°ƒç”¨commons-ioåŒ…çš„FileUtilså·¥å…·ç±»åšmove directoryæ“ä½œæ—¶ï¼Œç›®çš„æ–‡ä»¶å¤¹å·²å­˜åœ¨ã€‚ æŸ¥çœ‹è°ƒç”¨ä»£ç ï¼ˆsupervisor.cljçš„ç¬¬374è¡Œï¼‰ï¼Œæ˜¯è°ƒç”¨download-storm-codeæ–¹æ³•ä»nimbusä¸‹è½½topologyçš„ä»£ç ï¼Œå¹¶ä¸”download-storm-codeæ–¹æ³•ä¸­åšä»£ç ä¸‹è½½å‰åŠ äº†é”é¿å…å¹¶å‘å†™æ–‡ä»¶ã€‚ æœç„¶ï¼Œè¿™é‡Œæ²¡æœ‰åˆ¤æ–­stormrootæ–‡ä»¶å¤¹æ˜¯å¦å·²å­˜åœ¨ï¼Œæ˜¯ä¸ªbugï¼Œå…·ä½“å¯è§è¿™ä¸ªissueï¼šhttps://issues.apache.org/jira/browse/STORM-805ã€‚ è¿™ä¸ªé—®é¢˜åœ¨0.9.5ç‰ˆæœ¬ä¸­éšç€STORM-130ä¸€èµ·ä¿®å¤äº†ï¼Œä»£ç å¦‚ä¸‹ï¼š ä½†è¿™é‡Œæœ‰ä¸‰ä¸ªé—®é¢˜ï¼š åœ¨è°ƒç”¨download-storm-codeæ–¹æ³•å‰ï¼Œä»£ç ä¸­å·²åšåˆ¤æ–­æ˜¯å¦å·²ä¸‹è½½topologyä»£ç ï¼Œè‹¥å·²ä¸‹è½½å°±ä¸ä¼šè°ƒç”¨download-storm-codeæ–¹æ³•äº†ã€‚ä¸ºä½•è¿›å…¥è¿™ä¸ªæ–¹æ³•åï¼Œåšmove directoryæ“ä½œæ—¶ï¼Œä»£ç å´å·²ç»ä¸‹è½½å¥½äº†å‘¢ï¼Ÿ stormçš„å†å²å‘å¸ƒç‰ˆæœ¬æœ‰å¾ˆå¤šï¼Œä¸ºä½•0.9.4ç‰ˆæœ¬é‡Œä¼šå‡ºç°è¿™ä¸ªä¸è¯¥å‡ºç°çš„é—®é¢˜ï¼Œ0.9.4ç›¸å¯¹è€çš„ç‰ˆæœ¬æ˜¯ä¸æ˜¯åšäº†ä»€ä¹ˆä¿®æ”¹ï¼Ÿ ä¸ºä½•æŠ›å‡ºå¼‚å¸¸åï¼Œsupervisorè¿›ç¨‹å°±è¿™ä¹ˆç›´æ¥é€€å‡ºäº†ï¼Ÿå¤ªå¼±äº†å§ã€‚ã€‚","keywords":null,"text":"é—®é¢˜å‡ºç° æµ‹è¯•stormé›†ç¾¤ä¸º0.9.4ç‰ˆæœ¬ï¼Œå‰æ®µæ—¶é—´å‡ºç°supervisorè¿›ç¨‹æŒ‚æ‰ï¼Œè€Œå…¶ä¸Šworkè¿›ç¨‹ä»ç„¶è¿è¡Œçš„è¯¡å¼‚æƒ…å†µï¼Œé€šè¿‡æ—¥å¿—çœ‹åˆ°supervisorè¿›ç¨‹æŒ‚æ‰ä¹‹å‰å‡ºç°ä»¥ä¸‹å¼‚å¸¸ï¼š é—®é¢˜æ’æŸ¥è¿‡ç¨‹ å¾ˆæ˜æ˜¾ï¼Œæ˜¯commons-ioåŒ…çš„FileUtilså·¥å…·ç±»æŠ›å‡ºçš„å¼‚å¸¸ï¼ŒåŸå› æ˜¯åœ¨è°ƒç”¨commons-ioåŒ…çš„FileUtilså·¥å…·ç±»åšmove directoryæ“ä½œæ—¶ï¼Œç›®çš„æ–‡ä»¶å¤¹å·²å­˜åœ¨ã€‚ æŸ¥çœ‹è°ƒç”¨ä»£ç ï¼ˆsupervisor.cljçš„ç¬¬374è¡Œï¼‰ï¼Œæ˜¯è°ƒç”¨download-storm-codeæ–¹æ³•ä»nimbusä¸‹è½½topologyçš„ä»£ç ï¼Œå¹¶ä¸”download-storm-codeæ–¹æ³•ä¸­åšä»£ç ä¸‹è½½å‰åŠ äº†é”é¿å…å¹¶å‘å†™æ–‡ä»¶ã€‚ æœç„¶ï¼Œè¿™é‡Œæ²¡æœ‰åˆ¤æ–­stormrootæ–‡ä»¶å¤¹æ˜¯å¦å·²å­˜åœ¨ï¼Œæ˜¯ä¸ªbugï¼Œå…·ä½“å¯è§è¿™ä¸ªissueï¼šhttps://issues.apache.org/jira/browse/STORM-805ã€‚ è¿™ä¸ªé—®é¢˜åœ¨0.9.5ç‰ˆæœ¬ä¸­éšç€STORM-130ä¸€èµ·ä¿®å¤äº†ï¼Œä»£ç å¦‚ä¸‹ï¼š ä½†è¿™é‡Œæœ‰ä¸‰ä¸ªé—®é¢˜ï¼š åœ¨è°ƒç”¨download-storm-codeæ–¹æ³•å‰ï¼Œä»£ç ä¸­å·²åšåˆ¤æ–­æ˜¯å¦å·²ä¸‹è½½topologyä»£ç ï¼Œè‹¥å·²ä¸‹è½½å°±ä¸ä¼šè°ƒç”¨download-storm-codeæ–¹æ³•äº†ã€‚ä¸ºä½•è¿›å…¥è¿™ä¸ªæ–¹æ³•åï¼Œåšmove directoryæ“ä½œæ—¶ï¼Œä»£ç å´å·²ç»ä¸‹è½½å¥½äº†å‘¢ï¼Ÿ stormçš„å†å²å‘å¸ƒç‰ˆæœ¬æœ‰å¾ˆå¤šï¼Œä¸ºä½•0.9.4ç‰ˆæœ¬é‡Œä¼šå‡ºç°è¿™ä¸ªä¸è¯¥å‡ºç°çš„é—®é¢˜ï¼Œ0.9.4ç›¸å¯¹è€çš„ç‰ˆæœ¬æ˜¯ä¸æ˜¯åšäº†ä»€ä¹ˆä¿®æ”¹ï¼Ÿ ä¸ºä½•æŠ›å‡ºå¼‚å¸¸åï¼Œsupervisorè¿›ç¨‹å°±è¿™ä¹ˆç›´æ¥é€€å‡ºäº†ï¼Ÿå¤ªå¼±äº†å§ã€‚ã€‚ ç»§ç»­çœ‹0.9.4çš„æºç å‘ç°ï¼Œsupervisorä¸­æœ‰ä»¥ä¸‹ä¸¤ä¸ªäº‹ä»¶çº¿ç¨‹ï¼Œéƒ½ä¼šè°ƒç”¨download-storm-codeæ–¹æ³•ï¼š ä¸€ä¸ªæ˜¯synchronize-supervisorï¼Œç”¨äºåŒæ­¥nimbusä»»åŠ¡ï¼Œæ¯éš”10ç§’æ‰§è¡Œä¸€æ¬¡ï¼Œä¼šè°ƒç”¨mk-synchronize-supervisoræ–¹æ³•ï¼Œä»¥åŠæ—¶è·å–nimbusåˆ†é…ç»™è¯¥supervisorçš„æ–°ä»»åŠ¡å¹¶ç§»é™¤å·²åˆ†é…ä½†ä¸å†éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡ã€‚ å¦ä¸€ä¸ªæ˜¯sync-processesï¼Œç”¨äºæ ¹æ®ä»»åŠ¡å˜åŒ–åŒæ­¥ç®¡ç†workerè¿›ç¨‹ï¼Œæ‰§è¡Œå‘¨æœŸç”±SUPERVISOR-MONITOR-FREQUENCY-SECSï¼ˆé»˜è®¤3ç§’ï¼‰æŒ‡å®šï¼Œä¼šè°ƒç”¨sync-processesæ–¹æ³•ï¼Œä»¥å…³é—­å½“å‰ä¸å¤„äºvalidçŠ¶æ€çš„workerå’Œå¯åŠ¨æ–°åˆ†é…ç»™è¯¥supervisorçš„workerã€‚ å…¶ä¸­ï¼Œmk-synchronize-supervisoræ–¹æ³•å’Œsync-processesæ–¹æ³•éƒ½ä¼šè°ƒç”¨download-storm-codeæ–¹æ³•ã€‚ ä¸¤ä¸ªäº‹ä»¶çº¿ç¨‹çš„å®šä¹‰ï¼š mk-synchronize-supervisoræ–¹æ³•è°ƒç”¨download-storm-codeæ–¹æ³•ï¼š sync-processesè°ƒç”¨download-storm-codeæ–¹æ³•ï¼š mk-synchronize-supervisoræ–¹æ³•å’Œsync-processesæ–¹æ³•åœ¨è°ƒç”¨å‰éƒ½ä¼šåˆ¤æ–­topologyä»£ç æ˜¯å¦å·²ä¸‹è½½ï¼Œæ‰€ä»¥ï¼Œå‡ºç°ä¸Šè¿°å¼‚å¸¸çš„åŸå› å¾ˆå¯èƒ½æ˜¯ä¸¤ä¸ªçº¿ç¨‹å†è°ƒç”¨download-storm-codeæ–¹æ³•æ—¶ä¸åŒæ­¥å¼•èµ·çš„ï¼Œå³åŒæ—¶åˆ¤æ–­åˆ°éœ€è¦ä¸‹è½½topologyä»£ç å¹¶è¿›å…¥äº†download-storm-codeæ–¹æ³•ï¼Œä»è€Œäº§ç”Ÿä¸¤æ¬¡move directoryçš„æ“ä½œå¼•å‘å¼‚å¸¸ã€‚ è™½ç„¶download-storm-codeæ–¹æ³•å†…éƒ¨é€šè¿‡åŠ é”æ§åˆ¶äº†å†™æ–‡ä»¶æ—¶çš„å¹¶å‘ï¼Œä½†å¯¹è¿›å…¥download-storm-codeæ–¹æ³•å¹¶æ²¡æœ‰åšå¥½åŒæ­¥ã€‚ å†å›è¿‡å¤´çœ‹0.9.5ç‰ˆæœ¬çš„ä»£ç ï¼Œè™½ç„¶åœ¨move directoryå‰åˆ¤æ–­äº†ç›®çš„æ–‡ä»¶å¤¹æ˜¯å¦å­˜åœ¨ä»¥é¿å…é—®é¢˜ï¼Œä½†å®é™…ä¸Šè¿˜æ˜¯å­˜åœ¨ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶è¿›å…¥download-storm-codeæ–¹æ³•çš„é—®é¢˜ã€‚ æœ€åå†æ¯”è¾ƒäº†ä¸‹0.9.3å’Œ0.9.4çš„ä»£ç ï¼ˆsupervisor.cljï¼‰ï¼Œå‘ç°0.9.4çš„sync-processesæ–¹æ³•ä¸­è°ƒç”¨download-storm-codeçš„é€»è¾‘æ˜¯æ–°åŠ è¿›å»çš„ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªbugæ˜¯0.9.4æ–°å¼•å…¥çš„ï¼Œä»¥å‰çš„ç‰ˆæœ¬ä¸ä¼šå­˜åœ¨è¿™ä¸ªé—®é¢˜ã€‚ å·¦è¾¹ä¸º0.9.3ï¼Œå³è¾¹ä¸º0.9.4ï¼š å…³äºç¬¬3ä¸ªé—®é¢˜ï¼Œå†å›çœ‹å®šä¹‰synchronize-supervisoräº‹ä»¶çº¿ç¨‹çš„ä»£ç ï¼Œæ˜¯é€šè¿‡äº‹ä»¶ç®¡ç†å™¨event-manageræ¥å®ç°çš„ï¼ŒæŸ¥çœ‹event.cljä¸­çš„å®ç°ï¼Œevent-managerä¼šä»ä¸€ä¸ªLinkedBlockingQueueå–å‡ºæ–°äº‹ä»¶å¹¶å¯åŠ¨çº¿ç¨‹å¤„ç†ï¼Œçº¿ç¨‹è‹¥æŠ›å‡ºéInterruptedå¼‚å¸¸ï¼Œåˆ™ç›´æ¥é€€å‡ºè¿›ç¨‹äº†ã€‚ è‡³æ­¤ï¼Œé—®é¢˜åˆ†æå®Œæ¯•ã€‚","raw":null,"content":null,"categories":[{"name":"Storm","slug":"Storm","permalink":"https://maohong.github.io/categories/Storm/"}],"tags":[{"name":"storm","slug":"storm","permalink":"https://maohong.github.io/tags/storm/"},{"name":"supervisor","slug":"supervisor","permalink":"https://maohong.github.io/tags/supervisor/"},{"name":"å¼‚å¸¸æ’æŸ¥","slug":"å¼‚å¸¸æ’æŸ¥","permalink":"https://maohong.github.io/tags/%E5%BC%82%E5%B8%B8%E6%8E%92%E6%9F%A5/"}]},{"title":"äº¤æ¢ç©ºé—´ä½¿ç”¨ç‡è¿‡é«˜é—®é¢˜åˆ†æ","slug":"äº¤æ¢ç©ºé—´ä½¿ç”¨ç‡è¿‡é«˜é—®é¢˜åˆ†æ","date":"2017-06-22T02:02:04.000Z","updated":"2017-06-22T02:02:04.000Z","comments":true,"path":"20170622/äº¤æ¢ç©ºé—´ä½¿ç”¨ç‡è¿‡é«˜é—®é¢˜åˆ†æ/","permalink":"https://maohong.github.io/20170622/%E4%BA%A4%E6%8D%A2%E7%A9%BA%E9%97%B4%E4%BD%BF%E7%94%A8%E7%8E%87%E8%BF%87%E9%AB%98%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90/","excerpt":"é—®é¢˜ç°è±¡ çº¿ä¸Šä¸¤å°javaåå°æœåŠ¡æ¯æ¬¡ä¸Šçº¿åå†è¿‡æ®µæ—¶é—´ï¼Œå°±å‡ºç°swapç©ºé—´ä½¿ç”¨ç‡è¾ƒé«˜çš„ç°è±¡ï¼Œè€Œjvmå†…å­˜ä½¿ç”¨å’Œåƒåœ¾å›æ”¶æƒ…å†µåˆ™å¾ˆæ­£å¸¸ã€‚ç›¸å…³å›¾è¡¨å¦‚ä¸‹ï¼š å›¾ä¸­ï¼Œæ¯æ¬¡ä¸Šçº¿åè¿‡ä¸€æ®µæ—¶é—´ï¼Œswapç©ºé—´ä½¿ç”¨é‡ä¼šå‡ºç°ä¸€ä¸ªé™¡å¢ï¼Œå¹¶éšæ—¶é—´æ¨ç§»é€æ¸å¢åŠ ï¼ŒæœŸé—´ä¼šå‡ºç°å°å¹…åº¦ä¸‹é™ã€‚ é¦–å…ˆï¼Œä»æ“ä½œç³»ç»Ÿå±‚é¢åˆ†æï¼Œswapç©ºé—´ä½¿ç”¨è¾ƒé«˜ï¼Œè¯´æ˜æ˜¯ç³»ç»Ÿç‰©ç†å†…å­˜ä¸å¤Ÿç”¨ä»è€Œå‘ç”Ÿå†…å­˜é¡µäº¤æ¢ï¼Œå°†éƒ¨åˆ†å†…å­˜æ•°æ®æ¬è‡³è™šæ‹Ÿå†…å­˜ç©ºé—´ï¼Œä¹Ÿå°±æ˜¯swapç©ºé—´ã€‚ä½†ç©¶ç«Ÿæ˜¯ä»€ä¹ˆåŸå› å¼•èµ·ç‰©ç†å†…å­˜ä¸è¶³å‘¢ï¼Ÿå› ä¸ºJvmå †å¤§å°æ˜¯å›ºå®šçš„ï¼Œæ‰€ä»¥æ¨æ–­æ˜¯å› å †å¤–å†…å­˜å ç”¨ç©ºé—´è¾ƒå¤§å¼•èµ·ã€‚ äºæ˜¯ï¼Œä½¿ç”¨jmap -histo:live æŠŠè¿›ç¨‹ä¸­çš„å¯¹è±¡ä¿¡æ¯dumpå‡ºæ¥ï¼Œdumpä¿¡æ¯å¦‚ä¸‹ï¼š ç¡®å®å‘ç°å­˜åœ¨å¤§é‡DirectByteBufferå¯¹è±¡ï¼Œè¿™è¯´æ˜å†…å­˜ä¸­ç¡®å®æœ‰å¤§é‡å¼•ç”¨äº†å †å¤–å†…å­˜çš„å¯¹è±¡æ²¡æœ‰è¢«å›æ”¶ï¼ åŒæ—¶ï¼Œå†…å­˜ä¸­ä¹Ÿå¯¹åº”å­˜åœ¨ç€å¤§é‡çš„sun.misc.Cleanerå’Œjava.nio.DirectByteBuffer$Deallocatorå¯¹è±¡ã€‚è¿™ä¸¤ä¸ªç±»æ˜¯ç”¨äºå›æ”¶å †å¤–å†…å­˜çš„ã€‚Cleanerå¯¹è±¡æ˜¯åœ¨DirectByteBufferçš„æ„é€ å‡½æ•°ä¸­åˆ›å»ºï¼Œå…¶ä¸­å°è£…äº†å›æ”¶å †å¤–å†…å­˜çš„é€»è¾‘ï¼ŒCleaneræ‰§è¡Œcleanèµ„æºçš„æ“ä½œæ˜¯é€šè¿‡å¯åŠ¨Deallocatorçº¿ç¨‹å®ç°çš„ï¼Œè¿™ä¸ªçº¿ç¨‹æŠŠDirectByteBufferå¯¹è±¡å¼•ç”¨çš„å †å¤–å†…å­˜åšå›æ”¶ã€‚ é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼š ä¸ºä»€ä¹ˆDirectByteBufferå¯¹è±¡æ²¡æœ‰è¢«å›æ”¶ï¼Ÿ æ€ä¹ˆåšæ‰èƒ½è®©DirectByteBufferå¯¹è±¡èƒ½è¢«åŠæ—¶å›æ”¶ï¼Ÿ é—®é¢˜åˆ†æ","keywords":null,"text":"é—®é¢˜ç°è±¡ çº¿ä¸Šä¸¤å°javaåå°æœåŠ¡æ¯æ¬¡ä¸Šçº¿åå†è¿‡æ®µæ—¶é—´ï¼Œå°±å‡ºç°swapç©ºé—´ä½¿ç”¨ç‡è¾ƒé«˜çš„ç°è±¡ï¼Œè€Œjvmå†…å­˜ä½¿ç”¨å’Œåƒåœ¾å›æ”¶æƒ…å†µåˆ™å¾ˆæ­£å¸¸ã€‚ç›¸å…³å›¾è¡¨å¦‚ä¸‹ï¼š å›¾ä¸­ï¼Œæ¯æ¬¡ä¸Šçº¿åè¿‡ä¸€æ®µæ—¶é—´ï¼Œswapç©ºé—´ä½¿ç”¨é‡ä¼šå‡ºç°ä¸€ä¸ªé™¡å¢ï¼Œå¹¶éšæ—¶é—´æ¨ç§»é€æ¸å¢åŠ ï¼ŒæœŸé—´ä¼šå‡ºç°å°å¹…åº¦ä¸‹é™ã€‚ é¦–å…ˆï¼Œä»æ“ä½œç³»ç»Ÿå±‚é¢åˆ†æï¼Œswapç©ºé—´ä½¿ç”¨è¾ƒé«˜ï¼Œè¯´æ˜æ˜¯ç³»ç»Ÿç‰©ç†å†…å­˜ä¸å¤Ÿç”¨ä»è€Œå‘ç”Ÿå†…å­˜é¡µäº¤æ¢ï¼Œå°†éƒ¨åˆ†å†…å­˜æ•°æ®æ¬è‡³è™šæ‹Ÿå†…å­˜ç©ºé—´ï¼Œä¹Ÿå°±æ˜¯swapç©ºé—´ã€‚ä½†ç©¶ç«Ÿæ˜¯ä»€ä¹ˆåŸå› å¼•èµ·ç‰©ç†å†…å­˜ä¸è¶³å‘¢ï¼Ÿå› ä¸ºJvmå †å¤§å°æ˜¯å›ºå®šçš„ï¼Œæ‰€ä»¥æ¨æ–­æ˜¯å› å †å¤–å†…å­˜å ç”¨ç©ºé—´è¾ƒå¤§å¼•èµ·ã€‚ äºæ˜¯ï¼Œä½¿ç”¨jmap -histo:live æŠŠè¿›ç¨‹ä¸­çš„å¯¹è±¡ä¿¡æ¯dumpå‡ºæ¥ï¼Œdumpä¿¡æ¯å¦‚ä¸‹ï¼š ç¡®å®å‘ç°å­˜åœ¨å¤§é‡DirectByteBufferå¯¹è±¡ï¼Œè¿™è¯´æ˜å†…å­˜ä¸­ç¡®å®æœ‰å¤§é‡å¼•ç”¨äº†å †å¤–å†…å­˜çš„å¯¹è±¡æ²¡æœ‰è¢«å›æ”¶ï¼ åŒæ—¶ï¼Œå†…å­˜ä¸­ä¹Ÿå¯¹åº”å­˜åœ¨ç€å¤§é‡çš„sun.misc.Cleanerå’Œjava.nio.DirectByteBuffer$Deallocatorå¯¹è±¡ã€‚è¿™ä¸¤ä¸ªç±»æ˜¯ç”¨äºå›æ”¶å †å¤–å†…å­˜çš„ã€‚Cleanerå¯¹è±¡æ˜¯åœ¨DirectByteBufferçš„æ„é€ å‡½æ•°ä¸­åˆ›å»ºï¼Œå…¶ä¸­å°è£…äº†å›æ”¶å †å¤–å†…å­˜çš„é€»è¾‘ï¼ŒCleaneræ‰§è¡Œcleanèµ„æºçš„æ“ä½œæ˜¯é€šè¿‡å¯åŠ¨Deallocatorçº¿ç¨‹å®ç°çš„ï¼Œè¿™ä¸ªçº¿ç¨‹æŠŠDirectByteBufferå¯¹è±¡å¼•ç”¨çš„å †å¤–å†…å­˜åšå›æ”¶ã€‚ é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼š ä¸ºä»€ä¹ˆDirectByteBufferå¯¹è±¡æ²¡æœ‰è¢«å›æ”¶ï¼Ÿ æ€ä¹ˆåšæ‰èƒ½è®©DirectByteBufferå¯¹è±¡èƒ½è¢«åŠæ—¶å›æ”¶ï¼Ÿ é—®é¢˜åˆ†æ å…ˆçœ‹äº†ä¸‹å¯åŠ¨jvmå‚æ•°ä¸º-Xmn8192M -Xms13312M -Xmx13312M -XX:PermSize=512m -XX:MaxPermSize=512mï¼Œå¾ˆæ˜æ˜¾ï¼Œæ–°ç”Ÿä»£ç©ºé—´é…çš„å¤ªå¤§ï¼ŒåŒæ—¶ï¼Œä¹Ÿæ²¡æœ‰æŒ‡å®šå †å¤–å†…å­˜çš„æœ€å¤§ç©ºé—´ï¼ˆ-XX:MaxDirectMemorySizeï¼‰ï¼Œè¿™ä¸ªå‚æ•°æ²¡è®¾ç½®åˆ™é»˜è®¤ç­‰äº-Xmxï¼Œç„¶è€ŒæœåŠ¡å™¨æ€»å†…å­˜åªæœ‰16Gï¼Œæ‰€ä»¥æ—¶é—´é•¿äº†å¾ˆå¯èƒ½ä¼šå‘ç”Ÿå †å¤–å†…å­˜æº¢å‡ºï¼ å› ä¸ºæ­¤æœåŠ¡æ˜¯kafkaé›†ç¾¤çš„æ¶ˆè´¹è€…ï¼Œæ¯å¤©æ¥æ”¶çš„æŠ¥æ–‡é‡åœ¨1äº¿ä»¥ä¸Šï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­äº§ç”Ÿäº†å¤§é‡çš„DirectByteBufferå¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡ç›´æ¥å¼•ç”¨å †å¤–å†…å­˜ï¼Œè€ŒåŒæ—¶ï¼Œè¿™äº›ä¸´æ—¶å¯¹è±¡ä¹Ÿä¼šè¢«å›æ”¶ï¼Œç”±äºæ–°ç”Ÿä»£ç©ºé—´é…çš„å¾ˆå¤§ï¼Œè§¦å‘minor GCçš„é¢‘ç‡ä¸å¤Ÿé«˜ï¼Œä»è€Œä¸èƒ½åŠæ—¶é‡Šæ”¾å·²è¢«å ç”¨çš„å †å¤–å†…å­˜ï¼Œéšç€æ—¶é—´çš„æ¨ç§»ï¼Œè¿›ç¨‹å¯åŠ¨è¿‡ä¸€æ®µæ—¶é—´åï¼Œå †å¤–å†…å­˜å ç”¨è¶Šæ¥è¶Šå¤šï¼Œæœ€ç»ˆè¢«OSäº¤æ¢åˆ°swapç©ºé—´ã€‚ è§£å†³æ–¹æ¡ˆ è°ƒæ•´jvmå‚æ•°ï¼Œå‡å°‘æ–°ç”Ÿä»£å¤§å°ä¸ºjvmå †ç©ºé—´çš„3/8ï¼Œå¹¶æŒ‡å®šå †å¤–å†…å­˜å¤§å°ï¼Œè°ƒæ•´åçš„jvmå‚æ•°ä¸º-Xmn3840M -Xms10240M -Xmx10240M -XX:PermSize=512m -XX:MaxPermSize=512m -XX:MaxDirectMemorySize=4096m è°ƒæ•´åï¼Œswapç©ºé—´å ç”¨æƒ…å†µæœ‰æ‰€å¥½è½¬ï¼Œä½†ä¾ç„¶å ç”¨2Gå·¦å³ï¼å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ 4æœˆ21æ—¥è°ƒæ•´å‚æ•°é‡å¯æœåŠ¡åï¼Œåœ¨ç›¸å½“é•¿çš„ä¸€æ®µæ—¶é—´å†…ï¼Œswapç©ºé—´å ç”¨ç‡æä½ï¼Œä½†åœ¨5æœˆ2æ—¥åˆå‡ºç°swapç©ºé—´ä½¿ç”¨ç‡ä¸Šå‡çš„æƒ…å†µã€‚ç»§ç»­çœ‹äº†ä¸‹jvmå †ç©ºé—´ä½¿ç”¨æƒ…å†µå’Œfull gcæƒ…å†µï¼Œå¦‚ä¸‹ï¼š ç»“åˆä¸Šé¢ä¸¤å¼ å›¾ï¼Œå¯è§young gcè¾ƒå¤šï¼Œjvmå †ç©ºé—´æ•´ä½“ä½¿ç”¨ç‡ç¨³æ­¥ä¸Šå‡ï¼Œåœ¨5æœˆ2æ—¥ä¸5æœˆ8æ—¥å‘ç”Ÿäº†ä¸¤æ¬¡full gcï¼Œå¹¶ä¸”æ¯æ¬¡å‘ç”Ÿfullgcåï¼Œjvmå †ç©ºé—´ä½¿ç”¨ç‡ä¸‹é™è¾ƒå¤šï¼Œswapç©ºé—´ä½¿ç”¨é‡åªæœ‰å°èŒƒå›´ä¸‹é™ã€‚è¿™è¯´æ˜æœ‰ä¸€éƒ¨åˆ†DirectByteBufferå¯¹è±¡åœ¨fullgcé˜¶æ®µåšäº†å›æ”¶ï¼Œä½†ä¾ç„¶æœ‰å¾ˆå¤šDirectByteBufferå¯¹è±¡æ²¡æœ‰è¢«å›æ”¶ï¼Œä»ç„¶å ç”¨ç€å †å¤–å†…å­˜ã€‚ é€‰æ‹©ä¸€å°æœºå™¨ï¼Œç»§ç»­å‡å°å…¶å †ç©ºé—´ï¼Œjvmå‚æ•°ä¸º-Xmn2048M -Xms6144M -Xmx6144M -XX:PermSize=512m -XX:MaxPermSize=512m -XX:MaxDirectMemorySize=4096mï¼Œç»è¿‡ä¸€æ®µæ—¶é—´è§‚å¯Ÿï¼Œäº¤æ¢ç©ºé—´ä½¿ç”¨ç‡å¾ˆä½ï¼Œåº”è¯¥æ²¡å†å‘ç”Ÿå†…å­˜é¡µäº¤æ¢äº†ï¼ŒåŒæ—¶gcé¢‘ç‡å˜é«˜ï¼Œjvmå †ç©ºé—´çš„ä½¿ç”¨ç‡åœ¨æ­£å¸¸èŒƒå›´ï¼Œè¯´æ˜DirectByteBufferå¯¹è±¡è¢«æ›´åŠæ—¶çš„å›æ”¶äº†ã€‚ ç”±æ­¤å¯è§ï¼Œswapç©ºé—´å ç”¨ç‡é«˜çš„åŸå› ä¸»è¦è¿˜æ˜¯JVMå †ç©ºé—´å¤ªé«˜å¯¼è‡´çš„å †å¤–å†…å­˜å›æ”¶ä¸åŠæ—¶ã€‚ é—ç•™é—®é¢˜ çœ‹äº†ä¸‹kafka-clientçš„æºç ï¼Œæ¥å—æ¶ˆæ¯æ—¶ä½¿ç”¨çš„æ˜¯ByteBufferï¼Œå¹¶æ²¡æœ‰ä½¿ç”¨DirectByteBufferï¼Œæ‰€ä»¥å¾ˆå¥‡æ€ªï¼Œè¿™äº›å¤§é‡çš„DirectByteBufferå¯¹è±¡æ˜¯ä»å“ªç”Ÿæˆçš„ï¼Ÿå“ªé‡Œç”¨åˆ°çš„ï¼Ÿ è¿è¡Œå‘½ä»¤jmap -dump:live,format=b,file=/data/server.dump ï¼Œdumpå‡ºå†…å­˜å¿«ç…§ï¼Œå¹¶ç”¨eclipse matåˆ†æåï¼Œå‘ç°æ˜¯zkclientä¸­çš„ä¸€ä¸ªåœ°æ–¹ç”¨çš„ï¼Œç”±äºdumpå‡ºçš„è¿™ä¸ªå¿«ç…§æ˜¯é—®é¢˜è§£å†³åçš„å†…å­˜å¿«ç…§ï¼Œæ‰€ä»¥å¹¶ä¸èƒ½è¯´æ˜é—®é¢˜ï¼Œå¦‚æœè¦æ‰¾åˆ°æ ¹æœ¬åŸå› ï¼Œè¿˜æ˜¯éœ€è¦å¤ç°swapç©ºé—´è¿‡é«˜çš„åœºæ™¯ï¼Œå†åšå†…å­˜å¿«ç…§çš„dumpã€‚","raw":null,"content":null,"categories":[{"name":"é—®é¢˜åˆ†æ","slug":"é—®é¢˜åˆ†æ","permalink":"https://maohong.github.io/categories/%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90/"}],"tags":[{"name":"swapåˆ†åŒº","slug":"swapåˆ†åŒº","permalink":"https://maohong.github.io/tags/swap%E5%88%86%E5%8C%BA/"},{"name":"é—®é¢˜åˆ†æ","slug":"é—®é¢˜åˆ†æ","permalink":"https://maohong.github.io/tags/%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90/"},{"name":"jvmè°ƒä¼˜","slug":"jvmè°ƒä¼˜","permalink":"https://maohong.github.io/tags/jvm%E8%B0%83%E4%BC%98/"}]},{"title":"Stormçš„æ¶ˆæ¯å¯é å¤„ç†æœºåˆ¶","slug":"Stormçš„æ¶ˆæ¯å¯é å¤„ç†æœºåˆ¶","date":"2017-02-05T12:51:50.000Z","updated":"2017-02-05T12:51:50.000Z","comments":true,"path":"20170205/Stormçš„æ¶ˆæ¯å¯é å¤„ç†æœºåˆ¶/","permalink":"https://maohong.github.io/20170205/Storm%E7%9A%84%E6%B6%88%E6%81%AF%E5%8F%AF%E9%9D%A0%E5%A4%84%E7%90%86%E6%9C%BA%E5%88%B6/","excerpt":"ç®€ä»‹ æäº¤è¿›å…¥Stormè¿è¡Œçš„topologyå®é™…ä¸Šæ˜¯ä¸€ä¸ªæœ‰å‘æ— ç¯å›¾ï¼ˆDAGï¼‰ï¼Œå…¶ä¸­çš„èŠ‚ç‚¹æ˜¯ç”±spoutå’Œboltç»„æˆï¼Œè¾¹åˆ™å¯ä»¥ç†è§£ä¸ºæ¶ˆæ¯ä»ä¸€ä¸ªèŠ‚ç‚¹åˆ°ä¼ è¾“åˆ°å¦ä¸€ä¸ªèŠ‚ç‚¹çš„è¿‡ç¨‹ã€‚å¯¹äºspoutäº§ç”Ÿçš„tupleï¼Œåªæœ‰åœ¨topologyä¸Šå¤„ç†å®Œæ¯•åï¼Œæ‰è®¤ä¸ºè¿™ä¸ªtupleè¢«stormå¯é å¤„ç†ã€‚ Stormæä¾›äº†å¯é å¤„ç†æ¶ˆæ¯ï¼ˆstormä¸­çš„é€šç”¨åå«tupleï¼‰çš„æ¡†æ¶ï¼Œæˆ‘ä»¬åœ¨å†™ä¸€ä¸ªtopologyç¨‹åºæ—¶ï¼Œè‹¥éœ€è¦ä¿è¯spoutäº§ç”Ÿçš„æ¶ˆæ¯çš„å¯é å¤„ç†ï¼Œéœ€è¦åšåˆ°ä¸¤ç‚¹ï¼š ç¬¬ä¸€æ˜¯spout/boltæ¯ç”Ÿæˆä¸€ä¸ªæ–°çš„tupleéƒ½å‘Šè¯‰stormä¸€ä¸‹ï¼ˆå…¶ä¸­spoutå‘å‡ºçš„tupleæœ‰ä¸ªidå«rootIdï¼‰ï¼Œä»è€Œè®©stormèƒ½å¤Ÿè¿½è¸ªrootIdå’Œæ¯ä¸ªè¡ç”Ÿtupleçš„å¤„ç†çŠ¶æ€ã€‚ ç¬¬äºŒæ˜¯æ¯ä¸ªtupleè¢«ä¸‹æ¸¸boltå¤„ç†å®Œæ¯•åï¼Œæ— è®ºå¤„ç†æˆåŠŸæˆ–å¤±è´¥ï¼Œä¹Ÿå†å‘Šè¯‰stormä¸€ä¸‹ï¼Œä»è€Œè®©stormçŸ¥é“æ˜¯å¦éœ€è¦spouté‡æ–°å‘é€rootIdã€‚ åšäº†è¿™ä¸¤ä»¶äº‹ï¼Œstormå°±èƒ½çŸ¥é“è¿™ä¸ªtupleæ˜¯å¦è¢«å¤„ç†å®Œæ¯•ã€‚å¦‚æœæ˜¯å¤„ç†æˆåŠŸäº†çš„ï¼Œå°±è¯´æ˜æœ€åˆä»spoutå‘å‡ºçš„tupleï¼ˆrootIdï¼‰å·²åœ¨topologyä¸­å¤„ç†å®Œæ¯•ï¼Œæ— éœ€spouté‡æ–°å‘é€ã€‚å¦‚æœæ˜¯å¤„ç†å¤±è´¥çš„ï¼Œstormåˆ™ä¼šå‘ŠçŸ¥spouté‡æ–°å‘é€rootIdè¿™ä¸ªtupleã€‚ åœ¨ç¨‹åºä¸­å®ç°æ¶ˆæ¯å¯é å¤„ç† é‚£åœ¨å†™ä¸€ä¸ªtopologyæ—¶ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•åšä¸Šé¢æåˆ°çš„ä¸¤ä»¶äº‹å‘¢ï¼Ÿ","keywords":null,"text":"ç®€ä»‹ æäº¤è¿›å…¥Stormè¿è¡Œçš„topologyå®é™…ä¸Šæ˜¯ä¸€ä¸ªæœ‰å‘æ— ç¯å›¾ï¼ˆDAGï¼‰ï¼Œå…¶ä¸­çš„èŠ‚ç‚¹æ˜¯ç”±spoutå’Œboltç»„æˆï¼Œè¾¹åˆ™å¯ä»¥ç†è§£ä¸ºæ¶ˆæ¯ä»ä¸€ä¸ªèŠ‚ç‚¹åˆ°ä¼ è¾“åˆ°å¦ä¸€ä¸ªèŠ‚ç‚¹çš„è¿‡ç¨‹ã€‚å¯¹äºspoutäº§ç”Ÿçš„tupleï¼Œåªæœ‰åœ¨topologyä¸Šå¤„ç†å®Œæ¯•åï¼Œæ‰è®¤ä¸ºè¿™ä¸ªtupleè¢«stormå¯é å¤„ç†ã€‚ Stormæä¾›äº†å¯é å¤„ç†æ¶ˆæ¯ï¼ˆstormä¸­çš„é€šç”¨åå«tupleï¼‰çš„æ¡†æ¶ï¼Œæˆ‘ä»¬åœ¨å†™ä¸€ä¸ªtopologyç¨‹åºæ—¶ï¼Œè‹¥éœ€è¦ä¿è¯spoutäº§ç”Ÿçš„æ¶ˆæ¯çš„å¯é å¤„ç†ï¼Œéœ€è¦åšåˆ°ä¸¤ç‚¹ï¼š ç¬¬ä¸€æ˜¯spout/boltæ¯ç”Ÿæˆä¸€ä¸ªæ–°çš„tupleéƒ½å‘Šè¯‰stormä¸€ä¸‹ï¼ˆå…¶ä¸­spoutå‘å‡ºçš„tupleæœ‰ä¸ªidå«rootIdï¼‰ï¼Œä»è€Œè®©stormèƒ½å¤Ÿè¿½è¸ªrootIdå’Œæ¯ä¸ªè¡ç”Ÿtupleçš„å¤„ç†çŠ¶æ€ã€‚ ç¬¬äºŒæ˜¯æ¯ä¸ªtupleè¢«ä¸‹æ¸¸boltå¤„ç†å®Œæ¯•åï¼Œæ— è®ºå¤„ç†æˆåŠŸæˆ–å¤±è´¥ï¼Œä¹Ÿå†å‘Šè¯‰stormä¸€ä¸‹ï¼Œä»è€Œè®©stormçŸ¥é“æ˜¯å¦éœ€è¦spouté‡æ–°å‘é€rootIdã€‚ åšäº†è¿™ä¸¤ä»¶äº‹ï¼Œstormå°±èƒ½çŸ¥é“è¿™ä¸ªtupleæ˜¯å¦è¢«å¤„ç†å®Œæ¯•ã€‚å¦‚æœæ˜¯å¤„ç†æˆåŠŸäº†çš„ï¼Œå°±è¯´æ˜æœ€åˆä»spoutå‘å‡ºçš„tupleï¼ˆrootIdï¼‰å·²åœ¨topologyä¸­å¤„ç†å®Œæ¯•ï¼Œæ— éœ€spouté‡æ–°å‘é€ã€‚å¦‚æœæ˜¯å¤„ç†å¤±è´¥çš„ï¼Œstormåˆ™ä¼šå‘ŠçŸ¥spouté‡æ–°å‘é€rootIdè¿™ä¸ªtupleã€‚ åœ¨ç¨‹åºä¸­å®ç°æ¶ˆæ¯å¯é å¤„ç† é‚£åœ¨å†™ä¸€ä¸ªtopologyæ—¶ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•åšä¸Šé¢æåˆ°çš„ä¸¤ä»¶äº‹å‘¢ï¼Ÿ Stormæä¾›äº†BaseRichBoltæŠ½è±¡ç±»ï¼ˆå®ç°äº†IRichBoltæ¥å£ï¼‰ï¼Œä¸€ä¸ªç¤ºä¾‹boltå¦‚ä¸‹ï¼š 1234567891011121314151617181920public class SplitSentence extends BaseRichBolt { OutputCollector _collector; public void prepare(Map conf, TopologyContext context, OutputCollector collector) { _collector = collector; } public void execute(Tuple t) { String sentence = t.getString(0); for(String word: sentence.split(\" \")) { //1. å‘Šè¯‰stormç”Ÿæˆäº†ä¸€ä¸ªæ–°çš„tupleï¼Œå¹¶ä¸”è¿™ä¸ªtupleçš„é”šç‚¹æ˜¯tuple _collector.emit(t, new Values(word)); } _collector.ack(t); //2. å‘Šè¯‰stormï¼Œtè¿™ä¸ªtupleå·²å¤„ç†å®Œæ¯• } public void declareOutputFields(OutputFieldsDeclarer declarer) { declarer.declare(new Fields(\"word\")); }} è¿™æ®µä»£ç å°±åšäº†è¿™ä¸¤ä»¶äº‹ï¼Œä¸€æ˜¯è¾“å‡ºæ–°çš„tupleå¹¶å‘ŠçŸ¥stormï¼ŒäºŒæ˜¯å¯¹å½“å‰tuple tå¤„ç†å®Œæ¯•åï¼Œå‘ŠçŸ¥stormã€‚ å¯¹äºç¬¬ä¸€ä»¶äº‹ï¼Œè¿™é‡Œè¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨BaseRichBoltä¸­è¾“å‡ºä¸€ä¸ªæ–°çš„tupleï¼ˆç¤ºä¾‹ä¸­æ˜¯wordï¼‰æ—¶ï¼Œå¿…é¡»æŒ‡å®šå…¶é”šç‚¹ï¼ˆå³å½“å‰boltæ­£åœ¨å¤„ç†çš„tupleï¼‰ï¼Œå› ä¸ºè¾“å‡ºæ–°çš„tupleä¼šç»§ç»­è¢«ä¸‹æ¸¸boltå¤„ç†ï¼Œè¿™ä¸ªé”šç‚¹tupleå’Œä¸‹æ¸¸tupleä¹‹é—´çš„è·¯å¾„å°±æ˜¯DAGçš„ä¸€æ¡è¾¹ã€‚å¦‚æœä¸æŒ‡å®šé”šç‚¹ï¼Œåˆ™å¯ä»¥ç†è§£ä¸ºstormä¸çŸ¥é“è¿™æ¡è¾¹çš„å­˜åœ¨ï¼Œä¹Ÿå°±ä¸ä¼šå¯¹æ–°è¾“å‡ºçš„tupleè¿›è¡Œè·Ÿè¸ªäº†ã€‚ å¦‚æœæˆ‘ä»¬ç¡®å®ä¸éœ€è¦ä¿è¯æ¶ˆæ¯çš„å¯é å¤„ç†ï¼Œåˆ™ä½¿ç”¨ä»¥ä¸‹æ–¹å¼è¾“å‡ºæ–°tupleå³å¯ã€‚ 1_collector.emit(new Values(word)); å¦å¤–ï¼Œä¸€ä¸ªtupleçš„é”šç‚¹tupleå¯ä»¥æœ‰å¤šä¸ªï¼Œæ¯”å¦‚å¦‚ä¸‹ä»£ç ï¼Œæ–°è¾“å‡ºçš„tupleçš„é”šç‚¹å°±æ˜¯tuple1å’Œtuple2ã€‚ 1234List anchors = new ArrayList();anchors.add(tuple1);anchors.add(tuple2);_collector.emit(anchors, new Values(1, 2, 3)); å¯¹äºç¬¬äºŒä»¶äº‹ï¼Œé€šè¿‡è°ƒç”¨OutputCollectorçš„ackæˆ–failæ–¹æ³•ï¼Œå³å¯å‘ŠçŸ¥stormå½“å‰tupleçš„å¤„ç†ç»“æœã€‚æ¯”å¦‚ï¼Œå‡è®¾æˆ‘ä»¬åœ¨boltä¸­åšä¸€äº›æ“ä½œçš„æ—¶å€™å‡ºç°å¼‚å¸¸ï¼ˆæ¯”å¦‚è®¿é—®redisã€DBã€hdfsç­‰ï¼‰ï¼Œå¯ä»¥è°ƒfailæ–¹æ³•å¿«é€Ÿé‡æ”¾rootIdï¼Œé¿å…ç­‰åˆ°stormåˆ¤æ–­è¿™ä¸ªtupleå¤„ç†è¶…æ—¶åæ‰é‡æ”¾ã€‚ æ›´ç®€ä¾¿çš„æ–¹å¼ å¾ˆæ˜æ˜¾ï¼Œä»¥ä¸Šæ–¹å¼æœ‰å‡ ä¸ªå¼Šç«¯ï¼š è¾“å‡ºæ–°tupleå’Œå¯¹tupleçš„ack/failæ“ä½œéœ€è¦æˆ‘ä»¬è‡ªå·±ç»´æŠ¤ï¼Œä»£ä»·å¾ˆé«˜ï¼Œå®¹æ˜“é—å¿˜ã€‚ stormæ˜¯åœ¨å†…å­˜ä¸­ç»´æŠ¤æ¯ä¸ªtupleçš„å¤„ç†çŠ¶æ€ï¼Œå¦‚æœåªå¯¹tupleè¿›è¡Œé”šç‚¹æ ‡è®°ä½†å¤„ç†å®Œæ¯•åå¿˜è®°ack/failï¼Œåœ¨tupleé‡éå¸¸å¤§æ—¶ï¼Œæœ‰å†…å­˜æº¢å‡ºçš„é£é™©ã€‚ é‰´äºæ­¤ï¼Œstormæä¾›äº†BaseBasicBoltæŠ½è±¡ç±»ï¼ˆå®ç°äº†IBasicBoltæ¥å£ï¼‰æ¥å¸®åŠ©æˆ‘ä»¬å®ç°å¯¹æ¯ä¸ªtupleçš„é”šç‚¹æ ‡è®°å’Œack/failã€‚ å‰é¢çš„ä¾‹å­å¯æ”¹å†™å¦‚ä¸‹ï¼š 1234567891011public class SplitSentence extends BaseBasicBolt { public void execute(Tuple tuple, BasicOutputCollector collector) { String sentence = tuple.getString(0); for(String word: sentence.split(\" \")) { collector.emit(new Values(word)); } } public void declareOutputFields(OutputFieldsDeclarer declarer) { declarer.declare(new Fields(\"word\")); }} å¯è§ï¼Œåœ¨ä»£ç ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦å…³å¿ƒboltçš„å¤„ç†é€»è¾‘å³å¯ï¼Œè‡³äºæ ‡è®°é”šç‚¹å’Œack/failï¼Œå‡ä¸ç”¨å…³å¿ƒã€‚ ç»†ç©¶ä¸€ä¸‹stormæ¡†æ¶å¯¹IBasicBoltçš„å¤„ç†å¯çŸ¥ï¼Œåœ¨åˆ›å»ºtopologyæ—¶ï¼ŒIBasicBoltæ˜¯è¢«å°è£…åœ¨BasicBoltExecutorç±»ï¼ˆå®ç°äº†IRichBoltæ¥å£ï¼‰ä¸­å¤„ç†çš„ã€‚ æ„å»ºtopologyæ—¶çš„setBoltæ–¹æ³•ï¼š åŸç†&amp;ç¤ºä¾‹ åˆšåˆšæåˆ°å¯¹æ¯ä¸ªtopologyï¼Œstorméƒ½åœ¨å†…å­˜ä¸­ç»´æŠ¤å…¶tupleçš„å¤„ç†çŠ¶æ€ï¼Œé‚£ä¹ˆå¯¹äºä¸€ä¸ªå¤§è§„æ¨¡é›†ç¾¤ï¼Œstormæ˜¯å¦‚ä½•é«˜æ•ˆçš„ç»´æŠ¤å¤§é‡tupleçš„å¤„ç†çŠ¶æ€çš„å‘¢ï¼Ÿ å…¶å®ï¼Œtopologyåœ¨è¿è¡Œæ—¶ï¼Œå†…éƒ¨æœ‰ä¸€ç»„ç‰¹æ®Šçš„ä»»åŠ¡å«ackerï¼Œä¸“é—¨ç”¨æ¥åštupleçš„ack/failã€‚å½“ä¸€ä¸ªroot tupleï¼ˆspoutè¾“å‡ºçš„tupleï¼‰åœ¨DAGä¸­å¤„ç†å®Œæ¯•åï¼Œackerä¼šå‘äº§ç”Ÿè¯¥tupleçš„spoutå‘é€æ¶ˆæ¯æ¥ackè¿™ä¸ªtupleã€‚ æˆ‘ä»¬å¯é€šè¿‡å‚æ•°Config.TOPOLOGY_ACKER_EXECUTORSæŒ‡å®štopologyä¸­çš„ackerä»»åŠ¡çš„æ•°é‡ï¼Œé»˜è®¤æ˜¯ä¸topologyä¸­çš„workeræ•°ç›¸åŒï¼Œåœ¨å¤„ç†å¤§é‡æ¶ˆæ¯çš„åœºæ™¯ä¸‹ï¼Œå¯ä»¥é€šè¿‡æ­¤å‚æ•°å¢åŠ topologyçš„ackerä»»åŠ¡æ•°ï¼Œä»¥æé«˜å¯¹messageåšack/failçš„æ•ˆç‡ã€‚ stormé€šè¿‡ç»™æ¯ä¸ªtupleè®¾ç½®ä¸€ä¸ªå…¨å±€å”¯ä¸€idï¼Œå¹¶åœ¨è¾“å‡ºtupleå’Œtupleå¤„ç†å®Œæ¯•æ—¶æ”¶é›†tupleçš„idï¼Œå¹¶è¿›è¡Œå¼‚æˆ–è¿ç®—ï¼Œå·§å¦™çš„å®ç°tupleçŠ¶æ€çš„ç»´æŠ¤ã€‚å…ˆçœ‹ä¸‹å›¾ç¤ºä¾‹ï¼š åœ¨è¿™ä¸ªtopologyå…¶ä¸­åŒ…å«ä¸€ä¸ªspoutï¼Œ3ä¸ªboltå’Œä¸€ä¸ªacker boltï¼Œç´«è‰²çº¿è¡¨ç¤ºtupleçš„æµå‘ï¼Œç»¿è‰²çº¿è¡¨ç¤ºæ¯ä¸ªboltå¤„ç†å®Œtupleåçš„ack/failè°ƒç”¨ï¼Œçº¢è‰²çº¿è¡¨ç¤ºackerå›è°ƒspoutçš„ack/failæ–¹æ³•æ¥æ ‡è®°root tupleå¤„ç†å®Œæ¯•ã€‚ ä»¥ä¸‹æ˜¯stormçš„ackæ¡†æ¶å¯¹tupleçš„å¤„ç†çŠ¶æ€ç»´æŠ¤è¿‡ç¨‹è¯´æ˜ï¼š ç¬¬(1)(2)æ­¥ï¼Œspoutå‘é€T1åˆ°bolt1ï¼Œå‘é€T2åˆ°bolt2ï¼ŒT1å’ŒT2å…·æœ‰ç›¸åŒçš„å†…å®¹ï¼ˆå¯ä»¥è®¤ä¸ºéƒ½æŠŠspoutçš„è¾“å‡ºä½œä¸ºè‡ªå·±çš„è¾“å…¥ï¼‰ã€‚æ¯æ¡æ¶ˆæ¯éƒ½ä¼šæœ‰ä¸€ä¸ªå…¨å±€å”¯ä¸€idï¼ŒT1çš„é”šç‚¹ä¸º&lt;rootId,T1&gt;ï¼ŒT2çš„é”šç‚¹ä¸º&lt;rootId,T2&gt;ã€‚ ç¬¬(3)æ­¥ï¼Œspoutå‘é€å®Œæ¯•T1ã€T2åï¼Œåœ¨ackerä¸­æ³¨å†Œä¸€æ¡è®°å½•rootId=T1^T2ã€‚ ç¬¬(4)(5)æ­¥ï¼Œbolt1æ”¶åˆ°T1å¤„ç†å®Œæ¯•åå¯¹T1è¿›è¡Œackå¹¶å‘é€T3,T4åˆ°bolt3ï¼Œæ‰€ä»¥åœ¨ackerä¸­æ³¨å†ŒT1,T3,T4ï¼Œackerä¸­çš„è·Ÿè¸ªé¡¹å˜ä¸ºrootId=T1T2T1T3T4=T2T3T4 ç¬¬(6)(7)æ­¥ï¼Œbolt2æ”¶åˆ°T2å¤„ç†å®Œæ¯•åå¯¹T2è¿›è¡Œackå¹¶å‘é€T5,T6,T7åˆ°bolt4ï¼Œæ‰€ä»¥åœ¨ackerä¸­æ³¨å†ŒT2,T5,T6,T7ï¼Œackerä¸­çš„è·Ÿè¸ªé¡¹å˜ä¸ºrootId=T2T3T4T2T5T6T7=T3T4T5T6T7 ç¬¬(8)æ­¥ï¼Œbolt3æ”¶åˆ°T3,T4å¤„ç†å®Œæ¯•åå¯¹T3,T4è¿›è¡Œackï¼Œæ²¡æœ‰è¾“å‡ºæ–°çš„tupleï¼Œæ‰€ä»¥åœ¨ackerä¸­æ³¨å†ŒT3,T4ï¼Œackerä¸­çš„è·Ÿè¸ªé¡¹å˜ä¸ºrootId=T3T4T5T6T7T3T4=T5T6T7 ç¬¬(9)æ­¥ï¼Œbolt4æ”¶åˆ°T5,T6,T7å¤„ç†å®Œæ¯•åå¯¹T5,T6,T7è¿›è¡Œackï¼Œæ²¡æœ‰è¾“å‡ºæ–°çš„tupleï¼Œæ‰€ä»¥åœ¨ackerä¸­æ³¨å†ŒT5,T6,T7ï¼Œackerä¸­çš„è·Ÿè¸ªé¡¹å˜ä¸ºrootId=T5T6T7T5T6^T7=0 ç¬¬(10)æ­¥ï¼Œacker boltå‘ç°rootIdå¯¹åº”çš„è¿½è¸ªå€¼ä¸º0ï¼Œè¯´æ˜è¯¥rootIdå¯¹åº”çš„æºæ¶ˆæ¯ä»¥åŠè¡ç”Ÿå‡ºæ¥çš„æ‰€æœ‰æ¶ˆæ¯ï¼ˆbolt1,bolt2æ–°è¾“å‡ºçš„æ¶ˆæ¯ï¼‰éƒ½è¢«æˆåŠŸå¤„ç†å®Œæ¯•ã€‚äºæ˜¯acker boltä¼šå›è°ƒspoutçš„ackæ–¹æ³•ï¼Œæ ‡è¯†æ¶ˆæ¯rootIdå·²è¢«topologyå¤„ç†æˆåŠŸã€‚","raw":null,"content":null,"categories":[{"name":"Storm","slug":"Storm","permalink":"https://maohong.github.io/categories/Storm/"}],"tags":[{"name":"storm","slug":"storm","permalink":"https://maohong.github.io/tags/storm/"},{"name":"å®æ—¶è®¡ç®—","slug":"å®æ—¶è®¡ç®—","permalink":"https://maohong.github.io/tags/%E5%AE%9E%E6%97%B6%E8%AE%A1%E7%AE%97/"}]},{"title":"ä½¿ç”¨hexo+gitpageæ­å»ºåšå®¢","slug":"ä½¿ç”¨hexo-gitpageæ­å»ºåšå®¢","date":"2016-09-02T11:50:40.000Z","updated":"2016-09-02T11:50:40.000Z","comments":true,"path":"20160902/ä½¿ç”¨hexo-gitpageæ­å»ºåšå®¢/","permalink":"https://maohong.github.io/20160902/%E4%BD%BF%E7%94%A8hexo-gitpage%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2/","excerpt":"","keywords":null,"text":"ç¯å¢ƒå‡†å¤‡ ç³»ç»Ÿï¼šmac osx è½¯ä»¶ï¼šNode.jsï¼Œnpmï¼Œgitï¼Œhexo å…·ä½“å®‰è£…ä»¥åŠgitä¸githubæ‰“é€šçš„é…ç½®å°±ä¸è¯¦è¿°äº†ï¼Œå¯ä»¥googleåˆ°å„ç§æ–¹æ³•ã€‚ hexoå‘½ä»¤ hexo init &lt;folder&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #è¡¨ç¤ºæ‰§è¡Œinitå‘½ä»¤åˆå§‹åŒ–hexoåˆ°ä½ æŒ‡å®šçš„ç›®å½• ä»¥ä¸‹å‘½ä»¤éœ€è¦åœ¨&lt;folder&gt;ç›®å½•ä¸‹æ‰§è¡Œï¼š hexo generate &nbsp;&nbsp;&nbsp;#è‡ªåŠ¨æ ¹æ®å½“å‰ç›®å½•ä¸‹æ–‡ä»¶,ç”Ÿæˆé™æ€ç½‘é¡µ hexo server &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#è¿è¡Œæœ¬åœ°æœåŠ¡ å¯åŠ¨æœåŠ¡åï¼Œå°±å¯ä»¥é€šè¿‡è®¿é—® http://localhost:4000 æ¥çœ‹çœ‹æ•ˆæœäº†ã€‚ æ¥ä¸‹æ¥ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥åˆ›å»ºä¸€ç¯‡æ–°åšæ–‡ï¼š hexo new â€œtest blog 1â€ åˆ›å»ºä¸€ä¸ªåä¸ºtest blog 1çš„åšå®¢é¡µé¢ï¼Œå¯¹åº”çš„mdæ–‡ä»¶è·¯å¾„æ˜¯&lt;folder&gt;/source/_posts\\test blog 1.md æ¥ä¸‹æ¥å°±å¯ä»¥åœ¨è¿™ä¸ªmdæ–‡ä»¶ä¸­å†™æ–‡ç« äº†ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯MacDownæ¥ç¼–è¾‘mdæ–‡ä»¶ï¼Œæ”¯æŒå®æ—¶æŸ¥çœ‹é¡µé¢æ•ˆæœï¼Œè¿˜æ˜¯æŒºå¥½ç”¨çš„ã€‚ å‘å¸ƒåšå®¢ æ–‡ç« å†™å¥½åï¼Œé€šè¿‡ä»¥ä¸‹æ–¹å¼å‘å¸ƒåˆ°githubä¸Šã€‚ 1.ç¼–è¾‘./_config.ymlæ–‡ä»¶ï¼Œä¿®æ”¹ä»¥ä¸‹éƒ¨åˆ†ï¼Œé…ç½®æœ¬åœ°å†…å®¹åŒæ­¥è‡³githubï¼š deploy: &nbsp;&nbsp;type: git &nbsp;&nbsp;repository: git@github.com:maohong/maohong.github.io.git &nbsp;&nbsp;branch: master 2.æ‰§è¡Œhexo generate(hexo g)ç”Ÿæˆhtmlå†…å®¹ 3.æ‰§è¡Œhexo deploy(hexo d)è®²æ›´æ–°å†…å®¹å‘å¸ƒè‡³guthub ç„¶åå°±å¯ä»¥è®¿é—®ä¸»é¡µæŸ¥çœ‹æ•ˆæœäº†ï¼Œå¯ä»¥ä½¿ç”¨githubå¸æˆ·å.github.ioè¿›è¡Œè®¿é—®, ä¹Ÿå¯ä»¥è®¾ç½®ä¸ªæ€§åŸŸåã€‚","raw":null,"content":null,"categories":[{"name":"Tools","slug":"Tools","permalink":"https://maohong.github.io/categories/Tools/"}],"tags":[{"name":"hexo","slug":"hexo","permalink":"https://maohong.github.io/tags/hexo/"},{"name":"gitpage","slug":"gitpage","permalink":"https://maohong.github.io/tags/gitpage/"}]},{"title":"Spark on yarnçš„å†…å­˜åˆ†é…é—®é¢˜","slug":"Spark-on-yarnçš„å†…å­˜åˆ†é…é—®é¢˜","date":"2016-08-11T05:23:13.000Z","updated":"2016-08-11T05:23:13.000Z","comments":true,"path":"20160811/Spark-on-yarnçš„å†…å­˜åˆ†é…é—®é¢˜/","permalink":"https://maohong.github.io/20160811/Spark-on-yarn%E7%9A%84%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D%E9%97%AE%E9%A2%98/","excerpt":"é—®é¢˜æè¿° åœ¨æµ‹è¯•spark on yarnæ—¶ï¼Œå‘ç°ä¸€äº›å†…å­˜åˆ†é…ä¸Šçš„é—®é¢˜ï¼Œå…·ä½“å¦‚ä¸‹ã€‚ åœ¨$SPARK_HOME/conf/spark-env.shä¸­é…ç½®å¦‚ä¸‹å‚æ•°ï¼š SPARK_EXECUTOR_INSTANCES=4 åœ¨yarné›†ç¾¤ä¸­å¯åŠ¨çš„executorè¿›ç¨‹æ•° SPARK_EXECUTOR_MEMORY=2G ä¸ºæ¯ä¸ªexecutorè¿›ç¨‹åˆ†é…çš„å†…å­˜å¤§å° SPARK_DRIVER_MEMORY=1G ä¸ºspark-driverè¿›ç¨‹åˆ†é…çš„å†…å­˜å¤§å° æ‰§è¡Œ$SPARK_HOME/bin/spark-sql â€“master yarnï¼ŒæŒ‰yarn-clientæ¨¡å¼å¯åŠ¨spark-sqläº¤äº’å‘½ä»¤è¡Œï¼ˆå³driverç¨‹åºè¿è¡Œåœ¨æœ¬åœ°ï¼Œè€Œéyarnçš„containerä¸­ï¼‰ï¼Œæ—¥å¿—æ˜¾ç¤ºçš„å…³äºAppMasterå’ŒExecutorçš„å†…å­˜ä¿¡æ¯å¦‚ä¸‹ï¼š æ—¥å¿—æ˜¾ç¤ºï¼ŒAppMasterçš„å†…å­˜æ˜¯896MBï¼Œå…¶ä¸­åŒ…å«äº†384MBçš„memoryOverheadï¼›å¯åŠ¨äº†5ä¸ªexecutorï¼Œç¬¬ä¸€ä¸ªçš„å¯ç”¨å†…å­˜æ˜¯530.3MBï¼Œå…¶ä½™æ¯ä¸ªExecutorçš„å¯ç”¨å†…å­˜æ˜¯1060.3MBã€‚ åˆ°yarnUIçœ‹ä¸‹èµ„æºä½¿ç”¨æƒ…å†µï¼Œå…±å¯åŠ¨äº†5ä¸ªcontainerï¼Œå ç”¨å†…å­˜13Gï¼Œå…¶ä¸­ä¸€å°NodeManagerå¯åŠ¨äº†2ä¸ªcontainerï¼Œå ç”¨å†…å­˜4Gï¼ˆ1ä¸ªAppMasterå 1Gã€å¦ä¸€ä¸ªå 3Gï¼‰ï¼Œå¦å¤–3å°å„å¯äº†1ä¸ªcontainerï¼Œæ¯ä¸ªå ç”¨3Gå†…å­˜ã€‚ å†åˆ°sparkUIçœ‹ä¸‹executorsçš„æƒ…å†µï¼Œè¿™é‡Œæœ‰5ä¸ªexecutorï¼Œå…¶ä¸­driveræ˜¯è¿è¡Œåœ¨æ‰§è¡Œspark-sqlå‘½ä»¤çš„æœ¬åœ°æœåŠ¡å™¨ä¸Šï¼Œå¦å¤–4ä¸ªæ˜¯è¿è¡Œåœ¨yarné›†ç¾¤ä¸­ã€‚Driverçš„å¯ç”¨storage memoryä¸º530.3MBï¼Œå¦å¤–4ä¸ªéƒ½æ˜¯1060.3MBï¼ˆä¸æ—¥å¿—ä¿¡æ¯ä¸€è‡´ï¼‰ã€‚ é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼š Yarnä¸ºcontaineråˆ†é…çš„æœ€å°å†…å­˜ç”±yarn.scheduler.minimum-allocation-mbå‚æ•°å†³å®šï¼Œé»˜è®¤æ˜¯1Gï¼Œä»yarnUIä¸­çœ‹ç¡®å®å¦‚æ­¤ï¼Œå¯ä¸ºä½•sparkçš„æ—¥å¿—é‡Œæ˜¾ç¤ºAppMasterçš„å®é™…å†…å­˜æ˜¯896-384=512MBå‘¢ï¼Ÿ384MBæ˜¯æ€ä¹ˆç®—å‡ºæ¥çš„ï¼Ÿ sparké…ç½®æ–‡ä»¶é‡ŒæŒ‡å®šäº†æ¯ä¸ªexecutorçš„å†…å­˜ä¸º2Gï¼Œä¸ºä½•æ—¥å¿—å’ŒsparkUIä¸Šæ˜¾ç¤ºçš„æ˜¯1060.3MBï¼Ÿ driverçš„å†…å­˜é…ç½®ä¸º1Gï¼Œä¸ºä½•sparkUIé‡Œæ˜¾ç¤ºçš„æ˜¯530.3MBå‘¢ï¼Ÿ ä¸ºä½•yarnä¸­æ¯ä¸ªcontaineråˆ†é…çš„å†…å­˜æ˜¯3Gï¼Œè€Œä¸æ˜¯executoréœ€è¦çš„2Gå‘¢ï¼Ÿ é—®é¢˜è§£æ è¿›è¿‡ä¸€ç•ªè°ƒç ”ï¼Œå‘ç°è¿™é‡Œæœ‰äº›æ¦‚å¿µå®¹æ˜“æ··æ·†ï¼Œæ•´ç†å¦‚ä¸‹ï¼Œåºå·å¯¹åº”ä¸Šé¢çš„é—®é¢˜ï¼š","keywords":null,"text":"é—®é¢˜æè¿° åœ¨æµ‹è¯•spark on yarnæ—¶ï¼Œå‘ç°ä¸€äº›å†…å­˜åˆ†é…ä¸Šçš„é—®é¢˜ï¼Œå…·ä½“å¦‚ä¸‹ã€‚ åœ¨$SPARK_HOME/conf/spark-env.shä¸­é…ç½®å¦‚ä¸‹å‚æ•°ï¼š SPARK_EXECUTOR_INSTANCES=4 åœ¨yarné›†ç¾¤ä¸­å¯åŠ¨çš„executorè¿›ç¨‹æ•° SPARK_EXECUTOR_MEMORY=2G ä¸ºæ¯ä¸ªexecutorè¿›ç¨‹åˆ†é…çš„å†…å­˜å¤§å° SPARK_DRIVER_MEMORY=1G ä¸ºspark-driverè¿›ç¨‹åˆ†é…çš„å†…å­˜å¤§å° æ‰§è¡Œ$SPARK_HOME/bin/spark-sql â€“master yarnï¼ŒæŒ‰yarn-clientæ¨¡å¼å¯åŠ¨spark-sqläº¤äº’å‘½ä»¤è¡Œï¼ˆå³driverç¨‹åºè¿è¡Œåœ¨æœ¬åœ°ï¼Œè€Œéyarnçš„containerä¸­ï¼‰ï¼Œæ—¥å¿—æ˜¾ç¤ºçš„å…³äºAppMasterå’ŒExecutorçš„å†…å­˜ä¿¡æ¯å¦‚ä¸‹ï¼š æ—¥å¿—æ˜¾ç¤ºï¼ŒAppMasterçš„å†…å­˜æ˜¯896MBï¼Œå…¶ä¸­åŒ…å«äº†384MBçš„memoryOverheadï¼›å¯åŠ¨äº†5ä¸ªexecutorï¼Œç¬¬ä¸€ä¸ªçš„å¯ç”¨å†…å­˜æ˜¯530.3MBï¼Œå…¶ä½™æ¯ä¸ªExecutorçš„å¯ç”¨å†…å­˜æ˜¯1060.3MBã€‚ åˆ°yarnUIçœ‹ä¸‹èµ„æºä½¿ç”¨æƒ…å†µï¼Œå…±å¯åŠ¨äº†5ä¸ªcontainerï¼Œå ç”¨å†…å­˜13Gï¼Œå…¶ä¸­ä¸€å°NodeManagerå¯åŠ¨äº†2ä¸ªcontainerï¼Œå ç”¨å†…å­˜4Gï¼ˆ1ä¸ªAppMasterå 1Gã€å¦ä¸€ä¸ªå 3Gï¼‰ï¼Œå¦å¤–3å°å„å¯äº†1ä¸ªcontainerï¼Œæ¯ä¸ªå ç”¨3Gå†…å­˜ã€‚ å†åˆ°sparkUIçœ‹ä¸‹executorsçš„æƒ…å†µï¼Œè¿™é‡Œæœ‰5ä¸ªexecutorï¼Œå…¶ä¸­driveræ˜¯è¿è¡Œåœ¨æ‰§è¡Œspark-sqlå‘½ä»¤çš„æœ¬åœ°æœåŠ¡å™¨ä¸Šï¼Œå¦å¤–4ä¸ªæ˜¯è¿è¡Œåœ¨yarné›†ç¾¤ä¸­ã€‚Driverçš„å¯ç”¨storage memoryä¸º530.3MBï¼Œå¦å¤–4ä¸ªéƒ½æ˜¯1060.3MBï¼ˆä¸æ—¥å¿—ä¿¡æ¯ä¸€è‡´ï¼‰ã€‚ é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼š Yarnä¸ºcontaineråˆ†é…çš„æœ€å°å†…å­˜ç”±yarn.scheduler.minimum-allocation-mbå‚æ•°å†³å®šï¼Œé»˜è®¤æ˜¯1Gï¼Œä»yarnUIä¸­çœ‹ç¡®å®å¦‚æ­¤ï¼Œå¯ä¸ºä½•sparkçš„æ—¥å¿—é‡Œæ˜¾ç¤ºAppMasterçš„å®é™…å†…å­˜æ˜¯896-384=512MBå‘¢ï¼Ÿ384MBæ˜¯æ€ä¹ˆç®—å‡ºæ¥çš„ï¼Ÿ sparké…ç½®æ–‡ä»¶é‡ŒæŒ‡å®šäº†æ¯ä¸ªexecutorçš„å†…å­˜ä¸º2Gï¼Œä¸ºä½•æ—¥å¿—å’ŒsparkUIä¸Šæ˜¾ç¤ºçš„æ˜¯1060.3MBï¼Ÿ driverçš„å†…å­˜é…ç½®ä¸º1Gï¼Œä¸ºä½•sparkUIé‡Œæ˜¾ç¤ºçš„æ˜¯530.3MBå‘¢ï¼Ÿ ä¸ºä½•yarnä¸­æ¯ä¸ªcontaineråˆ†é…çš„å†…å­˜æ˜¯3Gï¼Œè€Œä¸æ˜¯executoréœ€è¦çš„2Gå‘¢ï¼Ÿ é—®é¢˜è§£æ è¿›è¿‡ä¸€ç•ªè°ƒç ”ï¼Œå‘ç°è¿™é‡Œæœ‰äº›æ¦‚å¿µå®¹æ˜“æ··æ·†ï¼Œæ•´ç†å¦‚ä¸‹ï¼Œåºå·å¯¹åº”ä¸Šé¢çš„é—®é¢˜ï¼š (1) sparkçš„yarn-clientå‘ResourceManagerç”³è¯·æäº¤ä½œä¸š/å¯åŠ¨AppMasteræ—¶ï¼Œä¼šåˆ¤æ–­æ˜¯å¦æ˜¯é›†ç¾¤æ¨¡å¼ï¼Œå¦‚æœæ˜¯é›†ç¾¤æ¨¡å¼ï¼Œåˆ™AppMasterçš„å†…å­˜å¤§å°ä¸driverå†…å­˜å¤§å°ä¸€è‡´ï¼Œå¦åˆ™ç”±spark.yarn.am.memoryå†³å®šï¼Œè¿™ä¸ªå‚æ•°çš„é»˜è®¤å€¼æ˜¯512MBã€‚æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯yarn-clientæ¨¡å¼ï¼Œæ‰€ä»¥å®é™…å†…å­˜æ˜¯512MBã€‚ 384MBæ˜¯spark-clientä¸ºappMasteré¢å¤–ç”³è¯·çš„å†…å­˜ï¼Œè®¡ç®—æ–¹æ³•å¦‚ä¸‹ï¼š å³ï¼Œé»˜è®¤ä»å‚æ•°è¯»å–ï¼ˆé›†ç¾¤æ¨¡å¼ä»spark.yarn.driver.memoryOverheadå‚æ•°è¯»ï¼Œå¦åˆ™ä»spark.yarn.am.memoryOverheadå‚æ•°è¯»ï¼‰ï¼Œè‹¥æ²¡é…æ­¤å‚æ•°ï¼Œåˆ™ä»AppMasterçš„å†…å­˜*ä¸€å®šç³»æ•°å’Œé»˜è®¤æœ€å°overheadä¸­å–è¾ƒå¤§å€¼ã€‚ åœ¨spark-1.4.1ç‰ˆæœ¬ä¸­ï¼ŒMEMORY_OVERHEAD_FACTORçš„é»˜è®¤å€¼ä¸º0.10ï¼ˆä¹‹å‰æ˜¯0.07ï¼‰ï¼ŒMEMORY_OVERHEAD_MINé»˜è®¤ä¸º384ï¼Œæˆ‘ä»¬æ²¡æœ‰æŒ‡å®šspark.yarn.driver.memoryOverheadå’Œspark.yarn.am.memoryOverheadï¼Œè€ŒamMemory=512Mï¼ˆç”±spark.yarn.am.memoryå†³å®šï¼‰ï¼Œå› æ­¤memoryOverheadä¸ºmax(512*0.10, 384)=384MBã€‚ Executorçš„memoryOverheadè®¡ç®—æ–¹æ³•ä¸æ­¤ä¸€æ ·ï¼Œåªæ˜¯ä¸åŒºåˆ†æ˜¯å¦é›†ç¾¤æ¨¡å¼ï¼Œéƒ½é»˜è®¤ç”±spark.yarn.executor.memoryOverheadé…ç½®ã€‚ (2) æ—¥å¿—å’ŒsparkUIä¸Šæ˜¾ç¤ºçš„æ˜¯executorå†…éƒ¨ç”¨äºç¼“å­˜è®¡ç®—ç»“æœçš„å†…å­˜ç©ºé—´ï¼Œå¹¶ä¸æ˜¯executoræ‰€æ‹¥æœ‰çš„å…¨éƒ¨å†…å­˜ã€‚è¿™éƒ¨åˆ†å†…å­˜æ˜¯ç”±ä»¥ä¸‹å…¬å¼è®¡ç®—ï¼š Runtime.getRuntime.maxMemoryæŒ‰2048MBç®—ï¼Œstorage memoryå¤§å°ä¸º1105.92MBï¼ŒsparkUIæ˜¾ç¤ºçš„ç•¥å°äºæ­¤å€¼ï¼Œæ˜¯æ­£å¸¸çš„ã€‚ (3) ä¸ä¸Šè¿°ç¬¬2ç‚¹ä¸€æ ·ï¼Œstorage memoryçš„å¤§å°ç•¥å°äº10240.90.6=552.96MB (4) å‰é¢æåˆ°sparkä¼šä¸ºcontaineré¢å¤–ç”³è¯·ä¸€éƒ¨åˆ†å†…å­˜ï¼ˆmemoryOverheadï¼‰ï¼Œå› æ­¤ï¼Œå®é™…ä¸ºcontaineræäº¤ç”³è¯·çš„å†…å­˜å¤§å°æ˜¯2048 + max(2048*0.10, 384) = 2432MBï¼Œè€Œyarnåœ¨åšèµ„æºåˆ†é…æ—¶ä¼šåšèµ„æºè§„æ•´åŒ–ï¼Œå³åº”ç”¨ç¨‹åºç”³è¯·çš„èµ„æºé‡ä¸€å®šæ˜¯æœ€å°å¯ç”³è¯·èµ„æºé‡çš„æ•´æ•°å€ï¼ˆå‘ä¸Šå–æ•´ï¼‰ï¼Œæœ€å°å¯ç”³è¯·å†…å­˜é‡ç”±yarn.scheduler.minimum-allocation-mbæŒ‡å®šï¼Œå› æ­¤ï¼Œä¼šä¸ºcontaineråˆ†é…3Gå†…å­˜ã€‚ éªŒè¯ ä¸ºäº†éªŒè¯ä¸Šè¿°è§„åˆ™ï¼Œç»§ç»­ä¿®æ”¹é…ç½®å‚æ•°ï¼š SPARK_EXECUTOR_INSTANCES=4 åœ¨yarné›†ç¾¤ä¸­å¯åŠ¨çš„executorè¿›ç¨‹æ•° SPARK_EXECUTOR_MEMORY=4G ä¸ºæ¯ä¸ªexecutorè¿›ç¨‹åˆ†é…çš„å†…å­˜å¤§å° SPARK_DRIVER_MEMORY=3G ä¸ºspark-driverè¿›ç¨‹åˆ†é…çš„å†…å­˜å¤§å° å¹¶åœ¨å¯åŠ¨spark-sqlæ—¶æŒ‡å®šspark.yarn.am.memoryå‚æ•°ï¼š bin/spark-sql â€“master yarn â€“conf spark.yarn.am.memory=1024m å†çœ‹æ—¥å¿—ä¿¡æ¯ï¼š yarnUIçŠ¶æ€ï¼š sparkUIçš„executorsä¿¡æ¯ï¼š å¯è§ï¼ŒAppMasterçš„å®é™…å†…å­˜ä¸º1024Mï¼ˆ1408-384ï¼‰ï¼Œè€Œå…¶åœ¨yarnä¸­çš„containerå†…å­˜å¤§å°ä¸º2Gï¼ˆ1408å¤§äº1Gï¼ŒyarnæŒ‰èµ„æºè§„æ•´åŒ–åŸåˆ™ä¸ºå…¶åˆ†é…2Gï¼‰ã€‚ åŒç†ï¼Œdriverçš„storage memoryç©ºé—´ä¸º3G*0.9*0.6=1.62Gï¼Œexecutorçš„storage memoryç©ºé—´ä¸º4G*0.9*0.6=2.16Gï¼Œexecutoræ‰€åœ¨containerå ç”¨5Gå†…å­˜ï¼ˆ4096+max(4096*0.10,384)= 4505.6ï¼Œå¤§äº4Gï¼Œ yarnæŒ‰èµ„æºè§„æ•´åŒ–åŸåˆ™ä¸ºå…¶åˆ†é…5Gï¼‰ã€‚ Yarné›†ç¾¤çš„å†…å­˜æ€»å ç”¨ç©ºé—´ä¸º2+5*4=22Gã€‚","raw":null,"content":null,"categories":[{"name":"Spark","slug":"Spark","permalink":"https://maohong.github.io/categories/Spark/"}],"tags":[{"name":"spark","slug":"spark","permalink":"https://maohong.github.io/tags/spark/"},{"name":"yarn","slug":"yarn","permalink":"https://maohong.github.io/tags/yarn/"},{"name":"å†…å­˜åˆ†é…","slug":"å†…å­˜åˆ†é…","permalink":"https://maohong.github.io/tags/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D/"}]},{"title":"Stormæºç ç¼–è¯‘åŠæœ¬åœ°è°ƒè¯•æ–¹æ³•","slug":"stormæºç ç¼–è¯‘åŠæœ¬åœ°è°ƒè¯•æ–¹æ³•","date":"2016-07-13T15:53:12.000Z","updated":"2016-07-13T15:53:12.000Z","comments":true,"path":"20160713/stormæºç ç¼–è¯‘åŠæœ¬åœ°è°ƒè¯•æ–¹æ³•/","permalink":"https://maohong.github.io/20160713/storm%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91%E5%8F%8A%E6%9C%AC%E5%9C%B0%E8%B0%83%E8%AF%95%E6%96%B9%E6%B3%95/","excerpt":"åŸºç¡€ç¯å¢ƒ IDEå¼€å‘ç¯å¢ƒï¼šintelliJIdea JDK1.7 64bit intelliJIdeaå®‰è£…mavenæ’ä»¶ï¼Œé…ç½®å¥½ä»“åº“æº intelliJIdeaå®‰è£…clojureæ’ä»¶Cursiveï¼ˆéœ€è¦æ³¨å†Œå¹¶è·å–ä¸€ä¸ªlicenseï¼Œå¦åˆ™åªèƒ½ä½¿ç”¨30å¤©ï¼‰ å¦‚æœéœ€è¦è‡ªå·±åˆ›å»ºclojureé¡¹ç›®è¿›è¡Œå¼€å‘ï¼Œéœ€è¦å®‰è£…leiningenï¼Œä¸‹è½½åœ°å€ æºç è·å– ä»github checkoutä»£ç åˆ°æœ¬åœ°å³å¯ï¼Œhttps://github.com/apache/storm.git æˆ‘è¿™é‡Œç¼–è¯‘çš„æ˜¯æˆ‘ä»¬ç›®å‰æ­£åœ¨ç”¨çš„0.10.0ç‰ˆæœ¬çš„ä»£ç ã€‚ å¯¼å…¥ideaåŠç¼–è¯‘ æ‰“å¼€ideaï¼Œæ–°å»ºprojectï¼Œä»æºç å¯¼å…¥ï¼Œå¦‚ä¸‹ï¼š å¯¼å…¥åï¼Œideaä¼šè‡ªåŠ¨æ ¹æ®pom.xmlä¸‹è½½ç›¸å…³ä¾èµ–åŒ…ï¼Œéƒ¨åˆ†ä¾èµ–åŒ…å¦‚æœä¸‹è½½ä¸åˆ°ï¼Œéœ€è¦æ‰‹åŠ¨æ·»åŠ ã€‚å®Œæˆåï¼Œå¯ä»¥çœ‹åˆ°projectçš„moduleå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š","keywords":null,"text":"åŸºç¡€ç¯å¢ƒ IDEå¼€å‘ç¯å¢ƒï¼šintelliJIdea JDK1.7 64bit intelliJIdeaå®‰è£…mavenæ’ä»¶ï¼Œé…ç½®å¥½ä»“åº“æº intelliJIdeaå®‰è£…clojureæ’ä»¶Cursiveï¼ˆéœ€è¦æ³¨å†Œå¹¶è·å–ä¸€ä¸ªlicenseï¼Œå¦åˆ™åªèƒ½ä½¿ç”¨30å¤©ï¼‰ å¦‚æœéœ€è¦è‡ªå·±åˆ›å»ºclojureé¡¹ç›®è¿›è¡Œå¼€å‘ï¼Œéœ€è¦å®‰è£…leiningenï¼Œä¸‹è½½åœ°å€ æºç è·å– ä»github checkoutä»£ç åˆ°æœ¬åœ°å³å¯ï¼Œhttps://github.com/apache/storm.git æˆ‘è¿™é‡Œç¼–è¯‘çš„æ˜¯æˆ‘ä»¬ç›®å‰æ­£åœ¨ç”¨çš„0.10.0ç‰ˆæœ¬çš„ä»£ç ã€‚ å¯¼å…¥ideaåŠç¼–è¯‘ æ‰“å¼€ideaï¼Œæ–°å»ºprojectï¼Œä»æºç å¯¼å…¥ï¼Œå¦‚ä¸‹ï¼š å¯¼å…¥åï¼Œideaä¼šè‡ªåŠ¨æ ¹æ®pom.xmlä¸‹è½½ç›¸å…³ä¾èµ–åŒ…ï¼Œéƒ¨åˆ†ä¾èµ–åŒ…å¦‚æœä¸‹è½½ä¸åˆ°ï¼Œéœ€è¦æ‰‹åŠ¨æ·»åŠ ã€‚å®Œæˆåï¼Œå¯ä»¥çœ‹åˆ°projectçš„moduleå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š è¿™æ—¶å€™ï¼Œé€šè¿‡ideaå°±å¯ä»¥ç›´æ¥è·Ÿè¸ªçœ‹æºç äº†ï¼Œä½†ç›´æ¥è¿è¡Œstorm-starterä¸­çš„ä¾‹å­è¿˜æ˜¯ä¼šæŠ¥é”™å¹¶æç¤ºæœ‰äº›ç±»æ‰¾ä¸åˆ°ï¼Œç»æŸ¥çœ‹æ˜¯clojureçš„ä»£ç è¿˜æœªç¼–è¯‘å‡ºclassæ–‡ä»¶ã€‚å¯ä»¥åœ¨æºç ç›®å½•ä¸‹æ‰§è¡Œmvn compileè¿›è¡Œç¼–è¯‘ã€‚ ä½¿ç”¨ideaè°ƒè¯•æºç  ç¼–è¯‘å®Œæˆåï¼Œå¯ä»¥ç›´æ¥å¯åŠ¨storm-starterä¸­çš„ä¾‹å­è¿è¡Œã€‚æœŸé—´å¯èƒ½å‡ºç°æ‰¾ä¸åˆ°ç±»ï¼Œæ£€æŸ¥classpathï¼Œä¾èµ–åŒ…çš„scopeç”±providedæ”¹ä¸ºcompileã€‚ åœ¨æºä»£ç ä¸­åŠ æ–­ç‚¹ï¼Œrunæˆ–è€…debugå³å¯ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235&gt; 2739 [main] INFO b.s.u.Utils - Using defaults.yaml from resources&gt; 4546 [main] INFO b.s.u.Utils - Using defaults.yaml from resources&gt; 5218 [main] INFO b.s.zookeeper - Starting inprocess zookeeper at port 2000 and dir /var/folders/c0/0bgvmbb10jz1609_1xjqdsj00000gn/T//eeb57be9-5478-4fa9-ab31-6dfce38e7695&gt; 5243 [main] INFO b.s.u.Utils - Using defaults.yaml from resources&gt; 5340 [main] INFO b.s.d.nimbus - Starting Nimbus with conf {\"topology.builtin.metrics.bucket.size.secs\" 60, ......&gt; 5342 [main] INFO b.s.d.nimbus - Using default scheduler&gt; 5360 [main] INFO b.s.u.StormBoundedExponentialBackoffRetry - The baseSleepTimeMs [1000] the maxSleepTimeMs [30000] the maxRetries [5]&gt; 5457 [main] INFO o.a.c.f.i.CuratorFrameworkImpl - Starting&gt; 5529 [main-EventThread] INFO o.a.c.f.s.ConnectionStateManager - State change: CONNECTED&gt; 5531 [main-EventThread] INFO b.s.zookeeper - Zookeeper state update: :connected:none&gt; 6569 [main] INFO b.s.u.StormBoundedExponentialBackoffRetry - The baseSleepTimeMs [1000] the maxSleepTimeMs [30000] the maxRetries [5]&gt; 6569 [main] INFO o.a.c.f.i.CuratorFrameworkImpl - Starting&gt; 6574 [main-EventThread] INFO o.a.c.f.s.ConnectionStateManager - State change: CONNECTED&gt; 6605 [main] INFO b.s.u.StormBoundedExponentialBackoffRetry - The baseSleepTimeMs [1000] the maxSleepTimeMs [30000] the maxRetries [5]&gt; 6605 [main] INFO o.a.c.f.i.CuratorFrameworkImpl - Starting&gt; 6609 [main-EventThread] INFO o.a.c.f.s.ConnectionStateManager - State change: CONNECTED&gt; 6609 [main-EventThread] INFO b.s.zookeeper - Zookeeper state update: :connected:none&gt; 6617 [main] INFO b.s.u.StormBoundedExponentialBackoffRetry - The baseSleepTimeMs [1000] the maxSleepTimeMs [30000] the maxRetries [5]&gt; 6618 [main] INFO o.a.c.f.i.CuratorFrameworkImpl - Starting&gt; 6620 [main] INFO b.s.u.StormBoundedExponentialBackoffRetry - The baseSleepTimeMs [1000] the maxSleepTimeMs [30000] the maxRetries [5]&gt; 6621 [main] INFO o.a.c.f.i.CuratorFrameworkImpl - Starting&gt; 6623 [main-EventThread] INFO o.a.c.f.s.ConnectionStateManager - State change: CONNECTED&gt; 6625 [main-EventThread] INFO o.a.c.f.s.ConnectionStateManager - State change: CONNECTED&gt; 6649 [main-EventThread] INFO b.s.zookeeper - Zookeeper state update: :connected:none&gt; 6652 [main] INFO b.s.u.StormBoundedExponentialBackoffRetry - The baseSleepTimeMs [1000] the maxSleepTimeMs [30000] the maxRetries [5]&gt; 6653 [main] INFO o.a.c.f.i.CuratorFrameworkImpl - Starting&gt; 6657 [main-EventThread] INFO o.a.c.f.s.ConnectionStateManager - State change: CONNECTED&gt; 6671 [main] INFO b.s.d.supervisor - Starting Supervisor with conf {\"topology.builtin.metrics.bucket.size.secs\" 60, ......&gt; 6693 [main] INFO b.s.u.StormBoundedExponentialBackoffRetry - The baseSleepTimeMs [1000] the maxSleepTimeMs [30000] the maxRetries [5]&gt; 6694 [main] INFO o.a.c.f.i.CuratorFrameworkImpl - Starting&gt; 6697 [main-EventThread] INFO o.a.c.f.s.ConnectionStateManager - State change: CONNECTED&gt; 6697 [main-EventThread] INFO b.s.zookeeper - Zookeeper state update: :connected:none&gt; 6700 [main] INFO b.s.u.StormBoundedExponentialBackoffRetry - The baseSleepTimeMs [1000] the maxSleepTimeMs [30000] the maxRetries [5]&gt; 6701 [main] INFO o.a.c.f.i.CuratorFrameworkImpl - Starting&gt; 6704 [main-EventThread] INFO o.a.c.f.s.ConnectionStateManager - State change: CONNECTED&gt; 6722 [main] INFO b.s.d.supervisor - Starting supervisor with id 913c90f6-3f78-4646-8998-aa901ae3c360 at host localhost&gt; 6725 [main] INFO b.s.d.supervisor - Starting Supervisor with conf {\"topology.builtin.metrics.bucket.size.secs\" 60, .....&gt; 6732 [main] INFO b.s.u.StormBoundedExponentialBackoffRetry - The baseSleepTimeMs [1000] the maxSleepTimeMs [30000] the maxRetries [5]&gt; 6732 [main] INFO o.a.c.f.i.CuratorFrameworkImpl - Starting&gt; 6736 [main-EventThread] INFO o.a.c.f.s.ConnectionStateManager - State change: CONNECTED&gt; 6736 [main-EventThread] INFO b.s.zookeeper - Zookeeper state update: :connected:none&gt; 6740 [main] INFO b.s.u.StormBoundedExponentialBackoffRetry - The baseSleepTimeMs [1000] the maxSleepTimeMs [30000] the maxRetries [5]&gt; 6741 [main] INFO o.a.c.f.i.CuratorFrameworkImpl - Starting&gt; 6744 [main-EventThread] INFO o.a.c.f.s.ConnectionStateManager - State change: CONNECTED&gt; 6753 [main] INFO b.s.d.supervisor - Starting supervisor with id 49c35a73-7500-4ea4-aaa2-4b1c1f231fd4 at host localhost&gt; 7035 [main] INFO b.s.d.nimbus - [req 1] Access from: principal: op:submitTopology&gt; 7113 [main] INFO b.s.d.nimbus - Received topology submission for wordCounter with conf {\"topology.max.task.parallelism\" nil, \"topology.submitter.principal\" \"\", \"topology.acker.executors\" nil, \"topology.max.spout.pending\" 20, \"storm.zookeeper.superACL\" nil, \"topology.users\" (), \"topology.submitter.user\" \"\", \"topology.kryo.register\" {\"storm.trident.topology.TransactionAttempt\" nil, \"storm.trident.spout.RichSpoutBatchId\" \"storm.trident.spout.RichSpoutBatchIdSerializer\"}, \"topology.kryo.decorators\" (), \"storm.id\" \"wordCounter-1-1468420782\", \"topology.name\" \"wordCounter\"}&gt; 7123 [main] INFO b.s.d.nimbus - nimbus file location:/var/folders/c0/0bgvmbb10jz1609_1xjqdsj00000gn/T//333ed6da-9ef5-4781-bd82-4f315facd4a8/nimbus/stormdist/wordCounter-1-1468420782&gt; 7152 [main] INFO b.s.d.nimbus - Activating wordCounter: wordCounter-1-1468420782&gt; 7346 [main] INFO b.s.s.EvenScheduler - Available slots: ([\"49c35a73-7500-4ea4-aaa2-4b1c1f231fd4\" 1027] [\"49c35a73-7500-4ea4-aaa2-4b1c1f231fd4\" 1028] [\"49c35a73-7500-4ea4-aaa2-4b1c1f231fd4\" 1029] [\"913c90f6-3f78-4646-8998-aa901ae3c360\" 1024] [\"913c90f6-3f78-4646-8998-aa901ae3c360\" 1025] [\"913c90f6-3f78-4646-8998-aa901ae3c360\" 1026])&gt; 7398 [main] INFO b.s.d.nimbus - Setting new assignment for topology id wordCounter-1-1468420782: #backtype.storm.daemon.common.Assignment{:master-code-dir \"/var/folders/c0/0bgvmbb10jz1609_1xjqdsj00000gn/T//333ed6da-9ef5-4781-bd82-4f315facd4a8/nimbus/stormdist/wordCounter-1-1468420782\", :node-&gt;host {\"49c35a73-7500-4ea4-aaa2-4b1c1f231fd4\" \"localhost\"}, :executor-&gt;node+port {[8 8] [\"49c35a73-7500-4ea4-aaa2-4b1c1f231fd4\" 1027], [12 12] [\"49c35a73-7500-4ea4-aaa2-4b1c1f231fd4\" 1027], [2 2] [\"49c35a73-7500-4ea4-aaa2-4b1c1f231fd4\" 1027], [7 7] [\"49c35a73-7500-4ea4-aaa2-4b1c1f231fd4\" 1027], [22 22] [\"49c35a73-7500-4ea4-aaa2-4b1c1f231fd4\" 1027], [3 3] [\"49c35a73-7500-4ea4-aaa2-4b1c1f231fd4\" 1027], [24 24] [\"49c35a73-7500-4ea4-aaa2-4b1c1f231fd4\" 1027], [1 1] [\"49c35a73-7500-4ea4-aaa2-4b1c1f231fd4\" 1027], [18 18] [\"49c35a73-7500-4ea4-aaa2-4b1c1f231fd4\" 1027], [6 6] [\"49c35a73-7500-4ea4-aaa2-4b1c1f231fd4\" 1027], [20 20] [\"49c35a73-7500-4ea4-aaa2-4b1c1f231fd4\" 1027], [9 9] [\"49c35a73-7500-4ea4-aaa2-4b1c1f231fd4\" 1027], [23 23] [\"49c35a73-7500-4ea4-aaa2-4b1c1f231fd4\" 1027], [11 11] [\"49c35a73-7500-4ea4-aaa2-4b1c1f231fd4\" 1027], [16 16] [\"49c35a73-7500-4ea4-aaa2-4b1c1f231fd4\" 1027], [13 13] [\"49c35a73-7500-4ea4-aaa2-4b1c1f231fd4\" 1027], [19 19] [\"49c35a73-7500-4ea4-aaa2-4b1c1f231fd4\" 1027], [21 21] [\"49c35a73-7500-4ea4-aaa2-4b1c1f231fd4\" 1027], [5 5] [\"49c35a73-7500-4ea4-aaa2-4b1c1f231fd4\" 1027], [26 26] [\"49c35a73-7500-4ea4-aaa2-4b1c1f231fd4\" 1027], [10 10] [\"49c35a73-7500-4ea4-aaa2-4b1c1f231fd4\" 1027], [14 14] [\"49c35a73-7500-4ea4-aaa2-4b1c1f231fd4\" 1027], [4 4] [\"49c35a73-7500-4ea4-aaa2-4b1c1f231fd4\" 1027], [15 15] [\"49c35a73-7500-4ea4-aaa2-4b1c1f231fd4\" 1027], [25 25] [\"49c35a73-7500-4ea4-aaa2-4b1c1f231fd4\" 1027], [17 17] [\"49c35a73-7500-4ea4-aaa2-4b1c1f231fd4\" 1027]}, :executor-&gt;start-time-secs {[8 8] 1468420782, [12 12] 1468420782, [2 2] 1468420782, [7 7] 1468420782, [22 22] 1468420782, [3 3] 1468420782, [24 24] 1468420782, [1 1] 1468420782, [18 18] 1468420782, [6 6] 1468420782, [20 20] 1468420782, [9 9] 1468420782, [23 23] 1468420782, [11 11] 1468420782, [16 16] 1468420782, [13 13] 1468420782, [19 19] 1468420782, [21 21] 1468420782, [5 5] 1468420782, [26 26] 1468420782, [10 10] 1468420782, [14 14] 1468420782, [4 4] 1468420782, [15 15] 1468420782, [25 25] 1468420782, [17 17] 1468420782}}&gt; 7751 [Thread-7] INFO b.s.d.supervisor - Extracting resources from jar at /Library/Java/JavaVirtualMachines/jdk1.7.0_79.jdk/Contents/Home/lib/ant-javafx.jar to /var/folders/c0/0bgvmbb10jz1609_1xjqdsj00000gn/T//29645b09-90e9-4b9a-a657-60c418f92841/supervisor/stormdist/wordCounter-1-1468420782/resources&gt; 7788 [Thread-8] INFO b.s.d.supervisor - Launching worker with assignment {:storm-id \"wordCounter-1-1468420782\", :executors [[8 8] [12 12] [2 2] [7 7] [22 22] [3 3] [24 24] [1 1] [18 18] [6 6] [20 20] [9 9] [23 23] [11 11] [16 16] [13 13] [19 19] [21 21] [5 5] [26 26] [10 10] [14 14] [4 4] [15 15] [25 25] [17 17]]} for this supervisor 49c35a73-7500-4ea4-aaa2-4b1c1f231fd4 on port 1027 with id 9dd8aeac-1cd6-467a-a84c-2637d0825d99&gt; 7791 [Thread-8] INFO b.s.d.worker - Launching worker for wordCounter-1-1468420782 on 49c35a73-7500-4ea4-aaa2-4b1c1f231fd4:1027 with id 9dd8aeac-1cd6-467a-a84c-2637d0825d99 and conf {\"topology.builtin.metrics.bucket.size.secs\" 60, ......&gt; 7793 [Thread-8] INFO b.s.u.StormBoundedExponentialBackoffRetry - The baseSleepTimeMs [1000] the maxSleepTimeMs [30000] the maxRetries [5]&gt; 7794 [Thread-8] INFO o.a.c.f.i.CuratorFrameworkImpl - Starting&gt; 7798 [Thread-8-EventThread] INFO o.a.c.f.s.ConnectionStateManager - State change: CONNECTED&gt; 7798 [Thread-8-EventThread] INFO b.s.zookeeper - Zookeeper state update: :connected:none&gt; 7801 [Thread-8] INFO b.s.u.StormBoundedExponentialBackoffRetry - The baseSleepTimeMs [1000] the maxSleepTimeMs [30000] the maxRetries [5]&gt; 7802 [Thread-8] INFO o.a.c.f.i.CuratorFrameworkImpl - Starting&gt; 7805 [Thread-8-EventThread] INFO o.a.c.f.s.ConnectionStateManager - State change: CONNECTED&gt; 7809 [Thread-8] INFO b.s.s.a.AuthUtils - Got AutoCreds []&gt; 7811 [Thread-8] INFO b.s.d.worker - Reading Assignments.&gt; 7881 [Thread-8] INFO b.s.d.worker - Launching receive-thread for 49c35a73-7500-4ea4-aaa2-4b1c1f231fd4:1027&gt; 7884 [Thread-9-worker-receiver-thread-0] INFO b.s.m.loader - Starting receive-thread: [stormId: wordCounter-1-1468420782, port: 1027, thread-id: 0 ]&gt; 8261 [Thread-8] INFO b.s.d.executor - Loading executor b-2:[8 8]&gt; 8285 [Thread-8] INFO b.s.d.executor - Loaded executor tasks b-2:[8 8]&gt; 8300 [Thread-8] INFO b.s.d.executor - Finished loading executor b-2:[8 8]&gt; 8311 [Thread-8] INFO b.s.d.executor - Loading executor b-2:[12 12]&gt; 8329 [Thread-8] INFO b.s.d.executor - Loaded executor tasks b-2:[12 12]&gt; 8331 [Thread-8] INFO b.s.d.executor - Finished loading executor b-2:[12 12]&gt; 8340 [Thread-8] INFO b.s.d.executor - Loading executor $spoutcoord-spout0:[2 2]&gt; 8343 [Thread-8] INFO b.s.d.executor - Loaded executor tasks $spoutcoord-spout0:[2 2]&gt; 8346 [Thread-8] INFO b.s.d.executor - Finished loading executor $spoutcoord-spout0:[2 2]&gt; 8355 [Thread-8] INFO b.s.d.executor - Loading executor b-2:[7 7]&gt; 8372 [Thread-8] INFO b.s.d.executor - Loaded executor tasks b-2:[7 7]&gt; 8375 [Thread-8] INFO b.s.d.executor - Finished loading executor b-2:[7 7]&gt; 8381 [Thread-8] INFO b.s.d.executor - Loading executor b-3:[22 22]&gt; 8401 [Thread-8] INFO b.s.d.executor - Loaded executor tasks b-3:[22 22]&gt; 8404 [Thread-8] INFO b.s.d.executor - Finished loading executor b-3:[22 22]&gt; 8412 [Thread-8] INFO b.s.d.executor - Loading executor __acker:[3 3]&gt; 8414 [Thread-8] INFO b.s.d.executor - Loaded executor tasks __acker:[3 3]&gt; 8424 [Thread-8] INFO b.s.d.executor - Timeouts disabled for executor __acker:[3 3]&gt; 8425 [Thread-8] INFO b.s.d.executor - Finished loading executor __acker:[3 3]&gt; 8443 [Thread-8] INFO b.s.d.executor - Loading executor b-5:[24 24]&gt; 8465 [Thread-8] INFO b.s.d.executor - Loaded executor tasks b-5:[24 24]&gt; 8467 [Thread-8] INFO b.s.d.executor - Finished loading executor b-5:[24 24]&gt; 8530 [Thread-8] INFO b.s.d.executor - Loading executor $mastercoord-bg0:[1 1]&gt; 8539 [Thread-8] INFO b.s.d.executor - Loaded executor tasks $mastercoord-bg0:[1 1]&gt; 8576 [Thread-8] INFO b.s.d.executor - Finished loading executor $mastercoord-bg0:[1 1]&gt; 8603 [Thread-8] INFO b.s.d.executor - Loading executor b-2:[18 18]&gt; 8633 [Thread-8] INFO b.s.d.executor - Loaded executor tasks b-2:[18 18]&gt; 8635 [Thread-8] INFO b.s.d.executor - Finished loading executor b-2:[18 18]&gt; 8646 [Thread-8] INFO b.s.d.executor - Loading executor b-2:[6 6]&gt; 8681 [Thread-8] INFO b.s.d.executor - Loaded executor tasks b-2:[6 6]&gt; 8683 [Thread-8] INFO b.s.d.executor - Finished loading executor b-2:[6 6]&gt; 8719 [Thread-8] INFO b.s.d.executor - Loading executor b-2:[20 20]&gt; 8757 [Thread-8] INFO b.s.d.executor - Loaded executor tasks b-2:[20 20]&gt; 8763 [Thread-8] INFO b.s.d.executor - Finished loading executor b-2:[20 20]&gt; 8782 [Thread-8] INFO b.s.d.executor - Loading executor b-2:[9 9]&gt; 8808 [Thread-8] INFO b.s.d.executor - Loaded executor tasks b-2:[9 9]&gt; 8818 [Thread-8] INFO b.s.d.executor - Finished loading executor b-2:[9 9]&gt; 8828 [Thread-8] INFO b.s.d.executor - Loading executor b-4:[23 23]&gt; 8847 [Thread-8] INFO b.s.d.executor - Loaded executor tasks b-4:[23 23]&gt; 8851 [Thread-8] INFO b.s.d.executor - Finished loading executor b-4:[23 23]&gt; 8858 [refresh-active-timer] INFO b.s.d.worker - All connections are ready for worker 49c35a73-7500-4ea4-aaa2-4b1c1f231fd4:1027 with id 9dd8aeac-1cd6-467a-a84c-2637d0825d99&gt; 8864 [Thread-8] INFO b.s.d.executor - Loading executor b-2:[11 11]&gt; 8877 [Thread-8] INFO b.s.d.executor - Loaded executor tasks b-2:[11 11]&gt; 8879 [Thread-8] INFO b.s.d.executor - Finished loading executor b-2:[11 11]&gt; 8886 [Thread-8] INFO b.s.d.executor - Loading executor __system:[-1 -1]&gt; 8887 [Thread-8] INFO b.s.d.executor - Loaded executor tasks __system:[-1 -1]&gt; 8890 [Thread-8] INFO b.s.d.executor - Finished loading executor __system:[-1 -1]&gt; 8914 [Thread-8] INFO b.s.d.executor - Loading executor b-2:[16 16]&gt; 9052 [Thread-8] INFO b.s.d.executor - Loaded executor tasks b-2:[16 16]&gt; 9055 [Thread-8] INFO b.s.d.executor - Finished loading executor b-2:[16 16]&gt; 9070 [Thread-8] INFO b.s.d.executor - Loading executor b-2:[13 13]&gt; 9081 [Thread-8] INFO b.s.d.executor - Loaded executor tasks b-2:[13 13]&gt; 9089 [Thread-8] INFO b.s.d.executor - Finished loading executor b-2:[13 13]&gt; 9116 [Thread-8] INFO b.s.d.executor - Loading executor b-2:[19 19]&gt; 9129 [Thread-8] INFO b.s.d.executor - Loaded executor tasks b-2:[19 19]&gt; 9132 [Thread-8] INFO b.s.d.executor - Finished loading executor b-2:[19 19]&gt; 9148 [Thread-8] INFO b.s.d.executor - Loading executor b-2:[21 21]&gt; 9160 [Thread-8] INFO b.s.d.executor - Loaded executor tasks b-2:[21 21]&gt; 9163 [Thread-8] INFO b.s.d.executor - Finished loading executor b-2:[21 21]&gt; 9178 [Thread-8] INFO b.s.d.executor - Loading executor b-1:[5 5]&gt; 9192 [Thread-8] INFO b.s.d.executor - Loaded executor tasks b-1:[5 5]&gt; 9194 [Thread-8] INFO b.s.d.executor - Finished loading executor b-1:[5 5]&gt; 9204 [Thread-8] INFO b.s.d.executor - Loading executor spout1:[26 26]&gt; 9205 [Thread-8] INFO b.s.d.executor - Loaded executor tasks spout1:[26 26]&gt; 9208 [Thread-8] INFO b.s.d.executor - Finished loading executor spout1:[26 26]&gt; 9220 [Thread-8] INFO b.s.d.executor - Loading executor b-2:[10 10]&gt; 9226 [Thread-8] INFO b.s.d.executor - Loaded executor tasks b-2:[10 10]&gt; 9228 [Thread-8] INFO b.s.d.executor - Finished loading executor b-2:[10 10]&gt; 9234 [Thread-8] INFO b.s.d.executor - Loading executor b-2:[14 14]&gt; 9237 [Thread-8] INFO b.s.d.executor - Loaded executor tasks b-2:[14 14]&gt; 9239 [Thread-8] INFO b.s.d.executor - Finished loading executor b-2:[14 14]&gt; 9244 [Thread-8] INFO b.s.d.executor - Loading executor b-0:[4 4]&gt; 9248 [Thread-8] INFO b.s.d.executor - Loaded executor tasks b-0:[4 4]&gt; 9249 [Thread-8] INFO b.s.d.executor - Finished loading executor b-0:[4 4]&gt; 9255 [Thread-8] INFO b.s.d.executor - Loading executor b-2:[15 15]&gt; 9260 [Thread-8] INFO b.s.d.executor - Loaded executor tasks b-2:[15 15]&gt; 9261 [Thread-8] INFO b.s.d.executor - Finished loading executor b-2:[15 15]&gt; 9273 [Thread-8] INFO b.s.d.executor - Loading executor spout0:[25 25]&gt; 9275 [Thread-8] INFO b.s.d.executor - Loaded executor tasks spout0:[25 25]&gt; 9277 [Thread-8] INFO b.s.d.executor - Finished loading executor spout0:[25 25]&gt; 9284 [Thread-8] INFO b.s.d.executor - Loading executor b-2:[17 17]&gt; 9289 [Thread-8] INFO b.s.d.executor - Loaded executor tasks b-2:[17 17]&gt; 9291 [Thread-8] INFO b.s.d.executor - Finished loading executor b-2:[17 17]&gt; 9298 [Thread-8] INFO b.s.d.worker - Worker has topology config {\"topology.builtin.metrics.bucket.size.secs\" 60, ......&gt; 9298 [Thread-8] INFO b.s.d.worker - Worker 9dd8aeac-1cd6-467a-a84c-2637d0825d99 for storm wordCounter-1-1468420782 on 49c35a73-7500-4ea4-aaa2-4b1c1f231fd4:1027 has finished loading&gt; 9298 [Thread-8] INFO b.s.config - SET worker-user 9dd8aeac-1cd6-467a-a84c-2637d0825d99&gt; 9875 [Thread-27-b-2] INFO b.s.d.executor - Preparing bolt b-2:(18)&gt; 9882 [Thread-35-b-4] INFO b.s.d.executor - Preparing bolt b-4:(23)&gt; 9882 [Thread-41-b-2] INFO b.s.d.executor - Preparing bolt b-2:(16)&gt; 9883 [Thread-13-b-2] INFO b.s.d.executor - Preparing bolt b-2:(12)&gt; 9883 [Thread-59-b-2] INFO b.s.d.executor - Preparing bolt b-2:(15)&gt; 9883 [Thread-47-b-2] INFO b.s.d.executor - Preparing bolt b-2:(21)&gt; 9893 [Thread-35-b-4] INFO b.s.d.executor - Prepared bolt b-4:(23)&gt; 9896 [Thread-47-b-2] INFO b.s.d.executor - Prepared bolt b-2:(21)&gt; 9896 [Thread-59-b-2] INFO b.s.d.executor - Prepared bolt b-2:(15)&gt; 9896 [Thread-27-b-2] INFO b.s.d.executor - Prepared bolt b-2:(18)&gt; 9896 [Thread-13-b-2] INFO b.s.d.executor - Prepared bolt b-2:(12)&gt; 9896 [Thread-41-b-2] INFO b.s.d.executor - Prepared bolt b-2:(16)&gt; 9898 [Thread-31-b-2] INFO b.s.d.executor - Preparing bolt b-2:(20)&gt; 9898 [Thread-15-$spoutcoord-spout0] INFO b.s.d.executor - Preparing bolt $spoutcoord-spout0:(2)&gt; 9899 [Thread-61-spout0] INFO b.s.d.executor - Preparing bolt spout0:(25)&gt; 9900 [Thread-15-$spoutcoord-spout0] INFO b.s.u.StormBoundedExponentialBackoffRetry - The baseSleepTimeMs [1000] the maxSleepTimeMs [30000] the maxRetries [5]&gt; 9900 [Thread-61-spout0] INFO b.s.d.executor - Prepared bolt spout0:(25)&gt; 9901 [Thread-15-$spoutcoord-spout0] INFO o.a.c.f.i.CuratorFrameworkImpl - Starting&gt; 9901 [Thread-31-b-2] INFO b.s.d.executor - Prepared bolt b-2:(20)&gt; 9907 [Thread-15-$spoutcoord-spout0-EventThread] INFO o.a.c.f.s.ConnectionStateManager - State change: CONNECTED&gt; 9908 [Thread-43-b-2] INFO b.s.d.executor - Preparing bolt b-2:(13)&gt; 9908 [Thread-37-b-2] INFO b.s.d.executor - Preparing bolt b-2:(11)&gt; 9908 [Thread-63-b-2] INFO b.s.d.executor - Preparing bolt b-2:(17)&gt; 9910 [Thread-43-b-2] INFO b.s.d.executor - Prepared bolt b-2:(13)&gt; 9910 [Thread-37-b-2] INFO b.s.d.executor - Prepared bolt b-2:(11)&gt; 9911 [Thread-63-b-2] INFO b.s.d.executor - Prepared bolt b-2:(17)&gt; 9918 [Thread-49-b-1] INFO b.s.d.executor - Preparing bolt b-1:(5)&gt; 9918 [Thread-39-__system] INFO b.s.d.executor - Preparing bolt __system:(-1)&gt; 9918 [Thread-29-b-2] INFO b.s.d.executor - Preparing bolt b-2:(6)&gt; 9920 [Thread-49-b-1] INFO b.s.d.executor - Prepared bolt b-1:(5)&gt; 9920 [Thread-29-b-2] INFO b.s.d.executor - Prepared bolt b-2:(6)&gt; 9921 [Thread-15-$spoutcoord-spout0] INFO b.s.u.StormBoundedExponentialBackoffRetry - The baseSleepTimeMs [1000] the maxSleepTimeMs [30000] the maxRetries [5]&gt; 9922 [Thread-15-$spoutcoord-spout0] INFO o.a.c.f.i.CuratorFrameworkImpl - Starting&gt; 9924 [Thread-39-__system] INFO b.s.d.executor - Prepared bolt __system:(-1)&gt; 9929 [Thread-51-spout1] INFO b.s.d.executor - Opening spout spout1:(26)&gt; 9929 [Thread-25-$mastercoord-bg0] INFO b.s.d.executor - Opening spout $mastercoord-bg0:(1)&gt; 9929 [Thread-15-$spoutcoord-spout0-EventThread] INFO o.a.c.f.s.ConnectionStateManager - State change: CONNECTED&gt; 9938 [Thread-51-spout1] INFO b.s.d.executor - Opened spout spout1:(26)&gt; 9937 [Thread-25-$mastercoord-bg0] INFO b.s.u.StormBoundedExponentialBackoffRetry - The baseSleepTimeMs [1000] the maxSleepTimeMs [30000] the maxRetries [5]&gt; 9940 [Thread-25-$mastercoord-bg0] INFO o.a.c.f.i.CuratorFrameworkImpl - Starting&gt; 9940 [Thread-33-b-2] INFO b.s.d.executor - Preparing bolt b-2:(9)&gt; 9942 [Thread-51-spout1] INFO b.s.d.executor - Activating spout spout1:(26)&gt; 9942 [Thread-33-b-2] INFO b.s.d.executor - Prepared bolt b-2:(9)&gt; 9947 [Thread-53-b-2] INFO b.s.d.executor - Preparing bolt b-2:(10)&gt; 9950 [Thread-53-b-2] INFO b.s.d.executor - Prepared bolt b-2:(10)&gt; 9956 [Thread-11-b-2] INFO b.s.d.executor - Preparing bolt b-2:(8)&gt; 9956 [Thread-45-b-2] INFO b.s.d.executor - Preparing bolt b-2:(19)&gt; 9957 [Thread-23-b-5] INFO b.s.d.executor - Preparing bolt b-5:(24)&gt; 9958 [Thread-23-b-5] INFO b.s.d.executor - Prepared bolt b-5:(24)&gt; 9958 [Thread-11-b-2] INFO b.s.d.executor - Prepared bolt b-2:(8)&gt; 9958 [Thread-17-b-2] INFO b.s.d.executor - Preparing bolt b-2:(7)&gt; 9959 [Thread-55-b-2] INFO b.s.d.executor - Preparing bolt b-2:(14)&gt; 9959 [Thread-19-b-3] INFO b.s.d.executor - Preparing bolt b-3:(22)&gt; 9960 [Thread-19-b-3] INFO b.s.d.executor - Prepared bolt b-3:(22)&gt; 9960 [Thread-25-$mastercoord-bg0-EventThread] INFO o.a.c.f.s.ConnectionStateManager - State change: CONNECTED&gt; 9960 [Thread-17-b-2] INFO b.s.d.executor - Prepared bolt b-2:(7)&gt; 9962 [Thread-45-b-2] INFO b.s.d.executor - Prepared bolt b-2:(19)&gt; 9963 [Thread-55-b-2] INFO b.s.d.executor - Prepared bolt b-2:(14)&gt; 9964 [Thread-57-b-0] INFO b.s.d.executor - Preparing bolt b-0:(4)&gt; 9964 [Thread-21-__acker] INFO b.s.d.executor - Preparing bolt __acker:(3)&gt; 9965 [Thread-57-b-0] INFO b.s.d.executor - Prepared bolt b-0:(4)&gt; 9966 [Thread-21-__acker] INFO b.s.d.executor - Prepared bolt __acker:(3)&gt; 9969 [Thread-15-$spoutcoord-spout0] INFO b.s.d.executor - Prepared bolt $spoutcoord-spout0:(2)&gt; 9971 [Thread-25-$mastercoord-bg0] INFO b.s.u.StormBoundedExponentialBackoffRetry - The baseSleepTimeMs [1000] the maxSleepTimeMs [30000] the maxRetries [5]&gt; 9972 [Thread-25-$mastercoord-bg0] INFO o.a.c.f.i.CuratorFrameworkImpl - Starting&gt; 9984 [Thread-25-$mastercoord-bg0-EventThread] INFO o.a.c.f.s.ConnectionStateManager - State change: CONNECTED&gt; DRPC RESULT: [[0]]&gt; 9988 [Thread-25-$mastercoord-bg0] INFO b.s.d.executor - Opened spout $mastercoord-bg0:(1)&gt; 9988 [Thread-25-$mastercoord-bg0] INFO b.s.d.executor - Activating spout $mastercoord-bg0:(1)&gt; DRPC RESULT: [[60]]&gt; DRPC RESULT: [[120]]&gt; DRPC RESULT: [[179]]&gt; DRPC RESULT: [[239]]&gt; DRPC RESULT: [[299]]&gt; DRPC RESULT: [[359]]&gt; DRPC RESULT: [[414]]&gt; DRPC RESULT: [[474]]&gt; DRPC RESULT: [[534]]&gt; DRPC RESULT: [[593]]&gt; DRPC RESULT: [[653]]&gt; DRPC RESULT: [[713]]&gt; DRPC RESULT: [[768]]&gt;&gt; Process finished with exit code 130","raw":null,"content":null,"categories":[{"name":"Storm","slug":"Storm","permalink":"https://maohong.github.io/categories/Storm/"}],"tags":[{"name":"storm","slug":"storm","permalink":"https://maohong.github.io/tags/storm/"},{"name":"æºç ç¼–è¯‘","slug":"æºç ç¼–è¯‘","permalink":"https://maohong.github.io/tags/%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91/"},{"name":"æœ¬åœ°è°ƒè¯•","slug":"æœ¬åœ°è°ƒè¯•","permalink":"https://maohong.github.io/tags/%E6%9C%AC%E5%9C%B0%E8%B0%83%E8%AF%95/"}]},{"title":"hadoop-yarnä¸­ResourceManagerçš„æœåŠ¡æ¨¡å—","slug":"hadoop-yarnä¸­ResourceManagerçš„æœåŠ¡æ¨¡å—","date":"2016-06-06T05:10:10.000Z","updated":"2016-06-06T05:10:10.000Z","comments":true,"path":"20160606/hadoop-yarnä¸­ResourceManagerçš„æœåŠ¡æ¨¡å—/","permalink":"https://maohong.github.io/20160606/hadoop-yarn%E4%B8%ADResourceManager%E7%9A%84%E6%9C%8D%E5%8A%A1%E6%A8%A1%E5%9D%97/","excerpt":"","keywords":null,"text":"Yarnç®€è¿° Hadoop2.0å¼•å…¥äº†yarnï¼ˆYet Another Resource Negotiatorï¼‰èµ„æºç®¡ç†æ¡†æ¶ã€‚1.0ä¸­çš„MapReduceè®¡ç®—æ¡†æ¶å˜ä¸ºè¿è¡Œåœ¨yarnä¸Šçš„ä¸€ç§applicationã€‚ Yarnä¾ç„¶é‡‡ç”¨äº†master/slaveç»“æ„ï¼Œmasteræ˜¯ResourceManagerï¼Œè´Ÿè´£æ•´ä¸ªé›†ç¾¤çš„èµ„æºç®¡ç†å’Œè°ƒåº¦ï¼Œå¹¶ä¸”æ”¯æŒHAï¼Œslaveæ˜¯NodeManagerï¼Œè´Ÿè´£ç®¡ç†å„å­èŠ‚ç‚¹ä¸Šçš„èµ„æºå’Œä»»åŠ¡ã€‚æ¯ä¸ªMapReduceä½œä¸šæäº¤ç»™ResourceManagerå¹¶è¢«æ¥å—åï¼ŒResourceManagerä¼šé€šçŸ¥æŸä¸ªNodeManagerå¯åŠ¨ä¸€ä¸ªApplicationMasterç®¡ç†æ­¤ä½œä¸šçš„ç”Ÿå‘½å‘¨æœŸã€‚ ResourceManagerä¸­çš„æ¨¡å—åˆ’åˆ† Yarnä¸­çš„å¤§å¤šæ•°æœåŠ¡éƒ½æ˜¯å¸¦çŠ¶æ€çš„serviceå®ç°ï¼Œå¹¶é€šè¿‡äº‹ä»¶é©±åŠ¨æœºåˆ¶å®ç°æœåŠ¡çš„çŠ¶æ€è½¬æ¢å’ŒæœåŠ¡ä¹‹é—´çš„äº¤äº’ã€‚ResourceManageræ˜¯yarnçš„æ ¸å¿ƒç»„ä»¶ï¼Œä¸NodeManagerã€ApplicationMasterã€Clientéƒ½æœ‰äº¤äº’ï¼Œæä¾›äº†éå¸¸å¤šçš„åŠŸèƒ½ï¼Œä¸‹é¢åŸºäºhadoop2.7ç‰ˆæœ¬çš„å®ç°ï¼Œæ¢³ç†ä¸€ä¸‹ResourceManagerä¸­çš„é‡è¦serviceç»„ä»¶åŠå…¶åŠŸèƒ½ã€‚ ResourceManagerä¸­æŒ‰åŠŸèƒ½åˆ’åˆ†çš„serviceæ¨¡å—å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ ResourceManagerä¸­æ ¸å¿ƒæ¨¡å—ä¸»è¦åŒ…æ‹¬å®¢æˆ·ç«¯äº¤äº’æ¨¡å—ã€NodeManagerç®¡ç†æ¨¡å—ã€ApplicationMasterç®¡ç†æ¨¡å—ã€Applicationç®¡ç†æ¨¡å—ã€å®‰å…¨ç®¡ç†æ¨¡å—ã€ä»¥åŠèµ„æºç®¡ç†æ¨¡å—ï¼ˆè°ƒåº¦ã€é¢„ç•™ï¼‰ç­‰ã€‚ å„æ¨¡å—ä¸­çš„æœåŠ¡ä»‹ç» å®¢æˆ·ç«¯äº¤äº’æ¨¡å—ï¼š AdminService ç®¡ç†å‘˜å¯é€šè¿‡æ­¤æ¥å£ç®¡ç†é›†ç¾¤ï¼Œå¦‚æ›´æ–°èŠ‚ç‚¹ã€æ›´æ–°ACLã€æ›´æ–°é˜Ÿåˆ—ç­‰ã€‚å†…éƒ¨æœ‰ä¸ªEmbeddedElectorServiceï¼Œå¦‚æœRMå¯ç”¨äº†è‡ªåŠ¨HAï¼Œåˆ™é€šè¿‡è¿™ä¸ªserviceåšleader electionã€‚ ClientRMService è´Ÿè´£ä¸ºå®¢æˆ·ç«¯æä¾›æœåŠ¡ï¼Œæ˜¯ApplicationClientProtocolåè®®çš„æœåŠ¡ç«¯ã€‚è´Ÿè´£å¤„ç†æ¥è‡ªå®¢æˆ·ç«¯çš„RPCè¯·æ±‚ï¼ŒåŒ…æ‹¬æäº¤appã€æŸ¥è¯¢appè¿è¡ŒçŠ¶æ€ã€ç»ˆæ­¢appç­‰ã€‚ Webapp æä¾›webé¡µé¢æœåŠ¡ï¼Œå±•ç¤ºé›†ç¾¤çŠ¶æ€å’Œèµ„æºä½¿ç”¨æƒ…å†µã€‚ NodeManagerç®¡ç†æ¨¡å— NMLivelinessMonitor ç”¨äºç›‘æ§NMæ˜¯å¦å­˜æ´»ï¼Œè‹¥NMåœ¨ä¸€å®šæ—¶é—´å†…ï¼ˆé»˜è®¤10åˆ†é’Ÿï¼‰æœªä¸ŠæŠ¥å¿ƒè·³ï¼Œåˆ™è®¤ä¸ºå…¶æŒ‚äº†ã€‚ NodesListManager è´Ÿè´£ç»´æŠ¤èŠ‚ç‚¹åˆ—è¡¨ï¼Œå¹¶åŠ¨æ€åŠ è½½ç™½åå•ï¼ˆyarn.resourcemanager.nodes.include-pathï¼‰å’Œé»‘åå•ï¼ˆyarn.resourcemanager.nodes.exlude-pathï¼‰èŠ‚ç‚¹ã€‚ RMNodeLabelsManager è´Ÿè´£èŠ‚ç‚¹çš„æ ‡ç­¾ç®¡ç†ã€‚ ResourceTrackerService è´Ÿè´£ä¸NodeManageré€šä¿¡ï¼Œå¤„ç†æ¥è‡ªNodeManagerçš„è¯·æ±‚ï¼ŒåŒ…æ‹¬æ³¨å†ŒNodeManagerå’ŒèŠ‚ç‚¹å¿ƒè·³ä¸¤ç§ã€‚æ¥å£å®šä¹‰åœ¨ResourceTrackerä¸­ã€‚ ApplicationMasterç®¡ç†æ¨¡å— AMLivelinessMonitorï¼šä¸¤ä¸ªå®ä¾‹ ç”¨äºç›‘æ§ApplicationMasteræ˜¯å¦æ­£å¸¸ï¼Œå¦‚æœåœ¨æŒ‡å®šæ—¶é—´å†…ï¼ˆé»˜è®¤10åˆ†é’Ÿï¼‰æœªæ”¶åˆ°AMçš„å¿ƒè·³ï¼Œåˆ™è®¤ä¸ºå…¶æ­»æ‰äº†ã€‚ ApplicationMasterLauncher è´Ÿè´£é€šçŸ¥æŸä¸ªNodeManagerå¯åŠ¨æˆ–é”€æ¯ApplicationMasterã€‚åœ¨appè¯·æ±‚è¢«æ¥å—åï¼Œä¸æŸä¸ªNodeManageré€šä¿¡ï¼Œå‘ŠçŸ¥å…¶ä¸ºæ­¤appå¯åŠ¨ç›¸åº”çš„ApplicationMasterã€‚è‹¥appè¿è¡Œç»“æŸæˆ–è¢«killï¼Œåˆ™é€šçŸ¥appæ‰€åœ¨NodeManageré”€æ¯ApplicationMasterã€‚å…¶å†…éƒ¨ä¹Ÿç»´æŠ¤äº†ä¸€ä¸ªé˜»å¡é˜Ÿåˆ—ï¼Œå¹¶æœ‰ä¸€ä¸ªåå°çº¿ç¨‹å¼‚æ­¥å¤„ç†æäº¤è¿›æ¥çš„å¯åŠ¨ApplicationMasterçš„è¯·æ±‚ã€‚ ApplicationMasterService è´Ÿè´£ä¸ApplicationMasteré€šä¿¡ï¼Œæ˜¯ApplicationMasterProtocolåè®®çš„æœåŠ¡ç«¯ï¼ŒApplicationMasteråœ¨NodeManagerä¸Šå¯åŠ¨åé€šè¿‡æ­¤åè®®å‘ResourceManageræ³¨å†Œè‡ªå·±ï¼Œè¿è¡Œè¿‡ç¨‹ä¸­å‘ResourceManagerå‘é€å¿ƒè·³ï¼Œä»¥åŠappè¿è¡Œç»“æŸåå‘ŠçŸ¥RMè‡ªå·±æ‰€åœ¨çš„containerå¯ä»¥è¢«é‡Šæ”¾äº†ã€‚ Applicationç®¡ç†æ¨¡å— RMAppManager ResourceManageræ¥å—å®¢æˆ·ç«¯æäº¤çš„appåï¼Œä¼šé€šè¿‡RMAppManageræ¥è§¦å‘å¯åŠ¨appçš„äº‹ä»¶RMAppEventType.STARTï¼Œå…·ä½“å¯åŠ¨appçš„å·¥ä½œç”±RMAppImplå®ç°ã€‚ ApplicationACLsManager è´Ÿè´£appæƒé™æ§åˆ¶ï¼ŒåŒ…æ‹¬æŸ¥çœ‹å’Œä¿®æ”¹æƒé™ã€‚ ContainerAllocationExpirer ç”¨äºç›‘å¬NodeManagerä¸Šæ˜¯å¦æ­£å¸¸å¯åŠ¨äº†åˆ†é…ç»™ApplicationMasterçš„containerï¼Œè‹¥åœ¨æŒ‡å®šæ—¶é—´æœªå¯åŠ¨ï¼ˆé»˜è®¤10åˆ†é’Ÿï¼‰ï¼ŒResourceManagerä¼šå¼ºåˆ¶å›æ”¶è¯¥containerã€‚ RMApplicationHistoryWriter è´Ÿè´£å¼‚æ­¥æŒä¹…åŒ–Applicationè¿è¡Œä¸­çš„ç›¸å…³æ—¥å¿—ï¼Œä¸»è¦æ˜¯Containerã€Applicationã€ApplicationAttemptåœ¨å¯åŠ¨å’Œç»“æŸæ—¶çš„æ—¥å¿—ä¿¡æ¯ã€‚ å®‰å…¨ç®¡ç†æ¨¡å— RMSecretManagerService è´Ÿè´£ç®¡ç†å„ç§é€šä¿¡å¯†é’¥ï¼ŒåŒ…æ‹¬ï¼š RMä¸NMé€šä¿¡çš„NMTokenSecretManagerInRM RMä¸containeré€šä¿¡çš„RMContainerTokenSecretManager å®¢æˆ·ç«¯ä¸AMé€šä¿¡çš„ClientToAMTokenSecretManagerInRM AMä¸RMé€šä¿¡çš„AMRMTokenSecretManager DelegationTokenRenewer å¯ç”¨äº†å®‰å…¨æ—¶ï¼Œè´Ÿè´£å®šæ—¶æ›´æ–°è®¤è¯tokenã€‚ èµ„æºç®¡ç†æ¨¡å— ResourceScheduler èµ„æºè°ƒåº¦å™¨ï¼Œå¯é€šè¿‡yarn.resourcemanager.scheduler.classæŒ‡å®šï¼ŒResourceManageré»˜è®¤ä½¿ç”¨çš„æ˜¯org.apache.hadoop.yarn.server.resourcemanager.scheduler.capacity.CapacitySchedulerã€‚ SchedulerEventDispatcher ç”¨äºå¤„ç†SchedulerEventTypeç±»å‹çš„äº‹ä»¶ï¼Œå…¶å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªå­˜å‚¨SchedulerEventçš„é˜»å¡é˜Ÿåˆ—ï¼Œå¹¶ç”±ä¸€ä¸ªåå°çº¿ç¨‹ä»é˜Ÿåˆ—ä¸­å–å‡ºèµ„æºè¯·æ±‚äº‹ä»¶ï¼Œå†è°ƒç”¨ResourceSchedulerè¿›è¡Œå¤„ç†ã€‚ ReservationSystem èµ„æºé¢„ç•™ç³»ç»Ÿï¼Œå¯¹åº”çš„å®ç°æœ‰CapacityReservationSystemå’ŒFairReservationSystemã€‚ æ­¤å¤–ï¼ŒSystemMetricsPublisherè´Ÿè´£å‘å¸ƒRMçš„ç³»ç»Ÿç»Ÿè®¡ä¿¡æ¯ã€‚AsyncDispatcheræ˜¯ä¸­å¤®äº‹ä»¶å¤„ç†åˆ†å‘å™¨ï¼ŒResourceManagerå¯åŠ¨æ—¶ï¼Œé€šè¿‡å®ƒç»‘å®šäº†å‡ ç§ç±»å‹çš„äº‹ä»¶çš„å¤„ç†å™¨ï¼ŒåŒ…æ‹¬SchedulerEventTypeã€RMAppEventTypeã€ApplicationAttemptã€RMAppAttemptEventTypeã€RMNodeEventTypeã€RMAppManagerEventTypeã€AMLaunchEventTypeç­‰ã€‚ ä¸Šè¿°å„serviceåœ¨ResourceManagerä¸­çš„å¯åŠ¨é¡ºåºä¸ºï¼š AsyncDispatcher AdminService RMActiveServicesï¼šæ˜¯ä¸ªCompositeServiceï¼ˆå³serviceåˆ—è¡¨ï¼ŒResourceManageræœ¬èº«å°±æ˜¯ä¸€ä¸ªCompositeServiceï¼‰ï¼Œç”¨äºç®¡ç†ResourceManagerä¸­çš„â€œæ´»åŠ¨â€æœåŠ¡ï¼ˆå¿…é¡»åœ¨activeçš„ResourceManagerä¸Šå¯åŠ¨çš„æœåŠ¡ï¼Œå¯ç”¨HAæ—¶ï¼Œå¤‡ä»½ResourceManagerä¸Šä¸å¯åŠ¨è¿™äº›æœåŠ¡ï¼‰ï¼ŒåŒ…æ‹¬ä»¥ä¸‹ï¼ˆæŒ‰å¯åŠ¨é¡ºåºï¼‰ï¼š RMSecretManagerService ContainerAllocationExpirer AMLivelinessMonitor RMNodeLabelsManager RMApplicationHistoryWriter SystemMetricsPublisher NodesListManager ResourceScheduler SchedulerEventDispatcher NMLivelinessMonitor ResourceTrackerService ApplicationMasterService ClientRMService ApplicationMasterLauncher DelegationTokenRenewer","raw":null,"content":null,"categories":[{"name":"Hadoop","slug":"Hadoop","permalink":"https://maohong.github.io/categories/Hadoop/"}],"tags":[{"name":"yarn","slug":"yarn","permalink":"https://maohong.github.io/tags/yarn/"},{"name":"hadoop","slug":"hadoop","permalink":"https://maohong.github.io/tags/hadoop/"}]},{"title":"redisæœåŠ¡ç«¯è¿æ¥æ–­å¼€é—®é¢˜è¯Šæ–­","slug":"redisæœåŠ¡ç«¯è¿æ¥æ–­å¼€é—®é¢˜è¯Šæ–­","date":"2015-06-01T13:29:28.000Z","updated":"2015-06-01T13:29:28.000Z","comments":true,"path":"20150601/redisæœåŠ¡ç«¯è¿æ¥æ–­å¼€é—®é¢˜è¯Šæ–­/","permalink":"https://maohong.github.io/20150601/redis%E6%9C%8D%E5%8A%A1%E7%AB%AF%E8%BF%9E%E6%8E%A5%E6%96%AD%E5%BC%80%E9%97%AE%E9%A2%98%E8%AF%8A%E6%96%AD/","excerpt":"","keywords":null,"text":"é—®é¢˜ç°è±¡ å‰æ®µæ—¶é—´ï¼Œç”±äºçº¿ä¸ŠredisæœåŠ¡å™¨çš„å†…å­˜ä½¿ç”¨ç‡è¾¾åˆ°äº†æœºå™¨æ€»å†…å­˜çš„50%ä»¥ä¸Šï¼Œå¯¼è‡´å†…å­˜æ•°æ®çš„dumpæŒä¹…åŒ–ä¸€ç›´å¤±è´¥ã€‚æ‰©å±•åˆ°å¤šå°redisåï¼Œåº”ç”¨ç³»ç»Ÿè®¿é—®redisæ—¶ï¼Œåœ¨ä¸šåŠ¡é‡è¾ƒå°‘æ—¶ï¼Œæ—¶ä¸æ—¶ä¼šå‡ºç°ä»¥ä¸‹å¼‚å¸¸ï¼Œå½“ä¸šåŠ¡é‡è¾ƒå¤§ï¼Œredisè®¿é—®é¢‘ç‡å¾ˆé«˜æ—¶ï¼Œå´ä¸ä¼šå‘ç”Ÿè¿™ä¸ªå¼‚å¸¸ï¼Œä¸€æ—¶è§‰å¾—å¾ˆè¯¡å¼‚ã€‚ redis.clients.jedis.exceptions.JedisConnectionException: It seems like server has closed the connection. at redis.clients.util.RedisInputStream.readLine(RedisInputStream.java:90) ~[jedis-2.1.0.jar:na] at redis.clients.jedis.Protocol.processInteger(Protocol.java:110) ~[jedis-2.1.0.jar:na] at redis.clients.jedis.Protocol.process(Protocol.java:70) ~[jedis-2.1.0.jar:na] at redis.clients.jedis.Protocol.read(Protocol.java:131) ~[jedis-2.1.0.jar:na] at redis.clients.jedis.Connection.getIntegerReply(Connection.java:188) ~[jedis-2.1.0.jar:na] at redis.clients.jedis.Jedis.sismember(Jedis.java:1266) ~[jedis-2.1.0.jar:na] çœ‹æç¤ºï¼Œåº”è¯¥æ˜¯æœåŠ¡ç«¯ä¸»åŠ¨å…³é—­äº†è¿æ¥ã€‚æŸ¥çœ‹äº†æ–°ä¸Šçº¿çš„redisæœåŠ¡å™¨çš„é…ç½®ï¼Œæœ‰è¿™ä¹ˆä¸€é¡¹ï¼š # Close the connection after a client is idle for N seconds (0 to disable) timeout 120 è¿™é¡¹é…ç½®æŒ‡çš„æ˜¯å®¢æˆ·ç«¯è¿æ¥ç©ºé—²è¶…è¿‡å¤šå°‘ç§’åï¼ŒæœåŠ¡ç«¯ä¸»åŠ¨å…³é—­è¿æ¥ï¼Œé»˜è®¤å€¼0è¡¨ç¤ºæœåŠ¡ç«¯æ°¸è¿œä¸ä¸»åŠ¨å…³é—­ã€‚è€Œopäººå‘˜æŠŠæœåŠ¡å™¨ç«¯çš„è¶…æ—¶æ—¶é—´è®¾ç½®ä¸ºäº†120ç§’ã€‚ è¿™å°±è§£é‡Šäº†å‘ç”Ÿè¿™ä¸ªå¼‚å¸¸çš„åŸå› ã€‚å®¢æˆ·ç«¯ä½¿ç”¨äº†ä¸€ä¸ªè¿æ¥æ± ç®¡ç†è®¿é—®redisçš„æ‰€æœ‰è¿æ¥ï¼Œè¿™äº›è¿æ¥æ˜¯é•¿è¿æ¥ï¼Œå½“ä¸šåŠ¡é‡è¾ƒå°æ—¶ï¼Œå®¢æˆ·ç«¯éƒ¨åˆ†è¿æ¥ä½¿ç”¨ç‡è¾ƒä½ï¼Œå½“ä¸¤æ¬¡ä½¿ç”¨ä¹‹é—´çš„é—´éš”è¶…è¿‡120ç§’æ—¶ï¼ŒredisæœåŠ¡ç«¯å°±ä¸»åŠ¨å…³é—­äº†è¿™ä¸ªè¿æ¥ï¼Œè€Œç­‰å®¢æˆ·ç«¯ä¸‹æ¬¡å†ä½¿ç”¨è¿™ä¸ªè¿æ¥å¯¹è±¡æ—¶ï¼Œå‘ç°æœåŠ¡ç«¯å·²ç»å…³é—­äº†è¿æ¥ï¼Œè¿›è€ŒæŠ¥é”™ã€‚ äºæ˜¯ï¼Œå†æŸ¥çœ‹è®¿é—®redisçš„ç³»ç»Ÿï¼ˆå®¢æˆ·ç«¯ï¼‰çš„é…ç½®ï¼š å®¢æˆ·ç«¯ä½¿ç”¨çš„æ˜¯jediså†…ç½®çš„è¿æ¥æ± ï¼Œçœ‹å…¶æºç æœ¬è´¨ä¸Šæ˜¯åŸºäºapache commons-poolå®ç°çš„ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªevictionçº¿ç¨‹ï¼Œç”¨äºå›æ”¶idleå¯¹è±¡ï¼Œå¯¹äºredisè¿æ¥æ± æ¥è¯´ï¼Œä¹Ÿå°±æ˜¯å›æ”¶ç©ºé—²è¿æ¥ã€‚ JedisPoolConfigç±»ç»§æ‰¿è‡ªGenericObjectPoolConfigå¹¶è¦†ç›–äº†å‡ é¡¹å…³äºevictionçº¿ç¨‹çš„é…ç½®ï¼Œå…·ä½“å¦‚ä¸‹ï¼š _timeBetweenEvictionRunsMillisï¼ševictionçº¿ç¨‹çš„è¿è¡Œå‘¨æœŸã€‚é»˜è®¤æ˜¯-1ï¼Œè¡¨ç¤ºä¸å¯åŠ¨evictionçº¿ç¨‹ã€‚è¿™é‡Œè®¾ç½®ä¸º30ç§’ã€‚ _minEvictableIdleTimeMillisï¼šå¯¹è±¡å¤„äºidleçŠ¶æ€çš„æœ€é•¿æ—¶é—´ï¼Œé»˜è®¤æ˜¯30åˆ†é’Ÿï¼Œè¿™é‡Œè®¾ç½®ä¸º60ç§’ã€‚ é€šè¿‡å®¢æˆ·ç«¯çš„é»˜è®¤é…ç½®çœ‹ï¼Œå¯¹è±¡çš„æœ€å¤§ç©ºé—²æ—¶é•¿æ˜¯å°äºæœåŠ¡ç«¯çš„é…ç½®çš„ï¼Œåº”è¯¥ä¸æ˜¯é…ç½®ä¸Šçš„é—®é¢˜äº†ã€‚ äºæ˜¯ï¼Œç»§ç»­çœ‹æ˜¯ä¸æ˜¯å®¢æˆ·ç«¯ä»£ç ä½¿ç”¨ä¸Šçš„é—®é¢˜ã€‚è¿½è¸ªåˆ°å®¢æˆ·ç«¯ä»£ç å¦‚ä¸‹ï¼š å¯è§ï¼Œå®¢æˆ·ç«¯é¦–å…ˆå°è¯•ä»æœ¬çº¿ç¨‹çš„ThreadLocalå¯¹è±¡ä¸­è·å–jediså¯¹è±¡ï¼Œè‹¥è·å–ä¸åˆ°ï¼Œå†ä»masterJedisPoolä¸­å–å¾—jediså¯¹è±¡å¹¶æ”¾å…¥ThreadLocalå¯¹è±¡ä»¥ä¾¿ä¸‹æ¬¡ä½¿ç”¨ï¼Œå¹¶ä¸”jediså¯¹è±¡ä½¿ç”¨å®Œæ¯•åï¼Œæ²¡æœ‰ä»ThreadLocalä¸­æ¸…é™¤ï¼Œä¹Ÿæ²¡æœ‰returnResourceç»™masterJedisPoolã€‚ å› æ­¤ï¼Œé—®é¢˜äº§ç”Ÿçš„åŸå› å°±åœ¨äºæ­¤ã€‚ThreadLocalä¸­çš„è¿™ä¸ªjediså¯¹è±¡è¢«å–å‡ºåæ²¡æœ‰returnï¼Œå¯¹äºå¯¹è±¡æ± æ¥è¯´æ˜¯å¤„äºéidleçŠ¶æ€ï¼Œå› æ­¤ä¸ä¼šè¢«å¯¹è±¡æ± evictã€‚å½“ä¸šåŠ¡é‡å¤§æ—¶ï¼Œè¿™ä¸ªjedisä¼šè¢«é¢‘ç¹ä½¿ç”¨ï¼ŒæœåŠ¡ç«¯è®¤ä¸ºè¿™ä¸ªjediså¯¹åº”çš„è¿æ¥æ˜¯éç©ºé—²çš„ï¼Œæˆ–è€…ç©ºé—²æ—¶é—´è¾¾ä¸åˆ°120ç§’ï¼Œä¸ä¼šä¸»åŠ¨å…³é—­ï¼Œæ‰€ä»¥æ²¡ä»€ä¹ˆé—®é¢˜ã€‚ç„¶è€Œå½“ä¸šåŠ¡é‡å°æ—¶ï¼Œè¿™ä¸ªjedisä½¿ç”¨é¢‘ç‡å¾ˆä½ï¼Œå½“ä¸¤æ¬¡ä¹‹é—´çš„ä½¿ç”¨é—´éš”è¶…å‡º120ç§’æ—¶ï¼ŒæœåŠ¡ç«¯ä¼šä¸»åŠ¨æŠŠè¿™ä¸ªjedisçš„è¿æ¥å…³é—­ï¼Œç¬¬äºŒæ¬¡è°ƒç”¨æ—¶ï¼Œå°±ä¼šå‡ºç°ä¸Šé¢çš„æŠ¥é”™ã€‚ ä»ä»£ç å¼€å‘è€…çš„è§’åº¦æ¥è¯´ï¼Œè¿™ä¹ˆåšçš„ç›®çš„æ˜¯é¿å…é¢‘ç¹ä»poolä¸­è·å–jediså¯¹è±¡å’Œreturn jediså¯¹è±¡ä»¥æé«˜æ€§èƒ½ã€‚ è§£å†³æ–¹æ¡ˆæœ‰ä¸¤ä¸ªï¼š åœ¨redis-cliä¸‹åœ¨çº¿ä¿®æ”¹redis çš„é…ç½®ï¼ŒæŠŠtimeoutæ”¹å›ä¸º0ï¼Œæ— éœ€é‡å¯rediså³å¯ç›´æ¥ç”Ÿæ•ˆï¼Œä½†redisè‹¥é‡å¯ï¼Œé…ç½®ä¼šæ¢å¤ã€‚ ä¿®æ”¹å®¢æˆ·ç«¯ä»£ç ï¼Œä½¿ç”¨å®Œjediså¯¹è±¡åï¼Œä»ThreadLocalä¸­æ¸…é™¤ï¼Œå†è¿”å›ç»™è¿æ¥æ± ã€‚ å‡ºäºæ”¹åŠ¨æˆæœ¬è€ƒè™‘ï¼Œå…ˆé‡‡ç”¨äº†ç¬¬ä¸€ç§æ–¹æ¡ˆï¼Œåœ¨çº¿ä¿®æ”¹redisé…ç½®åï¼ŒæŠ¥é”™ä¸å†å‡ºç°ã€‚","raw":null,"content":null,"categories":[{"name":"Redis","slug":"Redis","permalink":"https://maohong.github.io/categories/Redis/"}],"tags":[{"name":"redis","slug":"redis","permalink":"https://maohong.github.io/tags/redis/"},{"name":"è¿æ¥æ–­å¼€","slug":"è¿æ¥æ–­å¼€","permalink":"https://maohong.github.io/tags/%E8%BF%9E%E6%8E%A5%E6%96%AD%E5%BC%80/"}]},{"title":"ä½¿ç”¨httpclientå¼•èµ·çš„tcpè¿æ¥æ•°è¶…é«˜é—®é¢˜","slug":"ä½¿ç”¨httpclientå¼•èµ·çš„tcpè¿æ¥æ•°è¶…é«˜é—®é¢˜","date":"2015-03-28T09:44:58.000Z","updated":"2015-03-28T09:44:58.000Z","comments":true,"path":"20150328/ä½¿ç”¨httpclientå¼•èµ·çš„tcpè¿æ¥æ•°è¶…é«˜é—®é¢˜/","permalink":"https://maohong.github.io/20150328/%E4%BD%BF%E7%94%A8httpclient%E5%BC%95%E8%B5%B7%E7%9A%84tcp%E8%BF%9E%E6%8E%A5%E6%95%B0%E8%B6%85%E9%AB%98%E9%97%AE%E9%A2%98/","excerpt":"","keywords":null,"text":"ç»„å†…çš„ä¸€ä¸ªç³»ç»Ÿæ–°ä¸Šçº¿äº†é€šè¿‡å›¾ç‰‡urlä¸Šä¼ å›¾ç‰‡åˆ°å›¾ç‰‡å­˜å‚¨å¹³å°çš„åŠŸèƒ½ã€‚å…¶ä¸­ä½¿ç”¨äº†httpclientï¼Œé€šè¿‡å‘å›¾ç‰‡å­˜å‚¨å¹³å°å‘é€MultipartPostMethodä¸Šä¼ å›¾ç‰‡ã€‚å½“ä¸šåŠ¡é‡è¾ƒå¤§æ—¶ï¼Œ10ä¸ªå¤„ç†çº¿ç¨‹æ»¡è´Ÿè·è¿è¡Œï¼Œä¸Šä¼ å›¾ç‰‡æ—¶ï¼Œå‘ç°åº”ç”¨ç³»ç»ŸæœåŠ¡å™¨çš„tcpè¿æ¥æ•°é™¡ç„¶å‡é«˜ï¼Œå³°å€¼èƒ½è¾¾åˆ°å‡ ä¸‡ä¸ªtcpè¿æ¥æ•°ï¼ æ’æŸ¥ç³»ç»Ÿä»£ç å¹¶ç»“åˆåˆ†æhttpclientçš„æºç å‘ç°ï¼Œåº”ç”¨ç³»ç»Ÿæ¯æ¬¡ä¸Šä¼ å›¾ç‰‡æ—¶ï¼Œéƒ½ä¼šåšnew HttpClient()æ“ä½œï¼Œè¿™ä¸ªæ“ä½œå†…éƒ¨é»˜è®¤ä½¿ç”¨çš„æ˜¯SimpleHttpConnectionManageræ¥ç®¡ç†httpè¿æ¥ï¼Œè€ŒSimpleHttpConnectionManageræœ‰ä¸ªé»˜è®¤å­—æ®µalwaysClose=falseï¼Œè¡¨ç¤ºå½“å¤–éƒ¨ç¨‹åºè°ƒç”¨äº†HttpMethod.releaseConnection()æ—¶å¹¶ä¸ä¼šç«‹å³é‡Šæ”¾è¿æ¥ï¼Œè€Œæ˜¯ä¿æŒè¿™ä¸ªè¿æ¥å¹¶å°è¯•ç”¨äºåç»­çš„è¯·æ±‚ï¼Œåœ¨è¿æ¥ç©ºé—²ä¸€æ®µæ—¶é—´åï¼ˆé»˜è®¤3ç§’ï¼‰æ‰çœŸæ­£é‡Šæ”¾ã€‚ å› æ­¤ï¼Œå½“ä¸šåŠ¡é‡è¾ƒå¤§ï¼Œç³»ç»Ÿé«˜å¹¶å‘å‘é€postè¯·æ±‚æ—¶ï¼Œnewå‡ºæ¥çš„HttpClientå¯¹è±¡ä¼šå¾ˆå¤šï¼Œè€Œè¿™ä¸ªå¯¹è±¡ä½¿ç”¨å®Œæ¯•åï¼Œè€Œå½“ä¸­å»ºç«‹çš„clientå¯¹è±¡åœ¨çŸ­æ—¶é—´å†…å¹¶ä¸ä¼šç«‹å³é‡Šæ”¾è¿æ¥ï¼Œå› æ­¤ï¼Œéšç€æ—¶é—´çš„ç§¯ç´¯ï¼Œtcpè¿æ¥æ•°ä¿æŒå±…é«˜ä¸ä¸‹ã€‚ é€šè¿‡æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ï¼Œå»ºè®®åœ¨é«˜å¹¶å‘ç¯å¢ƒä¸‹ä½¿ç”¨MultiThreadedHttpConnectionManageræ¥ç®¡ç†httpclientï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å°†httpclientæ”¹ä¸ºå•ä¾‹åï¼Œtcpè¿æ¥æ•°å›å¤æ­£å¸¸æ°´å¹³ã€‚ é€šè¿‡ç®¡ç†httpclientçš„ä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516private static HttpClient initHttpClient(){ HttpConnectionManagerParams params = new HttpConnectionManagerParams(); //æŒ‡å®šå‘æ¯ä¸ªhostå‘èµ·çš„æœ€å¤§è¿æ¥æ•°ï¼Œé»˜è®¤æ˜¯2ï¼Œå¤ªå°‘äº† params.setDefaultMaxConnectionsPerHost(1000); //æŒ‡å®šæ€»å…±å‘èµ·çš„æœ€å¤§è¿æ¥æ•°ï¼Œé»˜è®¤æ˜¯20ï¼Œå¤ªå°‘äº† params.setMaxTotalConnections(5000); //è¿æ¥è¶…æ—¶æ—¶é—´-10s params.setConnectionTimeout(60*1000); //è¯»å–æ•°æ®è¶…æ—¶æ—¶é—´-60s params.setSoTimeout(60*1000); MultiThreadedHttpConnectionManager manager = new MultiThreadedHttpConnectionManager(); manager.setParams(params); return new HttpClient(manager);}","raw":null,"content":null,"categories":[{"name":"é—®é¢˜åˆ†æ","slug":"é—®é¢˜åˆ†æ","permalink":"https://maohong.github.io/categories/%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90/"}],"tags":[{"name":"httpclient","slug":"httpclient","permalink":"https://maohong.github.io/tags/httpclient/"},{"name":"tcpè¿æ¥æ•°","slug":"tcpè¿æ¥æ•°","permalink":"https://maohong.github.io/tags/tcp%E8%BF%9E%E6%8E%A5%E6%95%B0/"}]},{"title":"åŸºäºzookeeperçš„åˆ†å¸ƒå¼ç‹¬å é”å®ç°","slug":"åŸºäºzookeeperçš„åˆ†å¸ƒå¼ç‹¬å é”å®ç°","date":"2014-05-13T13:05:01.000Z","updated":"2014-05-13T13:05:01.000Z","comments":true,"path":"20140513/åŸºäºzookeeperçš„åˆ†å¸ƒå¼ç‹¬å é”å®ç°/","permalink":"https://maohong.github.io/20140513/%E5%9F%BA%E4%BA%8Ezookeeper%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F%E7%8B%AC%E5%8D%A0%E9%94%81%E5%AE%9E%E7%8E%B0/","excerpt":"","keywords":null,"text":"èƒŒæ™¯ åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œç»å¸¸é‡åˆ°è¿™æ ·ä¸€ç§åœºæ™¯ï¼šé€‰ä¸¾ä¸€ä¸ªèŠ‚ç‚¹æ‰§è¡ŒæŸä¸€ä¸ªä»»åŠ¡ï¼Œå½“æ­¤èŠ‚ç‚¹å®•æœºåï¼Œå…¶ä»–èŠ‚ç‚¹å¯ä»¥æ¥ç®¡å¹¶ç»§ç»­æ‰§è¡Œè¿™ä¸ªä»»åŠ¡ã€‚ç”±äºå„ä¸ªèŠ‚ç‚¹è¿è¡Œçš„ä»£ç æ˜¯ä¸€æ ·çš„ï¼Œå½¼æ­¤ä¹‹é—´ä¹Ÿæ˜¯å¹³ç­‰çš„ï¼Œå„ä¸ªèŠ‚ç‚¹å¦‚ä½•å¯ä»¥çŸ¥é“è‡ªå·±æ˜¯å¦å¯ä»¥æ‰§è¡Œè¿™ä¸ªä»»åŠ¡å‘¢ï¼Ÿå½“æœ‰èŠ‚ç‚¹å®•æœºæ—¶ï¼Œåˆå¦‚ä½•åˆ¤æ–­è‡ªå·±æ˜¯å¦å¯ä»¥æ¥ç®¡ä»»åŠ¡å‘¢ï¼Ÿåœ¨æˆ‘ä»¬çš„åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿä¸­ï¼Œéœ€è¦é€‰å–è°ƒåº¦å™¨é›†ç¾¤ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹è¿›è¡Œè½®è¯¢ä»»åŠ¡çŠ¶æ€ï¼Œè¿™é‡Œä½¿ç”¨äº†zookeeperæ¥å®ç°ä¸€ä¸ªç»Ÿä¸€çš„åˆ†å¸ƒå¼é”ï¼Œä»è€Œé€‰å‡ºè½®è¯¢èŠ‚ç‚¹ã€‚ åŸç† å¦‚å›¾æ‰€ç¤ºï¼Œæ¯å°æœåŠ¡å™¨å¯åŠ¨åï¼Œéƒ½åœ¨åŒä¸€ç›®å½•ä¸‹å»ºä¸€ä¸ªä¸´æ—¶é¡ºåºèŠ‚ç‚¹ï¼ˆEPHEMERAL_SEQUENTIALï¼‰ï¼Œå¹¶è·å–æ­¤ç›®å½•ä¸‹çš„æ‰€æœ‰èŠ‚ç‚¹ä¿¡æ¯ï¼Œå¦‚æœè‡ªå·±çš„åºå·æ˜¯æœ€å°çš„ï¼Œå°±è®¤ä¸ºè·å–åˆ°äº†é”ï¼Œå¯ä»¥æ‰§è¡Œä»»åŠ¡ã€‚è‹¥è‡ªå·±çš„èŠ‚ç‚¹ä¸æ˜¯æœ€å°çš„ï¼Œå°±è®¤ä¸ºè‡ªå·±æ²¡æœ‰è·å–åˆ°é”ï¼Œä¸æ‰§è¡Œä»»åŠ¡ï¼ŒåŒæ—¶ï¼Œåœ¨æ¯”è‡ªå·±å°1ä¸ªåºå·çš„èŠ‚ç‚¹ä¸Šå¢åŠ ç›‘å¬ã€‚å½“æ¯”è‡ªå·±å°1ä¸ªåºå·çš„èŠ‚ç‚¹å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œå†æ¬¡æ£€æŸ¥è‡ªå·±æ˜¯å¦æ˜¯æœ€å°åºå·çš„èŠ‚ç‚¹ï¼Œå¦‚æœæ˜¯åˆ™è·å–é”ï¼Œå¦åˆ™ç»§ç»­ç›‘å¬æ¯”è‡ªå·±å°1ä¸ªåºå·çš„èŠ‚ç‚¹ã€‚ å®ç° ä»¥ä¸‹æ˜¯ä¸€ä¸ªdemoå®ç°ç¨‹åºï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268public class DistributedExclusiveLock implements Watcher{ private ZooKeeper zk; private String lockDir = \"/testlock\";//é”èŠ‚ç‚¹æ‰€åœ¨zkçš„ç›®å½• private String lockSymbol = \"_lock_\";//é”èŠ‚ç‚¹æ ‡å¿— private String lockName;//é”èŠ‚ç‚¹å‰ç¼€ï¼Œæ„é€ é”æ—¶ç”±å¤–éƒ¨ä¼ å…¥ private String waitNodePath;//ç­‰å¾…çš„å‰ä¸€ä¸ªé”çš„èŠ‚ç‚¹åç§° private String myNodePath;//å½“å‰é” private CountDownLatch latch;//è®¡æ•°å™¨ private String threadId; /** * åˆ›å»ºåˆ†å¸ƒå¼é” * @param lockName ç«äº‰èµ„æºæ ‡å¿—,lockNameä¸­ä¸èƒ½åŒ…å«å•è¯lock * @throws Exception */ public DistributedExclusiveLock(String zkServers, String lockName) throws Exception { //ç®€å•æ ¡éªŒlockDirè·¯å¾„ if (!lockDir.startsWith(\"/\")) throw new Exception(\"LockDir Path must start with / character! lockDir=\" + lockDir); if (lockDir.endsWith(\"/\")) throw new Exception(\"LockDir Path must not end with / character! lockDir=\" + lockDir); this.lockName = lockName; this.threadId = getThreadId(); // åˆ›å»ºä¸€ä¸ªä¸æœåŠ¡å™¨çš„è¿æ¥ try { zk = new ZooKeeper(zkServers, 3000, this); createLockDirIfNecessary(lockDir); } catch (Exception e) { throw new Exception(\"Error while initializing DistributedExclusiveLock!\" + e.getMessage(), e); } } private String getThreadId() { return \"Thread-\" + Thread.currentThread().getId(); } /** * åœ¨zkä¸Šå»ºç«‹lockç›®å½•ï¼Œå¦‚æœç›®å½•ä¸å­˜åœ¨ï¼Œé€çº§åˆ›å»ºèŠ‚ç‚¹ */ private synchronized void createLockDirIfNecessary(String zkDir) throws KeeperException, InterruptedException { //zkDiræ˜¯ä¸€çº§èŠ‚ç‚¹ï¼Œå¦‚/cloudscheduler if (zkDir.indexOf(\"/\") == zkDir.lastIndexOf(\"/\")) { Stat stat = zk.exists(zkDir, false); if(stat == null){ // åˆ›å»ºä¸€çº§èŠ‚ç‚¹ zk.create(zkDir, new byte[0], Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT); } } else //zkDiréä¸€çº§èŠ‚ç‚¹ { String parentDir = zkDir.substring(0, zkDir.lastIndexOf(\"/\")); if (zk.exists(parentDir, false) != null) { //å¦‚æœçˆ¶èŠ‚ç‚¹å­˜åœ¨ï¼Œå»ºå½“å‰èŠ‚ç‚¹ Stat stat = zk.exists(zkDir, false); if(stat == null){ // åˆ›å»ºéä¸€çº§èŠ‚ç‚¹ zk.create(zkDir, new byte[0], Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT); } } else { //å¦åˆ™ï¼Œå…ˆå»ºçˆ¶èŠ‚ç‚¹ï¼Œå†å»ºå½“å‰èŠ‚ç‚¹ createLockDirIfNecessary(parentDir); createLockDirIfNecessary(zkDir); } } } /** * zookeeperèŠ‚ç‚¹çš„ç›‘è§†å™¨ */ @Override public void process(WatchedEvent event) { if (event.getType() == EventType.NodeDeleted) { if (this.latch!=null) this.latch.countDown(); try { List&lt;String&gt; childrenNodes = zk.getChildren(lockDir, false); // æ’åº Collections.sort(childrenNodes); System.out.println(\"Node: \" + event.getPath() + \" change event is deleted! Current locked nodes:\\n\\t\" + StringUtils.join(childrenNodes,\"\\n\\t\")); } catch (KeeperException e) { e.printStackTrace(); } catch (InterruptedException e) { e.printStackTrace(); } } } public boolean tryLock() { try { if(tryLockInner()) return true; else return waitForLockInner(waitNodePath); } catch (Exception e) { e.printStackTrace(); return false; } } private boolean tryLockInner() throws Exception { try { if(lockName.contains(lockSymbol)) throw new Exception(\"lockName can not contains \" + lockSymbol); //åˆ›å»ºä¸´æ—¶å­èŠ‚ç‚¹ myNodePath = zk.create(lockDir + \"/\" + lockName + lockSymbol, new byte[0], Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL_SEQUENTIAL); System.out.println(threadId + \" created \" + myNodePath); //å–å‡ºæ‰€æœ‰å­èŠ‚ç‚¹ List&lt;String&gt; subNodes = zk.getChildren(lockDir, false); //å–å‡ºæ‰€æœ‰lockNameçš„é” List&lt;String&gt; lockedNodes = new ArrayList&lt;String&gt;(); for (String node : subNodes) { String nodePrefix = node.split(lockSymbol)[0]; if(nodePrefix.equals(lockName)){//å¯¹é”ååšä¸ªåˆ¤æ–­ï¼Œå‰ç¼€ç›¸åŒå³ä¸ºåŒä¸€ç»„é” lockedNodes.add(node); } } Collections.sort(lockedNodes); System.out.println(\"Current locked nodes: \\n\\t\" + StringUtils.join(lockedNodes, \"\\n\\t\")); if(myNodePath.equals(lockDir + \"/\" + lockedNodes.get(0))){ //å¦‚æœæ˜¯æœ€å°çš„èŠ‚ç‚¹,åˆ™è¡¨ç¤ºå–å¾—é” return true; } //å¦‚æœä¸æ˜¯æœ€å°çš„èŠ‚ç‚¹ï¼Œæ‰¾åˆ°æ¯”è‡ªå·±å°1çš„èŠ‚ç‚¹ï¼Œåœ¨Listä¸­çš„ä½ç½®æ˜¯è‡ªå·±çš„å‰ä¸€ä½ String myZnodeName = myNodePath.substring(myNodePath.lastIndexOf(\"/\") + 1); waitNodePath = lockDir + \"/\" + lockedNodes.get(lockedNodes.indexOf(myZnodeName)-1); } catch (KeeperException e) { e.printStackTrace(); } catch (InterruptedException e) { e.printStackTrace(); } return false; } private boolean waitForLockInner(String waitPath) throws InterruptedException, KeeperException { Stat stat = zk.exists(waitPath, true); //åˆ¤æ–­æ¯”è‡ªå·±å°ä¸€ä¸ªæ•°çš„èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨,å¦‚æœå­˜åœ¨åˆ™éœ€ç­‰å¾…é”,åŒæ—¶æ³¨å†Œç›‘å¬ if (stat != null) { System.out.println(threadId + \" waiting for \" + waitPath); this.latch = new CountDownLatch(1); this.latch.await(); //ä¸åŠ è¶…æ—¶æ—¶é—´ï¼Œæ— é™ç­‰å¾… // //waiting //Zzzzz... //still waiting // // æ¢æµ‹åˆ°èŠ‚ç‚¹å˜åŒ–ï¼Œåˆ·æ–°èŠ‚ç‚¹ä¿¡æ¯ this.latch = null; try { // ç¡®è®¤myNodePathæ˜¯å¦çœŸçš„æ˜¯åˆ—è¡¨ä¸­çš„æœ€å°èŠ‚ç‚¹ List&lt;String&gt; childrenNodes = zk.getChildren(lockDir, false); // æ’åº Collections.sort(childrenNodes); if(myNodePath.equals(lockDir + \"/\" + childrenNodes.get(0))) return true; else { // è¯´æ˜waitNodePathæ˜¯ç”±äºå‡ºç°å¼‚å¸¸è€ŒæŒ‚æ‰çš„ , æ›´æ–°waitNodePath String thisNodeName = myNodePath.substring(myNodePath.lastIndexOf(\"/\") + 1); int index = childrenNodes.indexOf(thisNodeName); waitNodePath = lockDir + \"/\" + childrenNodes.get(index - 1); //é‡æ–°ç­‰å¾…é” return waitForLockInner(waitNodePath); } } catch (KeeperException e) { e.printStackTrace(); return false; } catch (InterruptedException e) { e.printStackTrace(); return false; } } return true; } public void unlock() throws Exception { try { System.out.println(threadId + \" unlock \" + myNodePath); zk.delete(myNodePath,-1); myNodePath = null; zk.close(); } catch (InterruptedException e) { throw new Exception(\"Error while releasing lock! \" + e.getMessage(), e); } catch (KeeperException e) { throw new Exception(\"Error while releasing lock! \" + e.getMessage(), e); } } public static void main(String[] args) throws Exception { //ä¸€ä¸ªç®€å•çš„æµ‹è¯• List&lt;Thread&gt; workers = new ArrayList&lt;Thread&gt;(10); for (int i=1; i&lt;10; ++i) { Thread thread = new Thread(new Runnable() { String zk = \"10.12.10.169:2181,10.12.139.141:2181\"; @Override public void run() { try { DistributedExclusiveLock lock = new DistributedExclusiveLock(zk, \"zkLock\"); if (lock.tryLock()); { String tid = \"Thread-\" + Thread.currentThread().getId(); int time = new Random().nextInt(5000); System.out.println(tid + \" gets lock and is working, sleep for \" + time + \" ms\"); Thread.sleep(time); lock.unlock(); System.out.println(tid + \" releases lock\"); } } catch (Exception e) { e.printStackTrace(); } } }); thread.setDaemon(true); workers.add(thread); } for (Thread t : workers) { t.start(); } Thread.sleep(100000); }}","raw":null,"content":null,"categories":[{"name":"åˆ†å¸ƒå¼åº”ç”¨","slug":"åˆ†å¸ƒå¼åº”ç”¨","permalink":"https://maohong.github.io/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E5%BA%94%E7%94%A8/"}],"tags":[{"name":"zookeeper","slug":"zookeeper","permalink":"https://maohong.github.io/tags/zookeeper/"},{"name":"åˆ†å¸ƒå¼åº”ç”¨","slug":"åˆ†å¸ƒå¼åº”ç”¨","permalink":"https://maohong.github.io/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E5%BA%94%E7%94%A8/"},{"name":"åˆ†å¸ƒå¼åè°ƒ","slug":"åˆ†å¸ƒå¼åè°ƒ","permalink":"https://maohong.github.io/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E5%8D%8F%E8%B0%83/"}]},{"title":"å°†Hadoop RPCæ¡†æ¶åº”ç”¨äºå¤šèŠ‚ç‚¹ä»»åŠ¡è°ƒåº¦","slug":"å°†Hadoop-RPCæ¡†æ¶åº”ç”¨äºå¤šèŠ‚ç‚¹ä»»åŠ¡è°ƒåº¦","date":"2014-01-21T12:53:38.000Z","updated":"2014-01-21T12:53:38.000Z","comments":true,"path":"20140121/å°†Hadoop-RPCæ¡†æ¶åº”ç”¨äºå¤šèŠ‚ç‚¹ä»»åŠ¡è°ƒåº¦/","permalink":"https://maohong.github.io/20140121/%E5%B0%86Hadoop-RPC%E6%A1%86%E6%9E%B6%E5%BA%94%E7%94%A8%E4%BA%8E%E5%A4%9A%E8%8A%82%E7%82%B9%E4%BB%BB%E5%8A%A1%E8%B0%83%E5%BA%A6/","excerpt":"èƒŒæ™¯ åœ¨hadoopä¸­ï¼Œä¸»ä»èŠ‚ç‚¹ä¹‹é—´ä¿æŒç€å¿ƒè·³é€šä¿¡ï¼Œç”¨äºä¼ è¾“èŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯ã€ä»»åŠ¡è°ƒåº¦ä¿¡æ¯ä»¥åŠèŠ‚ç‚¹åŠ¨ä½œä¿¡æ¯ç­‰ç­‰ã€‚ hdfsçš„namenodeä¸datanodeï¼Œmapreduceçš„jobtrackerä¸tasktrackerï¼Œhbaseçš„hmasterä¸ regionserverä¹‹é—´çš„é€šä¿¡ï¼Œéƒ½æ˜¯åŸºäºhadoop RPCã€‚Hadoop RPCæ˜¯hadoopé‡Œéå¸¸åŸºç¡€çš„é€šä¿¡æ¡†æ¶ã€‚hadoop 2.0ä»¥å‰hadoop RPCçš„æ•°æ®åºåˆ—åŒ–æ˜¯é€šè¿‡å®ç°è‡ªå·±å®šä¹‰çš„Writableæ¥å£å®ç°ï¼Œè€Œä»hadoop 2.0å¼€å§‹ï¼Œæ•°æ®çš„åºåˆ—åŒ–å·¥ä½œäº¤ç»™äº†ProtocolBufferå»åšã€‚å…³äºHadoop RPCçš„å®ç°åŸç†å·²ç»æœ‰å¾ˆå¤šæ–‡ç« è¿›è¡Œäº†è¯¦ç»†çš„ä»‹ç»ï¼ˆæºç çº§å¼ºåŠ›åˆ†æhadoopçš„RPCæœºåˆ¶ï¼ŒHadoopåŸºäºProtocol Bufferçš„RPCå®ç°ä»£ç åˆ†æ-Serverç«¯ï¼Œå¸¦æœ‰HAåŠŸèƒ½çš„Hadoop Clientç«¯RPCå®ç°åŸç†ä¸ä»£ç åˆ†æï¼‰ï¼Œè¿™é‡Œå°±ä¸åœ¨èµ˜è¿°äº†ã€‚ä¸‹é¢å°±ç›´æ¥å¼•å…¥é—®é¢˜å’Œæ–¹æ¡ˆå§ã€‚ é—®é¢˜ å·¥ä½œä¸­ç»å¸¸éœ€è¦åœ¨å®šæ—¶ä»»åŠ¡ç³»ç»Ÿä¸Šå†™ä¸€äº›å®šæ—¶ä»»åŠ¡ï¼Œéšç€ä¸šåŠ¡è§„æ¨¡çš„å¢é•¿å’Œæ‰©å¤§ï¼Œéœ€è¦å®šæ—¶å¤„ç†çš„ä»»åŠ¡è¶Šæ¥è¶Šå¤šï¼Œä»»åŠ¡ä¹‹é—´çš„æ‰§è¡Œé—´éš”è¶Šæ¥è¶Šå°ï¼ŒæŸä¸€æ—¶é—´æ®µå†…ï¼ˆæ¯”å¦‚0ç‚¹ã€æ•´ç‚¹æˆ–åŠç‚¹ï¼‰æ‰§è¡Œçš„ä»»åŠ¡ä¼šè¶Šæ¥è¶Šå¯†é›†ï¼Œåªåœ¨ä¸€å°æœºå™¨ä¸Šæ‰§è¡Œè¿™äº›ä»»åŠ¡çš„è¯ï¼Œä¼šå‡ºç°è¾ƒå¤§çš„é£é™©ï¼š ä»»åŠ¡å¹¶å‘åº¦è¾ƒé«˜æ—¶ï¼Œå•æœºçš„ç³»ç»Ÿèµ„æºå°†æˆä¸ºç“¶é¢ˆ å¦‚æœä¸€ä¸ªä»»åŠ¡çš„è¿è¡Œå ç”¨äº†æ•´ä¸ªæœºå™¨çš„å¤§éƒ¨åˆ†èµ„æºï¼Œæ¯”å¦‚sqlæŸ¥è¯¢è€—è´¹å·¨å¤§å†…å­˜å’ŒCPUèµ„æºï¼Œå°†ç›´æ¥å½±å“å…¶ä»–ä»»åŠ¡çš„è¿è¡Œ ä»»åŠ¡å¤±è´¥åï¼Œå¦‚æœä»ç„¶åœ¨åŒä¸€å°èŠ‚ç‚¹è‡ªåŠ¨é‡æ–°æ‰§è¡Œï¼Œå¤±è´¥ç‡è¾ƒé«˜ æœºå™¨å®•æœºåï¼Œå¿…é¡»ç¬¬ä¸€æ—¶é—´é‡å¯æœºå™¨æˆ–é‡æ–°éƒ¨ç½²å®šæ—¶ä»»åŠ¡ç³»ç»Ÿï¼Œæ‰€æœ‰ä»»åŠ¡éƒ½ä¸èƒ½æŒ‰æ—¶æ‰§è¡Œ ç­‰ç­‰ æ–¹æ¡ˆ å¯æƒ³è€ŒçŸ¥çš„æ˜¯ï¼Œå¯ä»¥é€šè¿‡å°†å®šæ—¶ä»»åŠ¡ç³»ç»Ÿè¿›è¡Œåˆ†å¸ƒå¼æ”¹é€ ï¼Œä½¿ç”¨å¤šä¸ªèŠ‚ç‚¹æ‰§è¡Œä»»åŠ¡ï¼Œå°†ä»»åŠ¡åˆ†å‘åˆ°ä¸åŒèŠ‚ç‚¹ä¸Šè¿›è¡Œå¤„ç†ï¼Œå¹¶ä¸”å®Œå–„å¤±è´¥é‡è¯•æœºåˆ¶ï¼Œä»è€Œæé«˜ç³»ç»Ÿç¨³å®šæ€§ï¼Œå®ç°ä»»åŠ¡ç³»ç»Ÿçš„é«˜å¯é ã€‚ æ—¢ç„¶æ˜¯åœ¨å¤šä¸ªèŠ‚ç‚¹ä¹‹é—´åˆ†å‘ä»»åŠ¡ï¼Œè‚¯å®šå¾—æœ‰ä¸ªä»»åŠ¡çš„ç®¡ç†è€…(ä¸»èŠ‚ç‚¹)ï¼Œåœ¨æˆ‘ä»¬ç°æœ‰çš„ç³»ç»Ÿä¸­ï¼Œä¹Ÿå°±æ˜¯ä¸€å¥—å¯ä»¥éƒ¨ç½²å®šæ—¶ä»»åŠ¡çš„webç³»ç»Ÿï¼Œä»»åŠ¡ä»£ç æ›´æ–°åï¼Œéƒ¨ç½²å¥½è¿™å¥—webç³»ç»Ÿï¼Œå³å¯é€šè¿‡webé¡µé¢è®¾ç½®å®šæ—¶ä»»åŠ¡å¹¶ä¸”è¿›è¡Œè°ƒåº¦(åœ¨å•ä¸ªèŠ‚ç‚¹ä¸Šæ‰§è¡Œ)ã€‚æ‰§è¡Œä»»åŠ¡çš„èŠ‚ç‚¹(å­èŠ‚ç‚¹)æœ‰å¤šä¸ªä»¥åï¼Œå¦‚ä½•åˆ†å‘ä»»åŠ¡åˆ°å­èŠ‚ç‚¹å‘¢ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä»»åŠ¡çš„ä¿¡æ¯å°è£…æˆä¸€ä¸ªbeanï¼Œé€šè¿‡RPCå‘å¸ƒç»™å­èŠ‚ç‚¹ï¼Œå­èŠ‚ç‚¹é€šè¿‡è¿™ä¸ªä»»åŠ¡beanè·å¾—ä»»åŠ¡ä¿¡æ¯ï¼Œå¹¶åœ¨æŒ‡å®šçš„æ—¶åˆ»æ‰§è¡Œä»»åŠ¡ã€‚åŒæ—¶ï¼Œå­èŠ‚ç‚¹å¯ä»¥é€šè¿‡ä¸ä¸»èŠ‚ç‚¹çš„å¿ƒè·³é€šä¿¡å°†èŠ‚ç‚¹çŠ¶æ€å’Œæ‰§è¡Œä»»åŠ¡çš„æƒ…å†µå‘Šè¯‰ä¸»èŠ‚ç‚¹ã€‚ è¿™æ ·å…¶å®å°±ä¸hadoop mapreduceåˆ†å‘ä»»åŠ¡æœ‰ç‚¹ç›¸ä¼¼äº†ï¼Œå‘µå‘µï¼Œè¿™é‡Œä¸»èŠ‚ç‚¹ä¸å­èŠ‚ç‚¹ä¹‹é—´çš„é€šä¿¡ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡Hadoop RPCæ¡†æ¶æ¥å®ç°äº†ï¼Œä¸åŒçš„æ˜¯ï¼Œæˆ‘ä»¬åˆ†å‘çš„ä»»åŠ¡æ˜¯å®šæ—¶ä»»åŠ¡ï¼Œå‘å¸ƒä»»åŠ¡æ—¶éœ€è¦å°†ä»»åŠ¡çš„å®šæ—¶ä¿¡æ¯ä¸€å¹¶å‘ç»™å­èŠ‚ç‚¹ã€‚ å®ç° å•ç‚¹çš„å®šæ—¶ä»»åŠ¡ç³»ç»Ÿæ˜¯åŸºäºQuartzçš„ï¼Œåœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ï¼Œå¯ä»¥ç»§ç»­åŸºäºQuartzè¿›è¡Œæ”¹é€ ï¼Œä»»åŠ¡çš„å®šæ—¶ä¿¡æ¯å¯ä»¥é€šè¿‡Quartzä¸­çš„JobDetailå’ŒTriggerå¯¹è±¡æ¥æè¿°å¹¶å°è£…ï¼ŒåŠ ä¸Šä»»åŠ¡æ‰§è¡Œçš„å…¥å£ç±»ä¿¡æ¯ï¼Œå†é€šè¿‡RPCç”±ä¸»èŠ‚ç‚¹å‘ç»™å­èŠ‚ç‚¹ã€‚å­èŠ‚ç‚¹æ”¶åˆ°å°è£…å¥½çš„ä»»åŠ¡ä¿¡æ¯å¯¹è±¡åï¼Œå†æ„é€ JobDetailå’ŒTriggerï¼Œè®¾ç½®å¥½å¯åŠ¨æ—¶é—´åï¼Œé€šè¿‡å…¥å£ç±»å¯åŠ¨ä»»åŠ¡ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„demoã€‚","keywords":null,"text":"èƒŒæ™¯ åœ¨hadoopä¸­ï¼Œä¸»ä»èŠ‚ç‚¹ä¹‹é—´ä¿æŒç€å¿ƒè·³é€šä¿¡ï¼Œç”¨äºä¼ è¾“èŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯ã€ä»»åŠ¡è°ƒåº¦ä¿¡æ¯ä»¥åŠèŠ‚ç‚¹åŠ¨ä½œä¿¡æ¯ç­‰ç­‰ã€‚ hdfsçš„namenodeä¸datanodeï¼Œmapreduceçš„jobtrackerä¸tasktrackerï¼Œhbaseçš„hmasterä¸ regionserverä¹‹é—´çš„é€šä¿¡ï¼Œéƒ½æ˜¯åŸºäºhadoop RPCã€‚Hadoop RPCæ˜¯hadoopé‡Œéå¸¸åŸºç¡€çš„é€šä¿¡æ¡†æ¶ã€‚hadoop 2.0ä»¥å‰hadoop RPCçš„æ•°æ®åºåˆ—åŒ–æ˜¯é€šè¿‡å®ç°è‡ªå·±å®šä¹‰çš„Writableæ¥å£å®ç°ï¼Œè€Œä»hadoop 2.0å¼€å§‹ï¼Œæ•°æ®çš„åºåˆ—åŒ–å·¥ä½œäº¤ç»™äº†ProtocolBufferå»åšã€‚å…³äºHadoop RPCçš„å®ç°åŸç†å·²ç»æœ‰å¾ˆå¤šæ–‡ç« è¿›è¡Œäº†è¯¦ç»†çš„ä»‹ç»ï¼ˆæºç çº§å¼ºåŠ›åˆ†æhadoopçš„RPCæœºåˆ¶ï¼ŒHadoopåŸºäºProtocol Bufferçš„RPCå®ç°ä»£ç åˆ†æ-Serverç«¯ï¼Œå¸¦æœ‰HAåŠŸèƒ½çš„Hadoop Clientç«¯RPCå®ç°åŸç†ä¸ä»£ç åˆ†æï¼‰ï¼Œè¿™é‡Œå°±ä¸åœ¨èµ˜è¿°äº†ã€‚ä¸‹é¢å°±ç›´æ¥å¼•å…¥é—®é¢˜å’Œæ–¹æ¡ˆå§ã€‚ é—®é¢˜ å·¥ä½œä¸­ç»å¸¸éœ€è¦åœ¨å®šæ—¶ä»»åŠ¡ç³»ç»Ÿä¸Šå†™ä¸€äº›å®šæ—¶ä»»åŠ¡ï¼Œéšç€ä¸šåŠ¡è§„æ¨¡çš„å¢é•¿å’Œæ‰©å¤§ï¼Œéœ€è¦å®šæ—¶å¤„ç†çš„ä»»åŠ¡è¶Šæ¥è¶Šå¤šï¼Œä»»åŠ¡ä¹‹é—´çš„æ‰§è¡Œé—´éš”è¶Šæ¥è¶Šå°ï¼ŒæŸä¸€æ—¶é—´æ®µå†…ï¼ˆæ¯”å¦‚0ç‚¹ã€æ•´ç‚¹æˆ–åŠç‚¹ï¼‰æ‰§è¡Œçš„ä»»åŠ¡ä¼šè¶Šæ¥è¶Šå¯†é›†ï¼Œåªåœ¨ä¸€å°æœºå™¨ä¸Šæ‰§è¡Œè¿™äº›ä»»åŠ¡çš„è¯ï¼Œä¼šå‡ºç°è¾ƒå¤§çš„é£é™©ï¼š ä»»åŠ¡å¹¶å‘åº¦è¾ƒé«˜æ—¶ï¼Œå•æœºçš„ç³»ç»Ÿèµ„æºå°†æˆä¸ºç“¶é¢ˆ å¦‚æœä¸€ä¸ªä»»åŠ¡çš„è¿è¡Œå ç”¨äº†æ•´ä¸ªæœºå™¨çš„å¤§éƒ¨åˆ†èµ„æºï¼Œæ¯”å¦‚sqlæŸ¥è¯¢è€—è´¹å·¨å¤§å†…å­˜å’ŒCPUèµ„æºï¼Œå°†ç›´æ¥å½±å“å…¶ä»–ä»»åŠ¡çš„è¿è¡Œ ä»»åŠ¡å¤±è´¥åï¼Œå¦‚æœä»ç„¶åœ¨åŒä¸€å°èŠ‚ç‚¹è‡ªåŠ¨é‡æ–°æ‰§è¡Œï¼Œå¤±è´¥ç‡è¾ƒé«˜ æœºå™¨å®•æœºåï¼Œå¿…é¡»ç¬¬ä¸€æ—¶é—´é‡å¯æœºå™¨æˆ–é‡æ–°éƒ¨ç½²å®šæ—¶ä»»åŠ¡ç³»ç»Ÿï¼Œæ‰€æœ‰ä»»åŠ¡éƒ½ä¸èƒ½æŒ‰æ—¶æ‰§è¡Œ ç­‰ç­‰ æ–¹æ¡ˆ å¯æƒ³è€ŒçŸ¥çš„æ˜¯ï¼Œå¯ä»¥é€šè¿‡å°†å®šæ—¶ä»»åŠ¡ç³»ç»Ÿè¿›è¡Œåˆ†å¸ƒå¼æ”¹é€ ï¼Œä½¿ç”¨å¤šä¸ªèŠ‚ç‚¹æ‰§è¡Œä»»åŠ¡ï¼Œå°†ä»»åŠ¡åˆ†å‘åˆ°ä¸åŒèŠ‚ç‚¹ä¸Šè¿›è¡Œå¤„ç†ï¼Œå¹¶ä¸”å®Œå–„å¤±è´¥é‡è¯•æœºåˆ¶ï¼Œä»è€Œæé«˜ç³»ç»Ÿç¨³å®šæ€§ï¼Œå®ç°ä»»åŠ¡ç³»ç»Ÿçš„é«˜å¯é ã€‚ æ—¢ç„¶æ˜¯åœ¨å¤šä¸ªèŠ‚ç‚¹ä¹‹é—´åˆ†å‘ä»»åŠ¡ï¼Œè‚¯å®šå¾—æœ‰ä¸ªä»»åŠ¡çš„ç®¡ç†è€…(ä¸»èŠ‚ç‚¹)ï¼Œåœ¨æˆ‘ä»¬ç°æœ‰çš„ç³»ç»Ÿä¸­ï¼Œä¹Ÿå°±æ˜¯ä¸€å¥—å¯ä»¥éƒ¨ç½²å®šæ—¶ä»»åŠ¡çš„webç³»ç»Ÿï¼Œä»»åŠ¡ä»£ç æ›´æ–°åï¼Œéƒ¨ç½²å¥½è¿™å¥—webç³»ç»Ÿï¼Œå³å¯é€šè¿‡webé¡µé¢è®¾ç½®å®šæ—¶ä»»åŠ¡å¹¶ä¸”è¿›è¡Œè°ƒåº¦(åœ¨å•ä¸ªèŠ‚ç‚¹ä¸Šæ‰§è¡Œ)ã€‚æ‰§è¡Œä»»åŠ¡çš„èŠ‚ç‚¹(å­èŠ‚ç‚¹)æœ‰å¤šä¸ªä»¥åï¼Œå¦‚ä½•åˆ†å‘ä»»åŠ¡åˆ°å­èŠ‚ç‚¹å‘¢ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä»»åŠ¡çš„ä¿¡æ¯å°è£…æˆä¸€ä¸ªbeanï¼Œé€šè¿‡RPCå‘å¸ƒç»™å­èŠ‚ç‚¹ï¼Œå­èŠ‚ç‚¹é€šè¿‡è¿™ä¸ªä»»åŠ¡beanè·å¾—ä»»åŠ¡ä¿¡æ¯ï¼Œå¹¶åœ¨æŒ‡å®šçš„æ—¶åˆ»æ‰§è¡Œä»»åŠ¡ã€‚åŒæ—¶ï¼Œå­èŠ‚ç‚¹å¯ä»¥é€šè¿‡ä¸ä¸»èŠ‚ç‚¹çš„å¿ƒè·³é€šä¿¡å°†èŠ‚ç‚¹çŠ¶æ€å’Œæ‰§è¡Œä»»åŠ¡çš„æƒ…å†µå‘Šè¯‰ä¸»èŠ‚ç‚¹ã€‚ è¿™æ ·å…¶å®å°±ä¸hadoop mapreduceåˆ†å‘ä»»åŠ¡æœ‰ç‚¹ç›¸ä¼¼äº†ï¼Œå‘µå‘µï¼Œè¿™é‡Œä¸»èŠ‚ç‚¹ä¸å­èŠ‚ç‚¹ä¹‹é—´çš„é€šä¿¡ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡Hadoop RPCæ¡†æ¶æ¥å®ç°äº†ï¼Œä¸åŒçš„æ˜¯ï¼Œæˆ‘ä»¬åˆ†å‘çš„ä»»åŠ¡æ˜¯å®šæ—¶ä»»åŠ¡ï¼Œå‘å¸ƒä»»åŠ¡æ—¶éœ€è¦å°†ä»»åŠ¡çš„å®šæ—¶ä¿¡æ¯ä¸€å¹¶å‘ç»™å­èŠ‚ç‚¹ã€‚ å®ç° å•ç‚¹çš„å®šæ—¶ä»»åŠ¡ç³»ç»Ÿæ˜¯åŸºäºQuartzçš„ï¼Œåœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ï¼Œå¯ä»¥ç»§ç»­åŸºäºQuartzè¿›è¡Œæ”¹é€ ï¼Œä»»åŠ¡çš„å®šæ—¶ä¿¡æ¯å¯ä»¥é€šè¿‡Quartzä¸­çš„JobDetailå’ŒTriggerå¯¹è±¡æ¥æè¿°å¹¶å°è£…ï¼ŒåŠ ä¸Šä»»åŠ¡æ‰§è¡Œçš„å…¥å£ç±»ä¿¡æ¯ï¼Œå†é€šè¿‡RPCç”±ä¸»èŠ‚ç‚¹å‘ç»™å­èŠ‚ç‚¹ã€‚å­èŠ‚ç‚¹æ”¶åˆ°å°è£…å¥½çš„ä»»åŠ¡ä¿¡æ¯å¯¹è±¡åï¼Œå†æ„é€ JobDetailå’ŒTriggerï¼Œè®¾ç½®å¥½å¯åŠ¨æ—¶é—´åï¼Œé€šè¿‡å…¥å£ç±»å¯åŠ¨ä»»åŠ¡ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„demoã€‚ ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„å®šæ—¶ä»»åŠ¡ä¿¡æ¯æè¿°å¯¹è±¡CronJobInfoï¼ŒåŒ…æ‹¬JobDetailInfoå’ŒTriggerInfoä¸¤ä¸ªå±æ€§ï¼š 1234567891011121314151617181920212223/*** å®šæ—¶ä»»åŠ¡ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä»»åŠ¡ä¿¡æ¯å’Œè§¦å‘å™¨ä¿¡æ¯*/public class CronJobInfo implements Writable{ private JobDetailInfo jobDetailInfo = new JobDetailInfo(); private TriggerInfo triggerInfo = new TriggerInfo(); @Override public void readFields(DataInput in) throws IOException { jobDetailInfo.readFields(in); triggerInfo.readFields(in); } @Override public void write(DataOutput out) throws IOException { jobDetailInfo.write(out); triggerInfo.write(out); } // getters and setters...} ä»»åŠ¡ä¿¡æ¯JobDetailInfoï¼Œç”±ä¸»èŠ‚ç‚¹æ„é€ ï¼Œå­èŠ‚ç‚¹è§£ææ„é€ JobDetailå¯¹è±¡ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566public class JobDetailInfo implements Writable{ private String name; // ä»»åŠ¡åç§° private String group = Scheduler.DEFAULT_GROUP; // ä»»åŠ¡ç»„ private String description; // ä»»åŠ¡æè¿° private Class jobClass; // ä»»åŠ¡çš„å¯åŠ¨ç±» private JobDataMap jobDataMap; // ä»»åŠ¡æ‰€éœ€çš„å‚æ•°ï¼Œç”¨æ¥ç»™ä½œä¸šæä¾›æ•°æ®æ”¯æŒçš„æ•°æ®ç»“æ„ private boolean volatility = false; // &lt;span&gt;é‡å¯åº”ç”¨ä¹‹åæ˜¯å¦åˆ é™¤ä»»åŠ¡çš„ç›¸å…³ä¿¡æ¯,&lt;/span&gt; private boolean durability = false; // ä»»åŠ¡å®Œæˆä¹‹åæ˜¯å¦ä¾ç„¶ä¿ç•™åˆ°æ•°æ®åº“ private boolean shouldRecover = false; // åº”ç”¨é‡å¯ä¹‹åæ—¶å€™å¿½ç•¥è¿‡æœŸä»»åŠ¡ @Override public void readFields(DataInput in) throws IOException { name = WritableUtils.readString(in); group = WritableUtils.readString(in); description = WritableUtils.readString(in); String className = WritableUtils.readString(in); if (className != null) { try { jobClass = Class.forName(new String(className)); } catch (ClassNotFoundException e) { e.printStackTrace(); } } int dataMapSize = WritableUtils.readVInt(in); while (dataMapSize-- &gt; 0) { String key = WritableUtils.readString(in); String value = WritableUtils.readString(in); jobDataMap.put(key, value); } volatility = in.readBoolean(); durability = in.readBoolean(); shouldRecover = in.readBoolean(); } @Override public void write(DataOutput out) throws IOException { WritableUtils.writeString(out, name); WritableUtils.writeString(out, group); WritableUtils.writeString(out, description); WritableUtils.writeString(out, jobClass.getName()); if (jobDataMap == null) WritableUtils.writeVInt(out, 0); else { WritableUtils.writeVInt(out, jobDataMap.size()); for (Object k : jobDataMap.keySet()) { WritableUtils.writeString(out, k.toString()); WritableUtils.writeString(out, jobDataMap.get(k).toString()); } } out.writeBoolean(volatility); out.writeBoolean(durability); out.writeBoolean(shouldRecover); } //getters and setters //.....} ä»»åŠ¡è§¦å‘å™¨ä¿¡æ¯TriggerInfo ï¼Œç”±ä¸»èŠ‚ç‚¹æ„é€ ï¼Œå­èŠ‚ç‚¹è§£ææ„é€ Triggerå¯¹è±¡ï¼š 1234567891011121314151617181920212223242526272829303132333435363738public class TriggerInfo implements Writable{ private String name; // triggeråç§° private String group = Scheduler.DEFAULT_GROUP; // trigerç»„åç§° private String description; // triggeræè¿° private Date startTime; // å¯åŠ¨æ—¶é—´ private Date endTime; // ç»“æŸæ—¶é—´ private long repeatInterval; // é‡è¯•æ—¶é—´é—´éš” private int repeatCount; //é‡è¯•æ¬¡æ•° @Override public void readFields(DataInput in) throws IOException { name = WritableUtils.readString(in); group = WritableUtils.readString(in); description = WritableUtils.readString(in); long start = in.readLong(); startTime = start==0 ? null : new Date(start); long end = in.readLong(); endTime = end==0 ? null : new Date(end); repeatInterval = in.readLong(); repeatCount = in.readInt(); } @Override public void write(DataOutput out) throws IOException { WritableUtils.writeString(out, name); WritableUtils.writeString(out, group); WritableUtils.writeString(out, description); out.writeLong(startTime == null ? 0 : startTime.getTime()); out.writeLong(endTime == null ? 0 : endTime.getTime()); out.writeLong(repeatInterval); out.writeInt(repeatCount); } //getters and setters //.....} ä¸»ä»èŠ‚ç‚¹é€šä¿¡çš„åè®®ï¼š 1234public interface TaskProtocol extends VersionedProtocol{ public CronJobInfo hearbeat();} åœ¨è¿™ä¸ªdemoä¸­ï¼Œä¸»èŠ‚ç‚¹å¯åŠ¨åï¼Œå¯åŠ¨RPC serverçº¿ç¨‹ï¼Œç­‰å¾…å®¢æˆ·ç«¯ï¼ˆå­èŠ‚ç‚¹ï¼‰çš„è¿æ¥ï¼Œå½“å®¢æˆ·ç«¯è°ƒç”¨heartbeatæ–¹æ³•æ—¶ï¼Œä¸»èŠ‚ç‚¹å°†ä¼šç”Ÿæˆä¸€ä¸ªä»»åŠ¡ä¿¡æ¯è¿”å›ç»™å®¢æˆ·ç«¯ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970public class TaskScheduler implements TaskProtocol{ private Logger logger = Logger.getLogger(getClass()); private Server server; public TaskScheduler() { try { server = RPC.getServer(this, \"192.168.1.101\", 8888, new Configuration()); server.start(); server.join(); } catch (UnknownHostException e) { e.printStackTrace(); } catch (IOException e) { e.printStackTrace(); } catch (InterruptedException e) { e.printStackTrace(); } } @Override public long getProtocolVersion(String arg0, long arg1) throws IOException { return 1; } @Override public CronJobInfo generateCronJob() { // 1ã€åˆ›å»ºJobDetialå¯¹è±¡ JobDetailInfo detail = new JobDetailInfo(); // è®¾ç½®å·¥ä½œé¡¹ detail.setJobClass(DemoTask.class); detail.setName(\"MyJob_1\"); detail.setGroup(\"JobGroup_1\"); // 2ã€åˆ›å»ºTriggerå¯¹è±¡ TriggerInfo trigger = new TriggerInfo(); trigger.setName(\"Trigger_1\"); trigger.setGroup(\"Trigger_Group_1\"); trigger.setStartTime(new Date()); // è®¾ç½®é‡å¤åœæ­¢æ—¶é—´ï¼Œå¹¶é”€æ¯è¯¥Triggerå¯¹è±¡ Calendar c = Calendar.getInstance(); c.setTimeInMillis(System.currentTimeMillis() + 1000 * 1L); trigger.setEndTime(c.getTime()); // è®¾ç½®é‡å¤é—´éš”æ—¶é—´ trigger.setRepeatInterval(1000 * 1L); // è®¾ç½®é‡å¤æ‰§è¡Œæ¬¡æ•° trigger.setRepeatCount(3); CronJobInfo info = new CronJobInfo(); info.setJobDetailInfo(detail); info.setTriggerInfo(trigger); return info; } public static void main(String[] args) { TaskScheduler ts = new TaskScheduler(); }} demoä»»åŠ¡ç±»ï¼Œæ‰“å°ä¿¡æ¯ï¼š 12345678public class DemoTask implements Job{ public void execute(JobExecutionContext context) throws JobExecutionException { System.out.println(this + \": executing task @\" + new Date()); }} å­èŠ‚ç‚¹demoï¼Œå¯åŠ¨åè¿æ¥ä¸»èŠ‚ç‚¹ï¼Œè¿œç¨‹è°ƒç”¨generateCronJobæ–¹æ³•ï¼Œè·å¾—ä¸€ä¸ªä»»åŠ¡æè¿°ä¿¡æ¯ï¼Œå¹¶å¯åŠ¨å®šæ—¶ä»»åŠ¡ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394public class TaskRunner{ private Logger logger = Logger.getLogger(getClass()); private TaskProtocol proxy; public TaskRunner() { InetSocketAddress addr = new InetSocketAddress(\"localhost\", 8888); try { proxy = (TaskProtocol) RPC.waitForProxy(TaskProtocol.class, 1, addr, new Configuration()); } catch (IOException e) { e.printStackTrace(); } } public void close() { RPC.stopProxy(proxy); } /** * ä»serverè·å–ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ */ public void getCronJob() { CronJobInfo info = proxy.generateCronJob(); JobDetail jobDetail = getJobDetail(info.getJobDetailInfo()); SimpleTrigger trigger = getTrigger(info.getTriggerInfo()); // åˆ›å»ºSchedulerå¯¹è±¡ï¼Œå¹¶é…ç½®JobDetailå’ŒTriggerå¯¹è±¡ SchedulerFactory sf = new StdSchedulerFactory(); Scheduler scheduler = null; try { scheduler = sf.getScheduler(); scheduler.scheduleJob(jobDetail, trigger); // æ‰§è¡Œå¯åŠ¨æ“ä½œ scheduler.start(); } catch (SchedulerException e) { e.printStackTrace(); } } /** * @param jobDetailInfo * @return */ private JobDetail getJobDetail(JobDetailInfo info) { JobDetail detail = new JobDetail(); detail.setName(info.getName()); detail.setGroup(info.getGroup()); detail.setDescription(info.getDescription()); detail.setJobClass(info.getJobClass()); detail.setJobDataMap(info.getJobDataMap()); detail.setRequestsRecovery(info.isShouldRecover()); detail.setDurability(info.isDurability()); detail.setVolatility(info.isVolatility()); logger.info(\"client get jobdetail:\" + detail); return detail; } /** * @param triggerInfo * @return */ private SimpleTrigger getTrigger(TriggerInfo info) { SimpleTrigger trigger = new SimpleTrigger(); trigger.setName(info.getName()); trigger.setGroup(info.getGroup()); trigger.setDescription(info.getDescription()); trigger.setStartTime(info.getStartTime()); trigger.setEndTime(info.getEndTime()); trigger.setRepeatInterval(info.getRepeatInterval()); trigger.setRepeatCount(info.getRepeatCount()); logger.info(\"client get trigger:\" + trigger); return trigger; } public static void main(String[] args) { TaskRunner t = new TaskRunner(); t.getCronJob(); t.close(); }} å…ˆå¯åŠ¨TaskSchedulerï¼Œå†å¯åŠ¨TaskRunnerï¼Œç»“æœå¦‚ä¸‹ï¼š TaskScheduleræ—¥å¿—: 2013-01-20 15:42:21,661 [Socket Reader #1 for port 8888] INFO [org.apache.hadoop.ipc.Server] â€“ Starting Socket Reader #1 for port 8888 2013-01-20 15:42:21,662 [main] INFO [org.apache.hadoop.ipc.metrics.RpcMetrics] â€“ Initializing RPC Metrics with hostName=TaskScheduler, port=8888 2013-01-20 15:42:21,706 [main] INFO [org.apache.hadoop.ipc.metrics.RpcDetailedMetrics] â€“ Initializing RPC Metrics with hostName=TaskScheduler, port=8888 2013-01-20 15:42:21,710 [IPC Server listener on 8888] INFO [org.apache.hadoop.ipc.Server] â€“ IPC Server listener on 8888: starting 2013-01-20 15:42:21,711 [IPC Server Responder] INFO [org.apache.hadoop.ipc.Server] â€“ IPC Server Responder: starting 2013-01-20 15:42:21,711 [IPC Server handler 0 on 8888] INFO [org.apache.hadoop.ipc.Server] â€“ IPC Server handler 0 on 8888: starting 2013-01-20 15:42:24,084 [IPC Server handler 0 on 8888] INFO [org.mh.rpc.task.TaskScheduler] â€“ generate a task: org.mh.rpc.task.JobDetailInfo@1f26605 TaskRunner: 2013-01-20 15:42:26,323 [main] INFO [org.mh.rpc.task.TaskRunner] â€“ client get jobdetail:JobDetail â€˜JobGroup_1.MyJob_1â€²: jobClass: â€˜org.mh.rpc.quartz.GetSumTask isStateful: false isVolatile: false isDurable: false requestsRecovers: false 2013-01-20 15:42:26,329 [main] INFO [org.mh.rpc.task.TaskRunner] â€“ client get trigger:Trigger â€˜Trigger_Group_1.Trigger_1â€²: triggerClass: â€˜org.quartz.SimpleTrigger isVolatile: false calendar: â€˜nullâ€™ misfireInstruction: 0 nextFireTime: null 2013-01-20 15:42:26,382 [main] INFO [org.quartz.simpl.SimpleThreadPool] â€“ Job execution threads will use class loader of thread: main 2013-01-20 15:42:26,411 [main] INFO [org.quartz.core.SchedulerSignalerImpl] â€“ Initialized Scheduler Signaller of type: class org.quartz.core.SchedulerSignalerImpl 2013-01-20 15:42:26,411 [main] INFO [org.quartz.core.QuartzScheduler] â€“ Quartz Scheduler v.1.6.5 created. 2013-01-20 15:42:26,413 [main] INFO [org.quartz.simpl.RAMJobStore] â€“ RAMJobStore initialized. 2013-01-20 15:42:26,413 [main] INFO [org.quartz.impl.StdSchedulerFactory] â€“ Quartz scheduler â€˜DefaultQuartzSchedulerâ€™ initialized from default resource file in Quartz package: â€˜quartz.propertiesâ€™ 2013-01-20 15:42:26,413 [main] INFO [org.quartz.impl.StdSchedulerFactory] â€“ Quartz scheduler version: 1.6.5 2013-01-20 15:42:26,415 [main] INFO [org.quartz.core.QuartzScheduler] â€“ Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED started. org.mh.rpc.quartz.DemoTask@1b66b06: executing task @Sun Jan 20 15:42:26 CST 2013 ä¸Šé¢æ˜¯ä¸€ä¸ªç®€å•çš„demoï¼Œæ¼”ç¤ºäº†å¦‚ä½•é€šè¿‡RPCå°†ä»»åŠ¡è°ƒåº¦ç»™èŠ‚ç‚¹å»æ‰§è¡Œï¼Œå¯¹äºQuartzæ¥è¯´ï¼Œä»»åŠ¡çš„å½¢å¼å¯ä»¥åƒå˜ä¸‡åŒ–ï¼Œå…³é”®å°±çœ‹æ€ä¹ˆå»ä½¿ç”¨äº†ï¼Œåˆ†å‘åˆ°å¤šä¸ªèŠ‚ç‚¹ä¸Šæ‰§è¡Œçš„è¯ï¼Œå°±è¿˜éœ€è¦å¯¹ä»»åŠ¡çš„ä¿¡æ¯åšæ›´å¤šçš„å°è£…äº†ã€‚","raw":null,"content":null,"categories":[{"name":"Hadoop","slug":"Hadoop","permalink":"https://maohong.github.io/categories/Hadoop/"}],"tags":[{"name":"hadoop","slug":"hadoop","permalink":"https://maohong.github.io/tags/hadoop/"},{"name":"åˆ†å¸ƒå¼åº”ç”¨","slug":"åˆ†å¸ƒå¼åº”ç”¨","permalink":"https://maohong.github.io/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E5%BA%94%E7%94%A8/"},{"name":"RPC","slug":"RPC","permalink":"https://maohong.github.io/tags/RPC/"},{"name":"ä»»åŠ¡è°ƒåº¦","slug":"ä»»åŠ¡è°ƒåº¦","permalink":"https://maohong.github.io/tags/%E4%BB%BB%E5%8A%A1%E8%B0%83%E5%BA%A6/"}]},{"title":"ä½¿ç”¨zookeeperåè°ƒå¤šæœåŠ¡å™¨çš„ä»»åŠ¡å¤„ç†","slug":"ä½¿ç”¨zookeeperåè°ƒå¤šæœåŠ¡å™¨çš„ä»»åŠ¡å¤„ç†","date":"2013-11-13T08:16:43.000Z","updated":"2013-11-13T08:16:43.000Z","comments":true,"path":"20131113/ä½¿ç”¨zookeeperåè°ƒå¤šæœåŠ¡å™¨çš„ä»»åŠ¡å¤„ç†/","permalink":"https://maohong.github.io/20131113/%E4%BD%BF%E7%94%A8zookeeper%E5%8D%8F%E8%B0%83%E5%A4%9A%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E4%BB%BB%E5%8A%A1%E5%A4%84%E7%90%86/","excerpt":"èƒŒæ™¯ Zookeeperæ˜¯hadoopçš„å­é¡¹ç›®ï¼Œæ˜¯googleçš„chubbyçš„å¼€æºå®ç°ï¼Œæ˜¯ä¸€ä¸ªé’ˆå¯¹å¤§è§„æ¨¡åˆ†å¸ƒå¼ç³»ç»Ÿçš„å¯é çš„åˆ†å¸ƒå¼åè°ƒç³»ç»Ÿã€‚Zookeeperä¸€èˆ¬éƒ¨ç½²åœ¨ä¸€ä¸ªé›†ç¾¤ä¸Šï¼Œé€šè¿‡åœ¨é›†ç¾¤é—´ç»´æŠ¤ä¸€ä¸ªæ•°æ®æ ‘ï¼Œä½¿å¾—è¿æ¥åˆ°é›†ç¾¤çš„clientèƒ½å¤Ÿè·å¾—ç»Ÿä¸€çš„æ•°æ®ä¿¡æ¯ï¼Œæ¯”å¦‚ç³»ç»Ÿå…¬å…±é…ç½®ä¿¡æ¯ã€èŠ‚ç‚¹å­˜æ´»çŠ¶æ€ç­‰ç­‰ã€‚å› æ­¤ï¼Œåœ¨äº’è”ç½‘å…¬å¸ä¸­ï¼Œzookeeperè¢«å¹¿æ³›è¿ç”¨äºç»Ÿä¸€é…ç½®ç®¡ç†ã€åå­—æœåŠ¡ã€åˆ†å¸ƒå¼åŒæ­¥ç­‰ã€‚ é—®é¢˜ æˆ‘ä»¬çœ‹ä¸‹è¿™æ ·ä¸€ç§åœºæ™¯ï¼š å‰å°ç³»ç»Ÿæ¯æ—¶æ¯åˆ»éƒ½ç”Ÿæˆå¤§é‡æ•°æ®ï¼Œè¿™äº›åŸç”Ÿæ•°æ®ç”±åå°ç³»ç»Ÿå¤„ç†å®Œæ¯•åå†ä½œä»–ç”¨ï¼Œæˆ‘ä»¬æš‚ä¸”ä¸è°ˆè¿™äº›æ•°æ®çš„å­˜å‚¨å½¢å¼ï¼Œåªå…³æ³¨å¦‚ä½•èƒ½å¤Ÿå°½å¯èƒ½é«˜æ•ˆçš„å¤„ç†ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå‰å°ç³»ç»Ÿå¯èƒ½æ˜¯å¾®åšçš„å‰ç«¯å‘å¸ƒç³»ç»Ÿã€æœç´¢å¼•æ“ä¸Šçš„å¹¿å‘ŠæŠ•æ”¾ç³»ç»Ÿï¼Œæˆ–è€…æ˜¯ä»»åŠ¡å‘å¸ƒç³»ç»Ÿï¼Œåå°ç³»ç»Ÿåˆ™å¯èƒ½æ˜¯å¯¹å¾®åšå’Œå¹¿å‘Šä¿¡æ¯çš„å®¡æŸ¥ç³»ç»Ÿï¼Œæ¯”å¦‚ç”¨æˆ·å‘çš„å¾®åšå¦‚æœåŒ…å«è¿‘æœŸæ•æ„Ÿä¿¡æ¯åˆ™ä¸äºˆæ˜¾ç¤ºï¼Œè‹¥æ˜¯ä»»åŠ¡ï¼Œåå°ç³»ç»Ÿåˆ™è´Ÿè´£å¤„ç†ä»»åŠ¡å…·ä½“çš„æ‰§è¡Œã€‚ è‹¥æ•°æ®é‡å’Œä»»åŠ¡é‡è¾ƒå°ï¼Œå•èŠ‚ç‚¹çš„åå°ç³»ç»Ÿæˆ–è®¸å¯ä»¥å¤„ç†å¾—è¿‡æ¥ï¼Œä½†æ˜¯å¦‚æœæ•°æ®é‡å’Œä»»åŠ¡é‡å¾ˆå¤§ï¼ˆæ¯”å¦‚æ–°æµªå¾®åšï¼Œé¾™å¹´æ­£æœˆåˆä¸€0ç‚¹0åˆ†0ç§’ï¼Œå…±æœ‰32312æ¡å¾®åšåŒæ—¶å‘å¸ƒï¼‰ï¼Œå•èŠ‚ç‚¹çš„åå°ç³»ç»Ÿè‚¯å®šåƒä¸æ¶ˆï¼Œè¿™æ—¶å€™ï¼Œå¯æƒ³è€ŒçŸ¥çš„æ˜¯å¤šèŠ‚ç‚¹åŒæ—¶å¤„ç†å‰å°è¿‡æ¥çš„æ•°æ®ã€‚ æœ€ç®€å•çš„æ–¹æ³•æ˜¯ï¼ŒæŒ‰æ¶ˆæ¯idå¯¹åå°èŠ‚ç‚¹æ•°å–æ¨¡ï¼ˆmsgid%server_num=modï¼‰ï¼Œæ¯ä¸ªåå°èŠ‚ç‚¹å–è‡ªå·±é‚£ä»½æ•°æ®è¿›è¡Œå¤„ç†ï¼Œè¿™å°±éœ€è¦æ¯ä¸ªèŠ‚ç‚¹éƒ½çŸ¥æ™“å½“å‰æœ‰å¤šå°‘ä¸ªåå°èŠ‚ç‚¹ä»¥åŠæœ¬èŠ‚ç‚¹æ‰€åº”å–çš„modæ•°ã€‚ä½†æ˜¯ï¼Œå½“æŸä¸ªèŠ‚ç‚¹å®•æœºæ—¶ï¼Œè¿™ä¸ªèŠ‚ç‚¹æ‰€åº”å¤„ç†çš„æ•°æ®æ— æ³•è¢«ç»§ç»­å¤„ç†äº†ï¼ŒåŠ¿å¿…ä¼šé€ æˆé˜»å¡ï¼Œé™¤éé‡æ–°é…ç½®å„èŠ‚ç‚¹ä¸Šçš„å‚æ•°ï¼Œå°†èŠ‚ç‚¹æ•°server_numå‡1ï¼Œå¹¶ä¿®æ”¹å„èŠ‚ç‚¹å–æ•°æ®çš„modæ•°ã€‚ æ¯‹åº¸ç½®ç–‘ï¼Œè¿™æ ·éå¸¸éº»çƒ¦ï¼å¦‚æœèƒ½å¤Ÿå°†è¿™ç§é…ç½®ä¿¡æ¯ï¼ˆå®é™…ä¸Šæ˜¯æ•°æ®åœ¨èŠ‚ç‚¹é—´åˆ†é…çš„æ§åˆ¶ä¿¡æ¯ï¼‰ç»Ÿä¸€ç®¡ç†èµ·æ¥ï¼Œåœ¨é…ç½®ä¿¡æ¯å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå„ä¸ªåå°èŠ‚ç‚¹èƒ½å¤ŸåŠæ—¶çŸ¥æ™“å…¶å˜åŒ–ï¼Œå°±å¯ä»¥é¿å…ä¸Šè¿°æƒ…å†µçš„å‘ç”Ÿã€‚ å› æ­¤ï¼Œé‡‡ç”¨å¤šèŠ‚ç‚¹å¤„ç†æ•°æ®æ—¶ï¼Œæœ‰ä¸¤ä¸ªé—®é¢˜ï¼š 1.é¿å…å¤šä¸ªèŠ‚ç‚¹é‡å¤å¤„ç†åŒä¸€æ¡æ•°æ®ï¼Œå¦åˆ™é€ æˆèµ„æºæµªè´¹ã€‚ 2.ä¸èƒ½æœ‰æ•°æ®è¢«é—æ¼å¤„ç†ï¼Œå°¤å…¶æ˜¯åœ¨æœ‰åå°èŠ‚ç‚¹downæ‰çš„æ—¶å€™ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œé‡‡ç”¨å¤šèŠ‚ç‚¹åŒæ—¶å¤„ç†æ•°æ®æ—¶ï¼Œéœ€è¦å°†æ•°æ®éš”ç¦»å¼€ï¼Œåˆ†åˆ«ç»™ä¸åŒçš„èŠ‚ç‚¹å¤„ç†ï¼Œè€Œä¸”åœ¨æœ‰èŠ‚ç‚¹å®•æœºçš„æƒ…å†µä¸‹ï¼Œæ‰€æœ‰æ•°æ®ä¹Ÿå¿…é¡»å¯ä»¥æ— è¯¯çš„è¢«å…¶ä»–å¯ç”¨èŠ‚ç‚¹å¤„ç†ã€‚å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹å‘¢ï¼Œä½¿ç”¨zookeeperå§ï¼","keywords":null,"text":"èƒŒæ™¯ Zookeeperæ˜¯hadoopçš„å­é¡¹ç›®ï¼Œæ˜¯googleçš„chubbyçš„å¼€æºå®ç°ï¼Œæ˜¯ä¸€ä¸ªé’ˆå¯¹å¤§è§„æ¨¡åˆ†å¸ƒå¼ç³»ç»Ÿçš„å¯é çš„åˆ†å¸ƒå¼åè°ƒç³»ç»Ÿã€‚Zookeeperä¸€èˆ¬éƒ¨ç½²åœ¨ä¸€ä¸ªé›†ç¾¤ä¸Šï¼Œé€šè¿‡åœ¨é›†ç¾¤é—´ç»´æŠ¤ä¸€ä¸ªæ•°æ®æ ‘ï¼Œä½¿å¾—è¿æ¥åˆ°é›†ç¾¤çš„clientèƒ½å¤Ÿè·å¾—ç»Ÿä¸€çš„æ•°æ®ä¿¡æ¯ï¼Œæ¯”å¦‚ç³»ç»Ÿå…¬å…±é…ç½®ä¿¡æ¯ã€èŠ‚ç‚¹å­˜æ´»çŠ¶æ€ç­‰ç­‰ã€‚å› æ­¤ï¼Œåœ¨äº’è”ç½‘å…¬å¸ä¸­ï¼Œzookeeperè¢«å¹¿æ³›è¿ç”¨äºç»Ÿä¸€é…ç½®ç®¡ç†ã€åå­—æœåŠ¡ã€åˆ†å¸ƒå¼åŒæ­¥ç­‰ã€‚ é—®é¢˜ æˆ‘ä»¬çœ‹ä¸‹è¿™æ ·ä¸€ç§åœºæ™¯ï¼š å‰å°ç³»ç»Ÿæ¯æ—¶æ¯åˆ»éƒ½ç”Ÿæˆå¤§é‡æ•°æ®ï¼Œè¿™äº›åŸç”Ÿæ•°æ®ç”±åå°ç³»ç»Ÿå¤„ç†å®Œæ¯•åå†ä½œä»–ç”¨ï¼Œæˆ‘ä»¬æš‚ä¸”ä¸è°ˆè¿™äº›æ•°æ®çš„å­˜å‚¨å½¢å¼ï¼Œåªå…³æ³¨å¦‚ä½•èƒ½å¤Ÿå°½å¯èƒ½é«˜æ•ˆçš„å¤„ç†ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå‰å°ç³»ç»Ÿå¯èƒ½æ˜¯å¾®åšçš„å‰ç«¯å‘å¸ƒç³»ç»Ÿã€æœç´¢å¼•æ“ä¸Šçš„å¹¿å‘ŠæŠ•æ”¾ç³»ç»Ÿï¼Œæˆ–è€…æ˜¯ä»»åŠ¡å‘å¸ƒç³»ç»Ÿï¼Œåå°ç³»ç»Ÿåˆ™å¯èƒ½æ˜¯å¯¹å¾®åšå’Œå¹¿å‘Šä¿¡æ¯çš„å®¡æŸ¥ç³»ç»Ÿï¼Œæ¯”å¦‚ç”¨æˆ·å‘çš„å¾®åšå¦‚æœåŒ…å«è¿‘æœŸæ•æ„Ÿä¿¡æ¯åˆ™ä¸äºˆæ˜¾ç¤ºï¼Œè‹¥æ˜¯ä»»åŠ¡ï¼Œåå°ç³»ç»Ÿåˆ™è´Ÿè´£å¤„ç†ä»»åŠ¡å…·ä½“çš„æ‰§è¡Œã€‚ è‹¥æ•°æ®é‡å’Œä»»åŠ¡é‡è¾ƒå°ï¼Œå•èŠ‚ç‚¹çš„åå°ç³»ç»Ÿæˆ–è®¸å¯ä»¥å¤„ç†å¾—è¿‡æ¥ï¼Œä½†æ˜¯å¦‚æœæ•°æ®é‡å’Œä»»åŠ¡é‡å¾ˆå¤§ï¼ˆæ¯”å¦‚æ–°æµªå¾®åšï¼Œé¾™å¹´æ­£æœˆåˆä¸€0ç‚¹0åˆ†0ç§’ï¼Œå…±æœ‰32312æ¡å¾®åšåŒæ—¶å‘å¸ƒï¼‰ï¼Œå•èŠ‚ç‚¹çš„åå°ç³»ç»Ÿè‚¯å®šåƒä¸æ¶ˆï¼Œè¿™æ—¶å€™ï¼Œå¯æƒ³è€ŒçŸ¥çš„æ˜¯å¤šèŠ‚ç‚¹åŒæ—¶å¤„ç†å‰å°è¿‡æ¥çš„æ•°æ®ã€‚ æœ€ç®€å•çš„æ–¹æ³•æ˜¯ï¼ŒæŒ‰æ¶ˆæ¯idå¯¹åå°èŠ‚ç‚¹æ•°å–æ¨¡ï¼ˆmsgid%server_num=modï¼‰ï¼Œæ¯ä¸ªåå°èŠ‚ç‚¹å–è‡ªå·±é‚£ä»½æ•°æ®è¿›è¡Œå¤„ç†ï¼Œè¿™å°±éœ€è¦æ¯ä¸ªèŠ‚ç‚¹éƒ½çŸ¥æ™“å½“å‰æœ‰å¤šå°‘ä¸ªåå°èŠ‚ç‚¹ä»¥åŠæœ¬èŠ‚ç‚¹æ‰€åº”å–çš„modæ•°ã€‚ä½†æ˜¯ï¼Œå½“æŸä¸ªèŠ‚ç‚¹å®•æœºæ—¶ï¼Œè¿™ä¸ªèŠ‚ç‚¹æ‰€åº”å¤„ç†çš„æ•°æ®æ— æ³•è¢«ç»§ç»­å¤„ç†äº†ï¼ŒåŠ¿å¿…ä¼šé€ æˆé˜»å¡ï¼Œé™¤éé‡æ–°é…ç½®å„èŠ‚ç‚¹ä¸Šçš„å‚æ•°ï¼Œå°†èŠ‚ç‚¹æ•°server_numå‡1ï¼Œå¹¶ä¿®æ”¹å„èŠ‚ç‚¹å–æ•°æ®çš„modæ•°ã€‚ æ¯‹åº¸ç½®ç–‘ï¼Œè¿™æ ·éå¸¸éº»çƒ¦ï¼å¦‚æœèƒ½å¤Ÿå°†è¿™ç§é…ç½®ä¿¡æ¯ï¼ˆå®é™…ä¸Šæ˜¯æ•°æ®åœ¨èŠ‚ç‚¹é—´åˆ†é…çš„æ§åˆ¶ä¿¡æ¯ï¼‰ç»Ÿä¸€ç®¡ç†èµ·æ¥ï¼Œåœ¨é…ç½®ä¿¡æ¯å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå„ä¸ªåå°èŠ‚ç‚¹èƒ½å¤ŸåŠæ—¶çŸ¥æ™“å…¶å˜åŒ–ï¼Œå°±å¯ä»¥é¿å…ä¸Šè¿°æƒ…å†µçš„å‘ç”Ÿã€‚ å› æ­¤ï¼Œé‡‡ç”¨å¤šèŠ‚ç‚¹å¤„ç†æ•°æ®æ—¶ï¼Œæœ‰ä¸¤ä¸ªé—®é¢˜ï¼š 1.é¿å…å¤šä¸ªèŠ‚ç‚¹é‡å¤å¤„ç†åŒä¸€æ¡æ•°æ®ï¼Œå¦åˆ™é€ æˆèµ„æºæµªè´¹ã€‚ 2.ä¸èƒ½æœ‰æ•°æ®è¢«é—æ¼å¤„ç†ï¼Œå°¤å…¶æ˜¯åœ¨æœ‰åå°èŠ‚ç‚¹downæ‰çš„æ—¶å€™ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œé‡‡ç”¨å¤šèŠ‚ç‚¹åŒæ—¶å¤„ç†æ•°æ®æ—¶ï¼Œéœ€è¦å°†æ•°æ®éš”ç¦»å¼€ï¼Œåˆ†åˆ«ç»™ä¸åŒçš„èŠ‚ç‚¹å¤„ç†ï¼Œè€Œä¸”åœ¨æœ‰èŠ‚ç‚¹å®•æœºçš„æƒ…å†µä¸‹ï¼Œæ‰€æœ‰æ•°æ®ä¹Ÿå¿…é¡»å¯ä»¥æ— è¯¯çš„è¢«å…¶ä»–å¯ç”¨èŠ‚ç‚¹å¤„ç†ã€‚å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹å‘¢ï¼Œä½¿ç”¨zookeeperå§ï¼ è§£å†³æ–¹æ¡ˆ æˆ‘ä»¬é€šè¿‡zookeeperç»´æŠ¤ä¸€ä¸ªç›®å½•ï¼ˆæ¯”å¦‚/app/configï¼‰ï¼ŒæœåŠ¡å™¨å¯åŠ¨æ—¶è¿æ¥zookeeperé›†ç¾¤å¹¶åœ¨è¯¥ç›®å½•ä¸‹åˆ›å»ºè¡¨ç¤ºè‡ªå·±çš„ä¸´æ—¶èŠ‚ç‚¹ï¼ˆCreateMode.EPHEMERALï¼‰ï¼Œç›¸å½“äºæ³¨å†Œä¸€ä¸ªèŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹åå¯ä»¥æ˜¯æœ¬æœåŠ¡å™¨çš„ipï¼ŒèŠ‚ç‚¹çš„å€¼ä¸ºè¯¥æœåŠ¡å™¨çš„modå€¼ï¼ŒæŒ‰æ³¨å†Œé¡ºåºä»0é€’å¢ï¼Œå³ç¬¬ä¸€ä¸ªæ³¨å†Œçš„èŠ‚ç‚¹å€¼ä¸º0ï¼Œç¬¬äºŒä¸ªä¸º1ï¼Œä¾æ¬¡ä¸‹å»ï¼Œå› æ­¤/app/configçš„å­èŠ‚ç‚¹æ•°å°±æ˜¯æ³¨å†Œåˆ°zookeeperçš„æœåŠ¡å™¨æ•°ã€‚åŒæ—¶ï¼Œå„æœåŠ¡å™¨ç›‘å¬/app/configç›®å½•ï¼Œå½“å…¶å‘ç”Ÿå˜åŒ–ï¼ˆæ–°åŠ å…¥å­èŠ‚ç‚¹ã€å­èŠ‚ç‚¹å¤±æ•ˆç­‰ï¼‰æ—¶ï¼Œæ¯ä¸ªæœåŠ¡å™¨éƒ½å°†è·å–åˆ°è¿™ä¸ªäº‹ä»¶å¹¶è¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚ demo ä¸‹é¢é’ˆå¯¹ä»¥ä¸Šåœºæ™¯ç»™å‡ºä¸€ä¸ªç¤ºä¾‹demoã€‚ Serverç±»ï¼šæœåŠ¡å™¨ ClientThreadç±»ï¼šæœåŠ¡å™¨ä¸Šçš„å•ä¸ªçº¿ç¨‹ NodeStateWatcherç±»ï¼šæœåŠ¡å™¨ç›‘å¬zookeeperé›†ç¾¤çš„ç›‘å¬å™¨ ZkOperationImplç±»ï¼šzookeeperçš„æ“ä½œå°è£…ï¼ˆå®ç°ZkOperationæ¥å£ï¼‰ Server.java 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169public class Server extends Thread{ private ClientThread[] clients = new ClientThread[Constant.THREAD_COUNT]; // æ•°æ®å¤„ç†çº¿ç¨‹ private ZkOperation operationCient = null; // ä¸zookeeperçš„è¿æ¥ private Watcher nodeWatcher = null; // å‘zookeeperæ³¨å†Œçš„ç›‘å¬å™¨ private String name; // æœåŠ¡å™¨å private String ip; // æœåŠ¡å™¨ip public Server(String name, String ip) throws IOException, KeeperException, InterruptedException { this.name = name; this.ip = ip; this.operationCient = new ZkOperationImpl(); this.nodeWatcher = new NodeStateWatcher(this); this.operationCient.init(Constant.ZK_ADDRESS, nodeWatcher); for (int i=0; i&lt;Constant.THREAD_COUNT; ++i) { ClientThread c = new ClientThread(i, ip, name); this.clients[i]= c; } initialize(); } /** * å‘zookeeperé›†ç¾¤æ³¨å†Œ * @throws InterruptedException * @throws KeeperException */ private void registerServer() throws KeeperException, InterruptedException { List&lt;String&gt; children = operationCient.getChilds(Constant.ROOT_PATH); int max = -1; for (String childName : children) { String childPath = Constant.ROOT_PATH + \"/\" + childName; int mod = Integer.parseInt(operationCient.getData(childPath)); if (mod &gt; max) max = mod; } String path = Constant.ROOT_PATH + \"/\" + ip; operationCient.apendTempNode(path, String.valueOf(max&lt;0 ? 0 : ++max)); } /** * å¯åŠ¨æ•°æ®å¤„ç†çº¿ç¨‹ * @throws Exception */ public void run() { for (ClientThread c : clients) { CommonUtil.log(\"Start thread-\" + c); c.start(); } } /** * æœåŠ¡å™¨åˆå§‹åŒ– * @throws InterruptedException * @throws KeeperException */ private void initialize() throws KeeperException, InterruptedException { CommonUtil.log(\"================\"); CommonUtil.log(this + \" initializing...\"); // é…ç½®ä¿¡æ¯çš„ä¸Šçº§ç›®å½•ä¸å­˜åœ¨ if (!operationCient.exist(Constant.ROOT_PATH)) { System.err.println(\"Root path \" + Constant.ROOT_PATH + \"does not exist!!! Create root path...\"); operationCient.apendPresistentNode(Constant.ROOT_PATH, \"1\"); CommonUtil.log(\"Create root path \" + Constant.ROOT_PATH + \" successfully!\"); } registerServer(); refreshConfig(); CommonUtil.log(this + \" finish initializing...\"); CommonUtil.log(\"================\"); } /** * watchåˆ°èŠ‚ç‚¹å˜åŒ–åï¼Œåˆ·æ–°èŠ‚ç‚¹æ•°å’Œæ¨¡æ•° * @throws InterruptedException * @throws KeeperException */ public void refresh() throws KeeperException, InterruptedException { CommonUtil.log(\"================\"); CommonUtil.log(this + \":freshing...\"); refreshConfig(); CommonUtil.log(this + \":end freshing...\"); CommonUtil.log(\"================\"); } private void refreshConfig() throws KeeperException, InterruptedException { String version = operationCient.getData(Constant.ROOT_PATH); CommonUtil.log(\"SYSTEM VERSION: \" + version); List&lt;String&gt; children = operationCient.getChilds(Constant.ROOT_PATH); // 1. æœåŠ¡å™¨æ•°é‡ä¸ºå­èŠ‚ç‚¹çš„ä¸ªæ•° int nodeCount = children.size(); CommonUtil.log(\"Server count:\" + nodeCount); synchronized (CommonUtil.BASE) { CommonUtil.BASE = nodeCount * Constant.THREAD_COUNT; } if (CommonUtil.BASE.intValue() == 0) return; Integer mod = null; for (String childName : children) { // 2. è·å–æœ¬æœåŠ¡å™¨çš„æ¨¡æ•° if (childName.equals(ip)) { String childPath = Constant.ROOT_PATH + \"/\" + childName; mod = Integer.parseInt(operationCient.getData(childPath)); break; } } // 3. åˆ·æ–°æ•°æ®å¤„ç†çº¿ç¨‹çš„å–æ¨¡æ•° if (mod == null) { System.err.println(\"Did not get the mod number for \" + this); } else { CommonUtil.log(this + \", mod=\" + mod + \",base=\" + CommonUtil.BASE); for (ClientThread c : clients) { c.refresh(mod); } } } public String toString() { return this.name + \"@\" + this.ip + \"\"; } public ClientThread[] getClients() { return clients; } public ZkOperation getOperationCient() { return operationCient; } public Watcher getNodeWatcher() { return nodeWatcher; } public String getIp() { return ip; }} ClientThread.java 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100public class ClientThread extends Thread{ private Integer modNum = -1; private Integer threadId; private String ip; private String clientName; public ClientThread(Integer threadId, String ip, String clientName) throws IOException, KeeperException, InterruptedException { this.threadId = threadId; this.ip = ip; this.clientName = clientName; } /** * watchåˆ°èŠ‚ç‚¹å˜åŒ–åï¼Œè°ƒç”¨åˆ·æ–°èŠ‚ç‚¹æ•°å’Œæ¨¡æ•° * @throws InterruptedException * @throws KeeperException */ public void refresh(int mod) throws KeeperException, InterruptedException {// CommonUtil.log(\"================\");// CommonUtil.log(this + \":freshing...\"); synchronized (this.modNum) { this.modNum = threadId + mod * Constant.THREAD_COUNT; } CommonUtil.log(this + \":\" + modNum + \"/\" + CommonUtil.BASE);// CommonUtil.log(this + \":end freshing...\");// CommonUtil.log(\"================\"); } @Override public void run() { long start = System.currentTimeMillis(); while (System.currentTimeMillis() - start &lt; Constant.DURATION) { // å¤„ç†æ•°æ® processData(); try { Thread.sleep(5000); //ç­‰å¾…2ç§’ } catch (InterruptedException e) { e.printStackTrace(); } } } /** * æ¨¡æ‹Ÿå¤„ç†æ•°æ®é€»è¾‘ï¼šæ‰“å°å±äºæœ¬çº¿ç¨‹çš„æ•°æ® */ private void processData() { if (CommonUtil.BASE.equals(0) || modNum.equals(-1)) { CommonUtil.err(this + \": did not get server_count and modNum!!!\"); return; } StringBuilder sb = new StringBuilder(this + \"-\" + modNum + \"/\" + CommonUtil.BASE + \":\"); for (int i=0; i&lt;Constant.NUMBERS.length; ++i) { int n = Constant.NUMBERS[i]; if (n % CommonUtil.BASE == modNum) { sb.append(n).append(\" \"); } } CommonUtil.log(sb.toString()); } @Override public String toString() { return \"ClientThread_\" + this.clientName + \"@\" + this.ip + \"-thread_\" + this.threadId; } public Integer getModNum() { return modNum; } public synchronized void setModNum(Integer modNum) { this.modNum = modNum; } public String getClientName() { return clientName; }} NodeStateWatcher.java 1234567891011121314151617181920212223242526272829303132333435363738394041424344public class NodeStateWatcher implements Watcher{ private Server server; public NodeStateWatcher(Server server) { this.server = server; } @Override public void process(WatchedEvent event) { StringBuilder outputStr = new StringBuilder(); if (server.getName() != null) { outputStr.append(server.getName() + \" get an event.\"); } outputStr.append(\"Path:\" + event.getPath()); outputStr.append(\",state:\" + event.getState()); outputStr.append(\",type:\" + event.getType()); CommonUtil.log(outputStr.toString()); // å‘ç°å­èŠ‚ç‚¹æœ‰å˜åŒ– if (event.getType() == EventType.NodeChildrenChanged || event.getType() == EventType.NodeDataChanged || event.getType() == EventType.NodeDeleted) { CommonUtil.log(\"In event: \" + event.getType()); try { server.refresh(); } catch (KeeperException e) { e.printStackTrace(); } catch (InterruptedException e) { e.printStackTrace(); } CommonUtil.log(\"End event: \" + event.getType()); } }} ZkOperationImpl.java éƒ¨åˆ†zkæ“ä½œä»£ç  1234567891011121314151617181920212223242526272829303132@Override public void apendPresistentNode(String path, String data) throws KeeperException, InterruptedException { if (zk != null) { zk.create(path, data.getBytes(), Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT); } } @Override public void delNode(String path) throws KeeperException, InterruptedException { if (zk != null) { zk.delete(path, -1); } } @Override public boolean exist(String path) throws KeeperException, InterruptedException { if (zk != null) { return zk.exists(path, true) != null; } return false; }} Main.javaï¼šä¸»ç±»ï¼Œå¯åŠ¨demo 12345678910111213public class Main{ public static void main(String[] args) throws Exception { Server c1 = new Server(\"ServerA\", \"1.1.1.1\"); Server c2 = new Server(\"ServerB\", \"1.1.1.2\"); Server c3 = new Server(\"ServerC\", \"1.1.1.3\"); c1.start(); c2.start(); c3.start(); }} éªŒè¯ ç”±äºServerçš„3ä¸ªå®ä¾‹åœ¨åŒä¸€å°æœºå™¨ä¸Šè¿è¡Œï¼Œè¿æ¥åˆ°zookeeperæ—¶ï¼Œç”¨çš„æ˜¯ä¸€ä¸ªsessionï¼Œæ‰€ä»¥demoä¸­æ²¡æœ‰é€šè¿‡ç¨‹åºæ–­å¼€serverä¸zookeeperçš„è¿æ¥ï¼Œå¦‚æœserverAæ–­å¼€ï¼Œé‚£ä¹ˆserverBå’ŒserverCä¸zookeeperçš„sessionè¿æ¥ä¹Ÿä¼šå¤±æ•ˆï¼Œè¾¾ä¸åˆ°æ¼”ç¤ºæ•ˆæœï¼Œæ‰€ä»¥æˆ‘ä»¬åªèƒ½æš‚æ—¶åœ¨zookeeperå®¢æˆ·ç«¯æ‰‹å·¥æ›´æ”¹zookeeperä¸Šçš„é…ç½®ä¿¡æ¯ï¼Œç”¨äºæ¨¡æ‹Ÿserverä¸zookeeperé›†ç¾¤æ–­å¼€è¿æ¥å’Œå¢åŠ serverçš„æƒ…å½¢ã€‚serverå¯åŠ¨åï¼Œä¼šå…ˆå‘zookeeperæ³¨å†ŒèŠ‚ç‚¹ï¼Œå› æ­¤æˆ‘ä»¬å…ˆæ‰‹å·¥åˆ é™¤èŠ‚ç‚¹ï¼Œå†æ‰‹å·¥æ·»åŠ èŠ‚ç‚¹ã€‚ æ‰‹å·¥æ‰§è¡Œçš„å‘½ä»¤å¦‚ä¸‹ï¼š [zk: localhost:2181(CONNECTED) 141] delete /demo/1.1.1.3 [zk: localhost:2181(CONNECTED) 142] delete /demo/1.1.1.2 [zk: localhost:2181(CONNECTED) 143] delete /demo/1.1.1.1 [zk: localhost:2181(CONNECTED) 144] create -e /demo/1.1.1.1 0 [zk: localhost:2181(CONNECTED) 145] create -e /demo/1.1.1.2 1 [zk: localhost:2181(CONNECTED) 146] create -e /demo/1.1.1.3 2 å¯ä»¥é€šè¿‡ç¨‹åºæ‰“å°ä¿¡æ¯å‘ç°ï¼Œåœ¨èŠ‚ç‚¹é…ç½®ä¿¡æ¯æ¯ä¸ªæœåŠ¡å™¨(Server)ä¸Šçš„çº¿ç¨‹ä¼šåŠ¨æ€çš„è·å–å±äºè‡ªå·±çš„æ•°æ®å¹¶æ‰“å°ã€‚å½“ç„¶ï¼Œè¿™é‡Œå¯¹æ•°æ®çš„å¤„ç†é€»è¾‘å¾ˆç®€å•ï¼Œä»…ä»…æ˜¯æ‰“å°å‡ºæ¥ï¼Œå¤„ç†çš„æ•°æ®ä¹Ÿåªæ˜¯å†…å­˜ä¸­çš„ä¸€ä¸ªæ•°ç»„ï¼Œå¯¹äºç±»ä¼¼è¿™æ ·çš„ä½†æ˜¯æ›´å¤æ‚çš„åº”ç”¨åœºæ™¯ï¼ŒzookeeperåŒæ ·é€‚ç”¨ï¼Œä½†æ˜¯éœ€è¦æ›´å¤šçš„è€ƒè™‘æœåŠ¡å™¨ä¸zookeeperé›†ç¾¤è¿æ¥çš„å¯é æ€§ï¼ˆæ¯”å¦‚sessionè¶…æ—¶é‡è¿ï¼‰ã€æƒé™æœºåˆ¶ç­‰ç­‰ã€‚ ä¸Šé¢çš„demoç¨‹åºæ‰“å°ä¿¡æ¯å¦‚ä¸‹ï¼š [2012-11-14 15:18:42] New zk connection session: 0 [2012-11-14 15:18:42] ================ [2012-11-14 15:18:42] ServerA@1.1.1.1 initializingâ€¦ [2012-11-14 15:18:47] Thread-0 get an event.Path:null,state:SyncConnected,type:None [2012-11-14 15:18:47] Thread-0 get an event.Path:/demo,state:SyncConnected,type:NodeChildrenChanged [2012-11-14 15:18:47] In event: NodeChildrenChanged [2012-11-14 15:18:47] ================ [2012-11-14 15:18:47] ServerA@1.1.1.1:freshingâ€¦ [2012-11-14 15:18:47] SYSTEM VERSION: 1 [2012-11-14 15:18:47] SYSTEM VERSION: 1 [2012-11-14 15:18:47] Server count:1 [2012-11-14 15:18:47] Server count:1 [2012-11-14 15:18:47] ServerA@1.1.1.1, mod=0,base=5 [2012-11-14 15:18:47] ClientThread_ServerA@1.1.1.1-thread_0:0/5 [2012-11-14 15:18:47] ClientThread_ServerA@1.1.1.1-thread_1:1/5 [2012-11-14 15:18:47] ClientThread_ServerA@1.1.1.1-thread_2:2/5 [2012-11-14 15:18:47] ClientThread_ServerA@1.1.1.1-thread_3:3/5 [2012-11-14 15:18:47] ClientThread_ServerA@1.1.1.1-thread_4:4/5 [2012-11-14 15:18:47] ServerA@1.1.1.1 finish initializingâ€¦ [2012-11-14 15:18:47] ================ [2012-11-14 15:18:47] ServerA@1.1.1.1, mod=0,base=5 [2012-11-14 15:18:47] ClientThread_ServerA@1.1.1.1-thread_0:0/5 [2012-11-14 15:18:47] ClientThread_ServerA@1.1.1.1-thread_1:1/5 [2012-11-14 15:18:47] ClientThread_ServerA@1.1.1.1-thread_2:2/5 [2012-11-14 15:18:47] ClientThread_ServerA@1.1.1.1-thread_3:3/5 [2012-11-14 15:18:47] ClientThread_ServerA@1.1.1.1-thread_4:4/5 [2012-11-14 15:18:47] ServerA@1.1.1.1:end freshingâ€¦ [2012-11-14 15:18:47] ================ [2012-11-14 15:18:47] End event: NodeChildrenChanged [2012-11-14 15:18:47] New zk connection session: 0 [2012-11-14 15:18:47] ================ [2012-11-14 15:18:47] ServerB@1.1.1.2 initializingâ€¦ [2012-11-14 15:18:51] Thread-6 get an event.Path:null,state:SyncConnected,type:None [2012-11-14 15:18:51] Thread-0 get an event.Path:/demo,state:SyncConnected,type:NodeChildrenChanged [2012-11-14 15:18:51] In event: NodeChildrenChanged [2012-11-14 15:18:51] ================ [2012-11-14 15:18:51] ServerA@1.1.1.1:freshingâ€¦ [2012-11-14 15:18:51] Thread-6 get an event.Path:/demo,state:SyncConnected,type:NodeChildrenChanged [2012-11-14 15:18:51] In event: NodeChildrenChanged [2012-11-14 15:18:51] ================ [2012-11-14 15:18:51] ServerB@1.1.1.2:freshingâ€¦ [2012-11-14 15:18:51] SYSTEM VERSION: 1 [2012-11-14 15:18:51] SYSTEM VERSION: 1 [2012-11-14 15:18:51] Server count:2 [2012-11-14 15:18:51] SYSTEM VERSION: 1 [2012-11-14 15:18:51] ServerA@1.1.1.1, mod=0,base=10 [2012-11-14 15:18:51] ClientThread_ServerA@1.1.1.1-thread_0:0/10 [2012-11-14 15:18:51] ClientThread_ServerA@1.1.1.1-thread_1:1/10 [2012-11-14 15:18:51] ClientThread_ServerA@1.1.1.1-thread_2:2/10 [2012-11-14 15:18:51] ClientThread_ServerA@1.1.1.1-thread_3:3/10 [2012-11-14 15:18:51] ClientThread_ServerA@1.1.1.1-thread_4:4/10 [2012-11-14 15:18:51] ServerA@1.1.1.1:end freshingâ€¦ [2012-11-14 15:18:51] Server count:2 [2012-11-14 15:18:51] ================ [2012-11-14 15:18:51] End event: NodeChildrenChanged [2012-11-14 15:18:51] Server count:2 [2012-11-14 15:18:51] ServerB@1.1.1.2, mod=1,base=10 [2012-11-14 15:18:51] ClientThread_ServerB@1.1.1.2-thread_0:5/10 [2012-11-14 15:18:51] ClientThread_ServerB@1.1.1.2-thread_1:6/10 [2012-11-14 15:18:51] ClientThread_ServerB@1.1.1.2-thread_2:7/10 [2012-11-14 15:18:51] ClientThread_ServerB@1.1.1.2-thread_3:8/10 [2012-11-14 15:18:51] ClientThread_ServerB@1.1.1.2-thread_4:9/10 [2012-11-14 15:18:51] ServerB@1.1.1.2:end freshingâ€¦ [2012-11-14 15:18:51] ================ [2012-11-14 15:18:51] End event: NodeChildrenChanged [2012-11-14 15:18:51] ServerB@1.1.1.2, mod=1,base=10 [2012-11-14 15:18:51] ClientThread_ServerB@1.1.1.2-thread_0:5/10 [2012-11-14 15:18:51] ClientThread_ServerB@1.1.1.2-thread_1:6/10 [2012-11-14 15:18:51] ClientThread_ServerB@1.1.1.2-thread_2:7/10 [2012-11-14 15:18:51] ClientThread_ServerB@1.1.1.2-thread_3:8/10 [2012-11-14 15:18:51] ClientThread_ServerB@1.1.1.2-thread_4:9/10 [2012-11-14 15:18:51] ServerB@1.1.1.2 finish initializingâ€¦ [2012-11-14 15:18:51] ================ [2012-11-14 15:18:51] New zk connection session: 0 [2012-11-14 15:18:51] ================ [2012-11-14 15:18:51] ServerC@1.1.1.3 initializingâ€¦ [2012-11-14 15:18:56] Thread-12 get an event.Path:null,state:SyncConnected,type:None [2012-11-14 15:18:56] Thread-0 get an event.Path:/demo,state:SyncConnected,type:NodeChildrenChanged [2012-11-14 15:18:56] In event: NodeChildrenChanged [2012-11-14 15:18:56] ================ [2012-11-14 15:18:56] ServerA@1.1.1.1:freshingâ€¦ [2012-11-14 15:18:56] Thread-6 get an event.Path:/demo,state:SyncConnected,type:NodeChildrenChanged [2012-11-14 15:18:56] In event: NodeChildrenChanged [2012-11-14 15:18:56] ================ [2012-11-14 15:18:56] ServerB@1.1.1.2:freshingâ€¦ [2012-11-14 15:18:56] Thread-12 get an event.Path:/demo,state:SyncConnected,type:NodeChildrenChanged [2012-11-14 15:18:56] In event: NodeChildrenChanged [2012-11-14 15:18:56] ================ [2012-11-14 15:18:56] ServerC@1.1.1.3:freshingâ€¦ [2012-11-14 15:18:56] SYSTEM VERSION: 1 [2012-11-14 15:18:56] SYSTEM VERSION: 1 [2012-11-14 15:18:56] SYSTEM VERSION: 1 [2012-11-14 15:18:56] Server count:3 [2012-11-14 15:18:56] ServerA@1.1.1.1, mod=0,base=15 [2012-11-14 15:18:56] ClientThread_ServerA@1.1.1.1-thread_0:0/15 [2012-11-14 15:18:56] Server count:3 [2012-11-14 15:18:56] ClientThread_ServerA@1.1.1.1-thread_1:1/15 [2012-11-14 15:18:56] ClientThread_ServerA@1.1.1.1-thread_2:2/15 [2012-11-14 15:18:56] ClientThread_ServerA@1.1.1.1-thread_3:3/15 [2012-11-14 15:18:56] ClientThread_ServerA@1.1.1.1-thread_4:4/15 [2012-11-14 15:18:56] ServerA@1.1.1.1:end freshingâ€¦ [2012-11-14 15:18:56] ================ [2012-11-14 15:18:56] End event: NodeChildrenChanged [2012-11-14 15:18:56] SYSTEM VERSION: 1 [2012-11-14 15:18:56] Server count:3 [2012-11-14 15:18:56] ServerB@1.1.1.2, mod=1,base=15 [2012-11-14 15:18:56] ClientThread_ServerB@1.1.1.2-thread_0:5/15 [2012-11-14 15:18:56] ClientThread_ServerB@1.1.1.2-thread_1:6/15 [2012-11-14 15:18:56] ClientThread_ServerB@1.1.1.2-thread_2:7/15 [2012-11-14 15:18:56] ClientThread_ServerB@1.1.1.2-thread_3:8/15 [2012-11-14 15:18:56] ClientThread_ServerB@1.1.1.2-thread_4:9/15 [2012-11-14 15:18:56] ServerB@1.1.1.2:end freshingâ€¦ [2012-11-14 15:18:56] ================ [2012-11-14 15:18:56] End event: NodeChildrenChanged [2012-11-14 15:18:56] Server count:3 [2012-11-14 15:18:56] ServerC@1.1.1.3, mod=2,base=15 [2012-11-14 15:18:56] ClientThread_ServerC@1.1.1.3-thread_0:10/15 [2012-11-14 15:18:56] ClientThread_ServerC@1.1.1.3-thread_1:11/15 [2012-11-14 15:18:56] ClientThread_ServerC@1.1.1.3-thread_2:12/15 [2012-11-14 15:18:56] ClientThread_ServerC@1.1.1.3-thread_3:13/15 [2012-11-14 15:18:56] ClientThread_ServerC@1.1.1.3-thread_4:14/15 [2012-11-14 15:18:56] ServerC@1.1.1.3:end freshingâ€¦ [2012-11-14 15:18:56] ================ [2012-11-14 15:18:56] End event: NodeChildrenChanged [2012-11-14 15:18:56] ServerC@1.1.1.3, mod=2,base=15 [2012-11-14 15:18:56] ClientThread_ServerC@1.1.1.3-thread_0:10/15 [2012-11-14 15:18:56] ClientThread_ServerC@1.1.1.3-thread_1:11/15 [2012-11-14 15:18:56] ClientThread_ServerC@1.1.1.3-thread_2:12/15 [2012-11-14 15:18:56] ClientThread_ServerC@1.1.1.3-thread_3:13/15 [2012-11-14 15:18:56] ClientThread_ServerC@1.1.1.3-thread_4:14/15 [2012-11-14 15:18:56] ServerC@1.1.1.3 finish initializingâ€¦ [2012-11-14 15:18:56] ================ [2012-11-14 15:18:56] Start thread-ClientThread_ServerA@1.1.1.1-thread_0 [2012-11-14 15:18:56] Start thread-ClientThread_ServerB@1.1.1.2-thread_0 [2012-11-14 15:18:56] Start thread-ClientThread_ServerC@1.1.1.3-thread_0 [2012-11-14 15:18:56] Start thread-ClientThread_ServerB@1.1.1.2-thread_1 [2012-11-14 15:18:56] Start thread-ClientThread_ServerA@1.1.1.1-thread_1 [2012-11-14 15:18:56] ClientThread_ServerA@1.1.1.1-thread_0-0/15:15 30 [2012-11-14 15:18:56] Start thread-ClientThread_ServerA@1.1.1.1-thread_2 [2012-11-14 15:18:56] ClientThread_ServerC@1.1.1.3-thread_0-10/15:10 25 [2012-11-14 15:18:56] Start thread-ClientThread_ServerA@1.1.1.1-thread_3 [2012-11-14 15:18:56] ClientThread_ServerB@1.1.1.2-thread_0-5/15:5 20 [2012-11-14 15:18:56] Start thread-ClientThread_ServerA@1.1.1.1-thread_4 [2012-11-14 15:18:56] ClientThread_ServerA@1.1.1.1-thread_1-1/15:1 16 [2012-11-14 15:18:56] ClientThread_ServerA@1.1.1.1-thread_3-3/15:3 18 [2012-11-14 15:18:56] ClientThread_ServerA@1.1.1.1-thread_2-2/15:2 17 [2012-11-14 15:18:56] Start thread-ClientThread_ServerB@1.1.1.2-thread_2 [2012-11-14 15:18:56] ClientThread_ServerB@1.1.1.2-thread_1-6/15:6 21 [2012-11-14 15:18:56] Start thread-ClientThread_ServerB@1.1.1.2-thread_3 [2012-11-14 15:18:56] ClientThread_ServerB@1.1.1.2-thread_2-7/15:7 22 [2012-11-14 15:18:56] ClientThread_ServerB@1.1.1.2-thread_3-8/15:8 23 [2012-11-14 15:18:56] Start thread-ClientThread_ServerC@1.1.1.3-thread_1 [2012-11-14 15:18:56] Start thread-ClientThread_ServerB@1.1.1.2-thread_4 [2012-11-14 15:18:56] ClientThread_ServerC@1.1.1.3-thread_1-11/15:11 26 [2012-11-14 15:18:56] ClientThread_ServerA@1.1.1.1-thread_4-4/15:4 19 [2012-11-14 15:18:56] Start thread-ClientThread_ServerC@1.1.1.3-thread_2 [2012-11-14 15:18:56] ClientThread_ServerB@1.1.1.2-thread_4-9/15:9 24 [2012-11-14 15:18:56] Start thread-ClientThread_ServerC@1.1.1.3-thread_3 [2012-11-14 15:18:56] ClientThread_ServerC@1.1.1.3-thread_2-12/15:12 27 [2012-11-14 15:18:56] Start thread-ClientThread_ServerC@1.1.1.3-thread_4 [2012-11-14 15:18:56] ClientThread_ServerC@1.1.1.3-thread_3-13/15:13 28 [2012-11-14 15:18:56] ClientThread_ServerC@1.1.1.3-thread_4-14/15:14 29 [2012-11-14 15:19:01] ClientThread_ServerB@1.1.1.2-thread_0-5/15:5 20 [2012-11-14 15:19:01] ClientThread_ServerA@1.1.1.1-thread_3-3/15:3 18 [2012-11-14 15:19:01] ClientThread_ServerA@1.1.1.1-thread_0-0/15:15 30 [2012-11-14 15:19:01] ClientThread_ServerB@1.1.1.2-thread_1-6/15:6 21 [2012-11-14 15:19:01] ClientThread_ServerA@1.1.1.1-thread_1-1/15:1 16 [2012-11-14 15:19:01] ClientThread_ServerC@1.1.1.3-thread_0-10/15:10 25 [2012-11-14 15:19:01] ClientThread_ServerA@1.1.1.1-thread_2-2/15:2 17 [2012-11-14 15:19:01] ClientThread_ServerB@1.1.1.2-thread_2-7/15:7 22 [2012-11-14 15:19:01] ClientThread_ServerC@1.1.1.3-thread_1-11/15:11 26 [2012-11-14 15:19:01] ClientThread_ServerB@1.1.1.2-thread_3-8/15:8 23 [2012-11-14 15:19:01] ClientThread_ServerA@1.1.1.1-thread_4-4/15:4 19 [2012-11-14 15:19:01] ClientThread_ServerC@1.1.1.3-thread_2-12/15:12 27 [2012-11-14 15:19:01] ClientThread_ServerB@1.1.1.2-thread_4-9/15:9 24 [2012-11-14 15:19:01] ClientThread_ServerC@1.1.1.3-thread_3-13/15:13 28 [2012-11-14 15:19:01] ClientThread_ServerC@1.1.1.3-thread_4-14/15:14 29 [2012-11-14 15:19:02] Thread-0 get an event.Path:/demo/1.1.1.1,state:SyncConnected,type:NodeDeleted [2012-11-14 15:19:02] In event: NodeDeleted [2012-11-14 15:19:02] ================ [2012-11-14 15:19:02] ServerA@1.1.1.1:freshingâ€¦ [2012-11-14 15:19:02] Thread-12 get an event.Path:/demo/1.1.1.1,state:SyncConnected,type:NodeDeleted [2012-11-14 15:19:02] In event: NodeDeleted [2012-11-14 15:19:02] ================ [2012-11-14 15:19:02] ServerC@1.1.1.3:freshingâ€¦ [2012-11-14 15:19:02] Thread-6 get an event.Path:/demo/1.1.1.1,state:SyncConnected,type:NodeDeleted [2012-11-14 15:19:02] In event: NodeDeleted [2012-11-14 15:19:02] ================ [2012-11-14 15:19:02] ServerB@1.1.1.2:freshingâ€¦ [2012-11-14 15:19:02] SYSTEM VERSION: 1 [2012-11-14 15:19:02] SYSTEM VERSION: 1 [2012-11-14 15:19:02] SYSTEM VERSION: 1 [2012-11-14 15:19:02] Server count:2 [2012-11-14 15:19:02] Server count:2 Did not get the mod number for ServerA@1.1.1.1 [2012-11-14 15:19:02] ServerA@1.1.1.1:end freshingâ€¦ [2012-11-14 15:19:02] ================ [2012-11-14 15:19:02] End event: NodeDeleted [2012-11-14 15:19:02] Thread-0 get an event.Path:/demo,state:SyncConnected,type:NodeChildrenChanged [2012-11-14 15:19:02] In event: NodeChildrenChanged [2012-11-14 15:19:02] ================ [2012-11-14 15:19:02] ServerA@1.1.1.1:freshingâ€¦ [2012-11-14 15:19:02] Server count:2 [2012-11-14 15:19:02] ServerC@1.1.1.3, mod=2,base=10 [2012-11-14 15:19:02] ClientThread_ServerC@1.1.1.3-thread_0:10/10 [2012-11-14 15:19:02] ClientThread_ServerC@1.1.1.3-thread_1:11/10 [2012-11-14 15:19:02] ClientThread_ServerC@1.1.1.3-thread_2:12/10 [2012-11-14 15:19:02] ClientThread_ServerC@1.1.1.3-thread_3:13/10 [2012-11-14 15:19:02] ClientThread_ServerC@1.1.1.3-thread_4:14/10 [2012-11-14 15:19:02] ServerC@1.1.1.3:end freshingâ€¦ [2012-11-14 15:19:02] ================ [2012-11-14 15:19:02] End event: NodeDeleted [2012-11-14 15:19:02] Thread-12 get an event.Path:/demo,state:SyncConnected,type:NodeChildrenChanged [2012-11-14 15:19:02] In event: NodeChildrenChanged [2012-11-14 15:19:02] ================ [2012-11-14 15:19:02] ServerC@1.1.1.3:freshingâ€¦ [2012-11-14 15:19:02] ServerB@1.1.1.2, mod=1,base=10 [2012-11-14 15:19:02] SYSTEM VERSION: 1 [2012-11-14 15:19:02] ClientThread_ServerB@1.1.1.2-thread_0:5/10 [2012-11-14 15:19:02] ClientThread_ServerB@1.1.1.2-thread_1:6/10 [2012-11-14 15:19:02] ClientThread_ServerB@1.1.1.2-thread_2:7/10 [2012-11-14 15:19:02] ClientThread_ServerB@1.1.1.2-thread_3:8/10 [2012-11-14 15:19:02] ClientThread_ServerB@1.1.1.2-thread_4:9/10 [2012-11-14 15:19:02] ServerB@1.1.1.2:end freshingâ€¦ [2012-11-14 15:19:02] ================ [2012-11-14 15:19:02] End event: NodeDeleted [2012-11-14 15:19:02] Thread-6 get an event.Path:/demo,state:SyncConnected,type:NodeChildrenChanged [2012-11-14 15:19:02] In event: NodeChildrenChanged [2012-11-14 15:19:02] ================ [2012-11-14 15:19:02] ServerB@1.1.1.2:freshingâ€¦ [2012-11-14 15:19:02] SYSTEM VERSION: 1 [2012-11-14 15:19:02] Server count:2 [2012-11-14 15:19:02] ServerA@1.1.1.1:end freshingâ€¦ [2012-11-14 15:19:02] ================ [2012-11-14 15:19:02] End event: NodeChildrenChanged Did not get the mod number for ServerA@1.1.1.1 [2012-11-14 15:19:02] SYSTEM VERSION: 1 [2012-11-14 15:19:02] Server count:2 [2012-11-14 15:19:02] Server count:2 [2012-11-14 15:19:02] ServerC@1.1.1.3, mod=2,base=10 [2012-11-14 15:19:02] ClientThread_ServerC@1.1.1.3-thread_0:10/10 [2012-11-14 15:19:02] ClientThread_ServerC@1.1.1.3-thread_1:11/10 [2012-11-14 15:19:02] ClientThread_ServerC@1.1.1.3-thread_2:12/10 [2012-11-14 15:19:02] ClientThread_ServerC@1.1.1.3-thread_3:13/10 [2012-11-14 15:19:02] ServerB@1.1.1.2, mod=1,base=10 [2012-11-14 15:19:02] ClientThread_ServerC@1.1.1.3-thread_4:14/10 [2012-11-14 15:19:02] ClientThread_ServerB@1.1.1.2-thread_0:5/10 [2012-11-14 15:19:02] ServerC@1.1.1.3:end freshingâ€¦ [2012-11-14 15:19:02] ClientThread_ServerB@1.1.1.2-thread_1:6/10 [2012-11-14 15:19:02] ================ [2012-11-14 15:19:02] End event: NodeChildrenChanged [2012-11-14 15:19:02] ClientThread_ServerB@1.1.1.2-thread_2:7/10 [2012-11-14 15:19:02] ClientThread_ServerB@1.1.1.2-thread_3:8/10 [2012-11-14 15:19:02] ClientThread_ServerB@1.1.1.2-thread_4:9/10 [2012-11-14 15:19:02] ServerB@1.1.1.2:end freshingâ€¦ [2012-11-14 15:19:02] ================ [2012-11-14 15:19:02] End event: NodeChildrenChanged [2012-11-14 15:19:06] ClientThread_ServerA@1.1.1.1-thread_1-1/10:1 11 21 [2012-11-14 15:19:06] ClientThread_ServerB@1.1.1.2-thread_1-6/10:6 16 26 [2012-11-14 15:19:06] ClientThread_ServerB@1.1.1.2-thread_0-5/10:5 15 25 [2012-11-14 15:19:06] ClientThread_ServerA@1.1.1.1-thread_2-2/10:2 12 22 [2012-11-14 15:19:06] ClientThread_ServerC@1.1.1.3-thread_0-10/10: [2012-11-14 15:19:06] ClientThread_ServerA@1.1.1.1-thread_3-3/10:3 13 23 [2012-11-14 15:19:06] ClientThread_ServerA@1.1.1.1-thread_0-0/10:10 20 30 [2012-11-14 15:19:06] ClientThread_ServerA@1.1.1.1-thread_4-4/10:4 14 24 [2012-11-14 15:19:06] ClientThread_ServerB@1.1.1.2-thread_2-7/10:7 17 27 [2012-11-14 15:19:06] ClientThread_ServerB@1.1.1.2-thread_3-8/10:8 18 28 [2012-11-14 15:19:06] ClientThread_ServerC@1.1.1.3-thread_1-11/10: [2012-11-14 15:19:06] ClientThread_ServerC@1.1.1.3-thread_2-12/10: [2012-11-14 15:19:06] ClientThread_ServerB@1.1.1.2-thread_4-9/10:9 19 29 [2012-11-14 15:19:06] ClientThread_ServerC@1.1.1.3-thread_3-13/10: [2012-11-14 15:19:06] ClientThread_ServerC@1.1.1.3-thread_4-14/10: [2012-11-14 15:19:07] Thread-0 get an event.Path:/demo,state:SyncConnected,type:NodeChildrenChanged [2012-11-14 15:19:07] In event: NodeChildrenChanged [2012-11-14 15:19:07] ================ [2012-11-14 15:19:07] ServerA@1.1.1.1:freshingâ€¦ [2012-11-14 15:19:07] Thread-12 get an event.Path:/demo/1.1.1.2,state:SyncConnected,type:NodeDeleted [2012-11-14 15:19:07] In event: NodeDeleted [2012-11-14 15:19:07] ================ [2012-11-14 15:19:07] ServerC@1.1.1.3:freshingâ€¦ [2012-11-14 15:19:07] Thread-6 get an event.Path:/demo/1.1.1.2,state:SyncConnected,type:NodeDeleted [2012-11-14 15:19:07] In event: NodeDeleted [2012-11-14 15:19:07] ================ [2012-11-14 15:19:07] ServerB@1.1.1.2:freshingâ€¦ [2012-11-14 15:19:07] SYSTEM VERSION: 1 Did not get the mod number for ServerA@1.1.1.1 [2012-11-14 15:19:07] Server count:1 [2012-11-14 15:19:07] ServerA@1.1.1.1:end freshingâ€¦ [2012-11-14 15:19:07] ================ [2012-11-14 15:19:07] End event: NodeChildrenChanged [2012-11-14 15:19:07] SYSTEM VERSION: 1 [2012-11-14 15:19:07] SYSTEM VERSION: 1 [2012-11-14 15:19:07] Server count:1 [2012-11-14 15:19:07] Server count:1 [2012-11-14 15:19:07] ServerB@1.1.1.2:end freshingâ€¦ [2012-11-14 15:19:07] ================ [2012-11-14 15:19:07] End event: NodeDeleted [2012-11-14 15:19:07] Thread-6 get an event.Path:/demo,state:SyncConnected,type:NodeChildrenChanged [2012-11-14 15:19:07] In event: NodeChildrenChanged [2012-11-14 15:19:07] ================ [2012-11-14 15:19:07] ServerB@1.1.1.2:freshingâ€¦ Did not get the mod number for ServerB@1.1.1.2 [2012-11-14 15:19:07] ServerC@1.1.1.3, mod=2,base=5 [2012-11-14 15:19:07] ClientThread_ServerC@1.1.1.3-thread_0:10/5 [2012-11-14 15:19:07] ClientThread_ServerC@1.1.1.3-thread_1:11/5 [2012-11-14 15:19:07] ClientThread_ServerC@1.1.1.3-thread_2:12/5 [2012-11-14 15:19:07] ClientThread_ServerC@1.1.1.3-thread_3:13/5 [2012-11-14 15:19:07] ClientThread_ServerC@1.1.1.3-thread_4:14/5 [2012-11-14 15:19:07] ServerC@1.1.1.3:end freshingâ€¦ [2012-11-14 15:19:07] ================ [2012-11-14 15:19:07] End event: NodeDeleted [2012-11-14 15:19:07] Thread-12 get an event.Path:/demo,state:SyncConnected,type:NodeChildrenChanged [2012-11-14 15:19:07] In event: NodeChildrenChanged [2012-11-14 15:19:07] ================ [2012-11-14 15:19:07] ServerC@1.1.1.3:freshingâ€¦ [2012-11-14 15:19:07] SYSTEM VERSION: 1 Did not get the mod number for ServerB@1.1.1.2 [2012-11-14 15:19:07] Server count:1 [2012-11-14 15:19:07] ServerB@1.1.1.2:end freshingâ€¦ [2012-11-14 15:19:07] ================ [2012-11-14 15:19:07] End event: NodeChildrenChanged [2012-11-14 15:19:07] SYSTEM VERSION: 1 [2012-11-14 15:19:07] Server count:1 [2012-11-14 15:19:07] ServerC@1.1.1.3, mod=2,base=5 [2012-11-14 15:19:07] ClientThread_ServerC@1.1.1.3-thread_0:10/5 [2012-11-14 15:19:07] ClientThread_ServerC@1.1.1.3-thread_1:11/5 [2012-11-14 15:19:07] ClientThread_ServerC@1.1.1.3-thread_2:12/5 [2012-11-14 15:19:07] ClientThread_ServerC@1.1.1.3-thread_3:13/5 [2012-11-14 15:19:07] ClientThread_ServerC@1.1.1.3-thread_4:14/5 [2012-11-14 15:19:07] ServerC@1.1.1.3:end freshingâ€¦ [2012-11-14 15:19:07] ================ [2012-11-14 15:19:07] End event: NodeChildrenChanged [2012-11-14 15:19:11] ClientThread_ServerB@1.1.1.2-thread_1-6/5: [2012-11-14 15:19:11] ClientThread_ServerA@1.1.1.1-thread_0-0/5:5 10 15 20 25 30 [2012-11-14 15:19:11] ClientThread_ServerC@1.1.1.3-thread_0-10/5: [2012-11-14 15:19:11] ClientThread_ServerA@1.1.1.1-thread_1-1/5:1 6 11 16 21 26 [2012-11-14 15:19:11] ClientThread_ServerA@1.1.1.1-thread_3-3/5:3 8 13 18 23 28 [2012-11-14 15:19:11] ClientThread_ServerB@1.1.1.2-thread_0-5/5: [2012-11-14 15:19:11] ClientThread_ServerA@1.1.1.1-thread_2-2/5:2 7 12 17 22 27 [2012-11-14 15:19:11] ClientThread_ServerC@1.1.1.3-thread_1-11/5: [2012-11-14 15:19:11] ClientThread_ServerB@1.1.1.2-thread_3-8/5: [2012-11-14 15:19:11] ClientThread_ServerB@1.1.1.2-thread_2-7/5: [2012-11-14 15:19:11] ClientThread_ServerA@1.1.1.1-thread_4-4/5:4 9 14 19 24 29 [2012-11-14 15:19:11] ClientThread_ServerB@1.1.1.2-thread_4-9/5: [2012-11-14 15:19:11] ClientThread_ServerC@1.1.1.3-thread_2-12/5: [2012-11-14 15:19:11] ClientThread_ServerC@1.1.1.3-thread_4-14/5: [2012-11-14 15:19:11] ClientThread_ServerC@1.1.1.3-thread_3-13/5: [2012-11-14 15:19:12] Thread-0 get an event.Path:/demo,state:SyncConnected,type:NodeChildrenChanged [2012-11-14 15:19:12] In event: NodeChildrenChanged [2012-11-14 15:19:12] ================ [2012-11-14 15:19:12] ServerA@1.1.1.1:freshingâ€¦ [2012-11-14 15:19:12] Thread-12 get an event.Path:/demo/1.1.1.3,state:SyncConnected,type:NodeDeleted [2012-11-14 15:19:12] In event: NodeDeleted [2012-11-14 15:19:12] ================ [2012-11-14 15:19:12] ServerC@1.1.1.3:freshingâ€¦ [2012-11-14 15:19:12] Thread-6 get an event.Path:/demo,state:SyncConnected,type:NodeChildrenChanged [2012-11-14 15:19:12] In event: NodeChildrenChanged [2012-11-14 15:19:12] ================ [2012-11-14 15:19:12] ServerB@1.1.1.2:freshingâ€¦ [2012-11-14 15:19:12] SYSTEM VERSION: 1 [2012-11-14 15:19:12] SYSTEM VERSION: 1 [2012-11-14 15:19:12] Server count:0 [2012-11-14 15:19:12] ServerB@1.1.1.2:end freshingâ€¦ [2012-11-14 15:19:12] ================ [2012-11-14 15:19:12] End event: NodeChildrenChanged [2012-11-14 15:19:12] SYSTEM VERSION: 1 [2012-11-14 15:19:12] Server count:0 [2012-11-14 15:19:12] ServerA@1.1.1.1:end freshingâ€¦ [2012-11-14 15:19:12] ================ [2012-11-14 15:19:12] End event: NodeChildrenChanged [2012-11-14 15:19:12] Server count:0 [2012-11-14 15:19:12] ServerC@1.1.1.3:end freshingâ€¦ [2012-11-14 15:19:12] ================ [2012-11-14 15:19:12] End event: NodeDeleted [2012-11-14 15:19:12] Thread-12 get an event.Path:/demo,state:SyncConnected,type:NodeChildrenChanged [2012-11-14 15:19:12] In event: NodeChildrenChanged [2012-11-14 15:19:12] ================ [2012-11-14 15:19:12] ServerC@1.1.1.3:freshingâ€¦ [2012-11-14 15:19:12] SYSTEM VERSION: 1 [2012-11-14 15:19:12] Server count:0 [2012-11-14 15:19:12] ServerC@1.1.1.3:end freshingâ€¦ [2012-11-14 15:19:12] ================ [2012-11-14 15:19:12] End event: NodeChildrenChanged [2012-11-14 15:19:16] ClientThread_ServerB@1.1.1.2-thread_1: did not get server_count and modNum!!! [2012-11-14 15:19:16] ClientThread_ServerA@1.1.1.1-thread_2: did not get server_count and modNum!!! [2012-11-14 15:19:16] ClientThread_ServerB@1.1.1.2-thread_0: did not get server_count and modNum!!! [2012-11-14 15:19:16] ClientThread_ServerA@1.1.1.1-thread_1: did not get server_count and modNum!!! [2012-11-14 15:19:16] ClientThread_ServerC@1.1.1.3-thread_0: did not get server_count and modNum!!! [2012-11-14 15:19:16] ClientThread_ServerA@1.1.1.1-thread_3: did not get server_count and modNum!!! [2012-11-14 15:19:16] ClientThread_ServerA@1.1.1.1-thread_0: did not get server_count and modNum!!! [2012-11-14 15:19:16] ClientThread_ServerA@1.1.1.1-thread_4: did not get server_count and modNum!!! [2012-11-14 15:19:16] ClientThread_ServerB@1.1.1.2-thread_3: did not get server_count and modNum!!! [2012-11-14 15:19:16] ClientThread_ServerC@1.1.1.3-thread_1: did not get server_count and modNum!!! [2012-11-14 15:19:16] ClientThread_ServerB@1.1.1.2-thread_2: did not get server_count and modNum!!! [2012-11-14 15:19:16] ClientThread_ServerB@1.1.1.2-thread_4: did not get server_count and modNum!!! [2012-11-14 15:19:16] ClientThread_ServerC@1.1.1.3-thread_2: did not get server_count and modNum!!! [2012-11-14 15:19:16] ClientThread_ServerC@1.1.1.3-thread_3: did not get server_count and modNum!!! [2012-11-14 15:19:16] ClientThread_ServerC@1.1.1.3-thread_4: did not get server_count and modNum!!! [2012-11-14 15:19:20] Thread-0 get an event.Path:/demo,state:SyncConnected,type:NodeChildrenChanged [2012-11-14 15:19:20] In event: NodeChildrenChanged [2012-11-14 15:19:20] ================ [2012-11-14 15:19:20] ServerA@1.1.1.1:freshingâ€¦ [2012-11-14 15:19:20] Thread-6 get an event.Path:/demo,state:SyncConnected,type:NodeChildrenChanged [2012-11-14 15:19:20] In event: NodeChildrenChanged [2012-11-14 15:19:20] ================ [2012-11-14 15:19:20] ServerB@1.1.1.2:freshingâ€¦ [2012-11-14 15:19:20] Thread-12 get an event.Path:/demo,state:SyncConnected,type:NodeChildrenChanged [2012-11-14 15:19:20] In event: NodeChildrenChanged [2012-11-14 15:19:20] ================ [2012-11-14 15:19:20] ServerC@1.1.1.3:freshingâ€¦ [2012-11-14 15:19:20] SYSTEM VERSION: 1 [2012-11-14 15:19:20] SYSTEM VERSION: 1 [2012-11-14 15:19:20] SYSTEM VERSION: 1 [2012-11-14 15:19:20] Server count:1 Did not get the mod number for ServerC@1.1.1.3 [2012-11-14 15:19:20] Server count:1 [2012-11-14 15:19:20] ServerC@1.1.1.3:end freshingâ€¦ [2012-11-14 15:19:20] ================ [2012-11-14 15:19:20] End event: NodeChildrenChanged [2012-11-14 15:19:20] ServerA@1.1.1.1, mod=0,base=5 [2012-11-14 15:19:20] ClientThread_ServerA@1.1.1.1-thread_0:0/5 [2012-11-14 15:19:20] ClientThread_ServerA@1.1.1.1-thread_1:1/5 [2012-11-14 15:19:20] ClientThread_ServerA@1.1.1.1-thread_2:2/5 [2012-11-14 15:19:20] ClientThread_ServerA@1.1.1.1-thread_3:3/5 [2012-11-14 15:19:20] ClientThread_ServerA@1.1.1.1-thread_4:4/5 [2012-11-14 15:19:20] ServerA@1.1.1.1:end freshingâ€¦ [2012-11-14 15:19:20] ================ [2012-11-14 15:19:20] End event: NodeChildrenChanged Did not get the mod number for ServerB@1.1.1.2 [2012-11-14 15:19:20] Server count:1 [2012-11-14 15:19:20] ServerB@1.1.1.2:end freshingâ€¦ [2012-11-14 15:19:20] ================ [2012-11-14 15:19:20] End event: NodeChildrenChanged [2012-11-14 15:19:21] ClientThread_ServerB@1.1.1.2-thread_1-6/5: [2012-11-14 15:19:21] ClientThread_ServerA@1.1.1.1-thread_0-0/5:5 10 15 20 25 30 [2012-11-14 15:19:21] ClientThread_ServerA@1.1.1.1-thread_2-2/5:2 7 12 17 22 27 [2012-11-14 15:19:21] ClientThread_ServerA@1.1.1.1-thread_1-1/5:1 6 11 16 21 26 [2012-11-14 15:19:21] ClientThread_ServerA@1.1.1.1-thread_3-3/5:3 8 13 18 23 28 [2012-11-14 15:19:21] ClientThread_ServerC@1.1.1.3-thread_0-10/5: [2012-11-14 15:19:21] ClientThread_ServerB@1.1.1.2-thread_0-5/5: [2012-11-14 15:19:21] ClientThread_ServerC@1.1.1.3-thread_1-11/5: [2012-11-14 15:19:21] ClientThread_ServerB@1.1.1.2-thread_3-8/5: [2012-11-14 15:19:21] ClientThread_ServerA@1.1.1.1-thread_4-4/5:4 9 14 19 24 29 [2012-11-14 15:19:21] ClientThread_ServerB@1.1.1.2-thread_2-7/5: [2012-11-14 15:19:21] ClientThread_ServerC@1.1.1.3-thread_2-12/5: [2012-11-14 15:19:21] ClientThread_ServerB@1.1.1.2-thread_4-9/5: [2012-11-14 15:19:21] ClientThread_ServerC@1.1.1.3-thread_4-14/5: [2012-11-14 15:19:21] ClientThread_ServerC@1.1.1.3-thread_3-13/5: [2012-11-14 15:19:25] Thread-0 get an event.Path:/demo,state:SyncConnected,type:NodeChildrenChanged [2012-11-14 15:19:25] In event: NodeChildrenChanged [2012-11-14 15:19:25] ================ [2012-11-14 15:19:25] ServerA@1.1.1.1:freshingâ€¦ [2012-11-14 15:19:25] Thread-6 get an event.Path:/demo,state:SyncConnected,type:NodeChildrenChanged [2012-11-14 15:19:25] In event: NodeChildrenChanged [2012-11-14 15:19:25] ================ [2012-11-14 15:19:25] ServerB@1.1.1.2:freshingâ€¦ [2012-11-14 15:19:25] Thread-12 get an event.Path:/demo,state:SyncConnected,type:NodeChildrenChanged [2012-11-14 15:19:25] In event: NodeChildrenChanged [2012-11-14 15:19:25] ================ [2012-11-14 15:19:25] ServerC@1.1.1.3:freshingâ€¦ [2012-11-14 15:19:25] SYSTEM VERSION: 1 [2012-11-14 15:19:25] SYSTEM VERSION: 1 [2012-11-14 15:19:25] SYSTEM VERSION: 1 [2012-11-14 15:19:25] Server count:2 [2012-11-14 15:19:25] ServerC@1.1.1.3:end freshingâ€¦ [2012-11-14 15:19:25] ================ Did not get the mod number for ServerC@1.1.1.3 [2012-11-14 15:19:25] End event: NodeChildrenChanged [2012-11-14 15:19:25] Server count:2 [2012-11-14 15:19:25] Server count:2 [2012-11-14 15:19:25] ServerB@1.1.1.2, mod=1,base=10 [2012-11-14 15:19:25] ClientThread_ServerB@1.1.1.2-thread_0:5/10 [2012-11-14 15:19:25] ClientThread_ServerB@1.1.1.2-thread_1:6/10 [2012-11-14 15:19:25] ClientThread_ServerB@1.1.1.2-thread_2:7/10 [2012-11-14 15:19:25] ClientThread_ServerB@1.1.1.2-thread_3:8/10 [2012-11-14 15:19:25] ClientThread_ServerB@1.1.1.2-thread_4:9/10 [2012-11-14 15:19:25] ServerB@1.1.1.2:end freshingâ€¦ [2012-11-14 15:19:25] ================ [2012-11-14 15:19:25] End event: NodeChildrenChanged [2012-11-14 15:19:25] ServerA@1.1.1.1, mod=0,base=10 [2012-11-14 15:19:25] ClientThread_ServerA@1.1.1.1-thread_0:0/10 [2012-11-14 15:19:25] ClientThread_ServerA@1.1.1.1-thread_1:1/10 [2012-11-14 15:19:25] ClientThread_ServerA@1.1.1.1-thread_2:2/10 [2012-11-14 15:19:25] ClientThread_ServerA@1.1.1.1-thread_3:3/10 [2012-11-14 15:19:25] ClientThread_ServerA@1.1.1.1-thread_4:4/10 [2012-11-14 15:19:25] ServerA@1.1.1.1:end freshingâ€¦ [2012-11-14 15:19:25] ================ [2012-11-14 15:19:25] End event: NodeChildrenChanged [2012-11-14 15:19:26] ClientThread_ServerA@1.1.1.1-thread_2-2/10:2 12 22 [2012-11-14 15:19:26] ClientThread_ServerA@1.1.1.1-thread_3-3/10:3 13 23 [2012-11-14 15:19:26] ClientThread_ServerA@1.1.1.1-thread_0-0/10:10 20 30 [2012-11-14 15:19:26] ClientThread_ServerA@1.1.1.1-thread_1-1/10:1 11 21 [2012-11-14 15:19:26] ClientThread_ServerC@1.1.1.3-thread_0-10/10: [2012-11-14 15:19:26] ClientThread_ServerB@1.1.1.2-thread_0-5/10:5 15 25 [2012-11-14 15:19:26] ClientThread_ServerB@1.1.1.2-thread_1-6/10:6 16 26 [2012-11-14 15:19:26] ClientThread_ServerA@1.1.1.1-thread_4-4/10:4 14 24 [2012-11-14 15:19:26] ClientThread_ServerC@1.1.1.3-thread_1-11/10: [2012-11-14 15:19:26] ClientThread_ServerB@1.1.1.2-thread_3-8/10:8 18 28 [2012-11-14 15:19:26] ClientThread_ServerB@1.1.1.2-thread_2-7/10:7 17 27 [2012-11-14 15:19:26] ClientThread_ServerB@1.1.1.2-thread_4-9/10:9 19 29 [2012-11-14 15:19:26] ClientThread_ServerC@1.1.1.3-thread_2-12/10: [2012-11-14 15:19:26] ClientThread_ServerC@1.1.1.3-thread_4-14/10: [2012-11-14 15:19:26] ClientThread_ServerC@1.1.1.3-thread_3-13/10: [2012-11-14 15:19:31] ClientThread_ServerA@1.1.1.1-thread_1-1/10:1 11 21 [2012-11-14 15:19:31] ClientThread_ServerA@1.1.1.1-thread_0-0/10:10 20 30 [2012-11-14 15:19:31] ClientThread_ServerB@1.1.1.2-thread_0-5/10:5 15 25 [2012-11-14 15:19:31] ClientThread_ServerC@1.1.1.3-thread_0-10/10: [2012-11-14 15:19:31] ClientThread_ServerA@1.1.1.1-thread_2-2/10:2 12 22 [2012-11-14 15:19:31] ClientThread_ServerA@1.1.1.1-thread_3-3/10:3 13 23 [2012-11-14 15:19:31] ClientThread_ServerB@1.1.1.2-thread_1-6/10:6 16 26 [2012-11-14 15:19:31] ClientThread_ServerC@1.1.1.3-thread_1-11/10: [2012-11-14 15:19:31] ClientThread_ServerA@1.1.1.1-thread_4-4/10:4 14 24 [2012-11-14 15:19:31] ClientThread_ServerB@1.1.1.2-thread_3-8/10:8 18 28 [2012-11-14 15:19:31] ClientThread_ServerB@1.1.1.2-thread_2-7/10:7 17 27 [2012-11-14 15:19:31] ClientThread_ServerB@1.1.1.2-thread_4-9/10:9 19 29 [2012-11-14 15:19:31] ClientThread_ServerC@1.1.1.3-thread_2-12/10: [2012-11-14 15:19:31] ClientThread_ServerC@1.1.1.3-thread_3-13/10: [2012-11-14 15:19:31] ClientThread_ServerC@1.1.1.3-thread_4-14/10: [2012-11-14 15:19:31] Thread-0 get an event.Path:/demo,state:SyncConnected,type:NodeChildrenChanged [2012-11-14 15:19:31] In event: NodeChildrenChanged [2012-11-14 15:19:31] ================ [2012-11-14 15:19:31] ServerA@1.1.1.1:freshingâ€¦ [2012-11-14 15:19:31] Thread-12 get an event.Path:/demo,state:SyncConnected,type:NodeChildrenChanged [2012-11-14 15:19:31] In event: NodeChildrenChanged [2012-11-14 15:19:31] ================ [2012-11-14 15:19:31] ServerC@1.1.1.3:freshingâ€¦ [2012-11-14 15:19:31] Thread-6 get an event.Path:/demo,state:SyncConnected,type:NodeChildrenChanged [2012-11-14 15:19:31] In event: NodeChildrenChanged [2012-11-14 15:19:31] ================ [2012-11-14 15:19:31] ServerB@1.1.1.2:freshingâ€¦ [2012-11-14 15:19:31] SYSTEM VERSION: 1 [2012-11-14 15:19:31] SYSTEM VERSION: 1 [2012-11-14 15:19:31] SYSTEM VERSION: 1 [2012-11-14 15:19:31] Server count:3 [2012-11-14 15:19:31] Server count:3 [2012-11-14 15:19:31] ServerA@1.1.1.1, mod=0,base=15 [2012-11-14 15:19:31] ClientThread_ServerA@1.1.1.1-thread_0:0/15 [2012-11-14 15:19:31] ClientThread_ServerA@1.1.1.1-thread_1:1/15 [2012-11-14 15:19:31] ClientThread_ServerA@1.1.1.1-thread_2:2/15 [2012-11-14 15:19:31] ClientThread_ServerA@1.1.1.1-thread_3:3/15 [2012-11-14 15:19:31] ClientThread_ServerA@1.1.1.1-thread_4:4/15 [2012-11-14 15:19:31] ServerA@1.1.1.1:end freshingâ€¦ [2012-11-14 15:19:31] ================ [2012-11-14 15:19:31] End event: NodeChildrenChanged [2012-11-14 15:19:31] Server count:3 [2012-11-14 15:19:31] ServerC@1.1.1.3, mod=2,base=15 [2012-11-14 15:19:31] ClientThread_ServerC@1.1.1.3-thread_0:10/15 [2012-11-14 15:19:31] ClientThread_ServerC@1.1.1.3-thread_1:11/15 [2012-11-14 15:19:31] ClientThread_ServerC@1.1.1.3-thread_2:12/15 [2012-11-14 15:19:31] ClientThread_ServerC@1.1.1.3-thread_3:13/15 [2012-11-14 15:19:31] ClientThread_ServerC@1.1.1.3-thread_4:14/15 [2012-11-14 15:19:31] ServerC@1.1.1.3:end freshingâ€¦ [2012-11-14 15:19:31] ================ [2012-11-14 15:19:31] End event: NodeChildrenChanged [2012-11-14 15:19:31] ServerB@1.1.1.2, mod=1,base=15 [2012-11-14 15:19:31] ClientThread_ServerB@1.1.1.2-thread_0:5/15 [2012-11-14 15:19:31] ClientThread_ServerB@1.1.1.2-thread_1:6/15 [2012-11-14 15:19:31] ClientThread_ServerB@1.1.1.2-thread_2:7/15 [2012-11-14 15:19:31] ClientThread_ServerB@1.1.1.2-thread_3:8/15 [2012-11-14 15:19:31] ClientThread_ServerB@1.1.1.2-thread_4:9/15 [2012-11-14 15:19:31] ServerB@1.1.1.2:end freshingâ€¦ [2012-11-14 15:19:31] ================ [2012-11-14 15:19:31] End event: NodeChildrenChanged [2012-11-14 15:19:36] ClientThread_ServerB@1.1.1.2-thread_0-5/15:5 20 [2012-11-14 15:19:36] ClientThread_ServerA@1.1.1.1-thread_2-2/15:2 17 [2012-11-14 15:19:36] ClientThread_ServerA@1.1.1.1-thread_3-3/15:3 18 [2012-11-14 15:19:36] ClientThread_ServerC@1.1.1.3-thread_0-10/15:10 25 [2012-11-14 15:19:36] ClientThread_ServerA@1.1.1.1-thread_0-0/15:15 30 [2012-11-14 15:19:36] ClientThread_ServerA@1.1.1.1-thread_1-1/15:1 16 [2012-11-14 15:19:36] ClientThread_ServerB@1.1.1.2-thread_1-6/15:6 21 [2012-11-14 15:19:36] ClientThread_ServerC@1.1.1.3-thread_1-11/15:11 26 [2012-11-14 15:19:36] ClientThread_ServerB@1.1.1.2-thread_3-8/15:8 23 [2012-11-14 15:19:36] ClientThread_ServerA@1.1.1.1-thread_4-4/15:4 19 [2012-11-14 15:19:36] ClientThread_ServerB@1.1.1.2-thread_2-7/15:7 22 [2012-11-14 15:19:36] ClientThread_ServerC@1.1.1.3-thread_2-12/15:12 27 [2012-11-14 15:19:36] ClientThread_ServerB@1.1.1.2-thread_4-9/15:9 24 [2012-11-14 15:19:36] ClientThread_ServerC@1.1.1.3-thread_4-14/15:14 29 [2012-11-14 15:19:36] ClientThread_ServerC@1.1.1.3-thread_3-13/15:13 28 [2012-11-14 15:19:41] ClientThread_ServerC@1.1.1.3-thread_0-10/15:10 25 [2012-11-14 15:19:41] ClientThread_ServerA@1.1.1.1-thread_0-0/15:15 30 [2012-11-14 15:19:41] ClientThread_ServerB@1.1.1.2-thread_1-6/15:6 21 [2012-11-14 15:19:41] ClientThread_ServerA@1.1.1.1-thread_3-3/15:3 18 [2012-11-14 15:19:41] ClientThread_ServerB@1.1.1.2-thread_0-5/15:5 20 [2012-11-14 15:19:41] ClientThread_ServerA@1.1.1.1-thread_1-1/15:1 16 [2012-11-14 15:19:41] ClientThread_ServerA@1.1.1.1-thread_2-2/15:2 17 [2012-11-14 15:19:41] ClientThread_ServerB@1.1.1.2-thread_3-8/15:8 23 [2012-11-14 15:19:41] ClientThread_ServerB@1.1.1.2-thread_2-7/15:7 22 [2012-11-14 15:19:41] ClientThread_ServerA@1.1.1.1-thread_4-4/15:4 19 [2012-11-14 15:19:41] ClientThread_ServerC@1.1.1.3-thread_1-11/15:11 26 [2012-11-14 15:19:41] ClientThread_ServerC@1.1.1.3-thread_2-12/15:12 27 [2012-11-14 15:19:41] ClientThread_ServerB@1.1.1.2-thread_4-9/15:9 24 [2012-11-14 15:19:41] ClientThread_ServerC@1.1.1.3-thread_4-14/15:14 29 [2012-11-14 15:19:41] ClientThread_ServerC@1.1.1.3-thread_3-13/15:13 28","raw":null,"content":null,"categories":[{"name":"åˆ†å¸ƒå¼åº”ç”¨","slug":"åˆ†å¸ƒå¼åº”ç”¨","permalink":"https://maohong.github.io/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E5%BA%94%E7%94%A8/"}],"tags":[{"name":"zookeeper","slug":"zookeeper","permalink":"https://maohong.github.io/tags/zookeeper/"},{"name":"åˆ†å¸ƒå¼åè°ƒ","slug":"åˆ†å¸ƒå¼åè°ƒ","permalink":"https://maohong.github.io/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E5%8D%8F%E8%B0%83/"},{"name":"æ¨ªå‘æ‰©å±•","slug":"æ¨ªå‘æ‰©å±•","permalink":"https://maohong.github.io/tags/%E6%A8%AA%E5%90%91%E6%89%A9%E5%B1%95/"}]}]}